Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.app.Activity;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.content.res.AssetManager;\r\nimport android.content.res.Configuration;\r\nimport android.graphics.Color;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.os.Environment;\r\nimport android.os.Handler;\r\nimport android.os.Message;\r\nimport android.os.PowerManager;\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.AdapterView;\r\nimport android.widget.Button;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.Spinner;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.OnBackPressedCallback;\r\n\r\nimport com.alibaba.fastjson.JSON;\r\nimport com.bumptech.glide.Glide;\r\nimport com.dou361.ijkplayer.bean.VideoijkBean;\r\nimport com.dou361.ijkplayer.listener.OnPlayerBackListener;\r\nimport com.dou361.ijkplayer.listener.OnPlayerStartOrPauseListener;\r\nimport com.dou361.ijkplayer.listener.OnShowThumbnailListener;\r\nimport com.dou361.ijkplayer.widget.PlayStateParams;\r\nimport com.dou361.ijkplayer.widget.PlayerView;\r\nimport com.dou361.jjdxm_ijkplayer.MainActivity;\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\nimport com.dou361.jjdxm_ijkplayer.command.Control;\r\nimport com.dou361.jjdxm_ijkplayer.command.Gears;\r\nimport com.dou361.jjdxm_ijkplayer.command.Handbrake;\r\nimport com.dou361.jjdxm_ijkplayer.command.Video;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTRequest;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTSample;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.VideoMonitor;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.utlis.MediaUtils;\r\nimport com.tencent.iot.hub.device.android.core.log.TXMqttLogCallBack;\r\nimport com.tencent.iot.hub.device.android.core.util.TXLog;\r\nimport com.tencent.iot.hub.device.java.core.common.Status;\r\nimport com.tencent.iot.hub.device.java.core.mqtt.TXMqttActionCallBack;\r\n\r\n\r\nimport org.eclipse.paho.client.mqttv3.IMqttToken;\r\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\r\n\r\nimport java.io.BufferedReader;\r\nimport java.io.BufferedWriter;\r\nimport java.io.ByteArrayInputStream;\r\nimport java.io.File;\r\nimport java.io.FileReader;\r\nimport java.io.FileWriter;\r\nimport java.io.IOException;\r\nimport java.io.InputStreamReader;\r\nimport java.nio.charset.Charset;\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\n\r\nimport static android.os.SystemClock.uptimeMillis;\r\n\r\n/**\r\n 遥控车辆进行移动\r\n */\r\npublic class RemoteControl extends Activity {\r\n\r\n    public String hostIP = /*\"192.168.0.108:18081\";*/\"10.6.206.20:30549\";\r\n    public String userId = \"6D的安卓測試機\";\r\n    public String vin = \"001\";\r\n\r\n    private final static String mLogPath = Environment.getExternalStorageDirectory().getPath() + \"/tencent/\";\r\n\r\n    public CountDownTimer countDownTimer;\r\n    private MainActivity mParent;\r\n    private MQTTSample mqttSample;\r\n\r\n    private PlayerView player;\r\n    private Context mContext;\r\n    private TextView  Speed;\r\n    private List<VideoijkBean> list;\r\n    private PowerManager.WakeLock wakeLock;\r\n    private View rootView;\r\n    private Activity mActivity;\r\n\r\n    private static final String TAG = \"FullscreenActivity\";\r\n    private boolean braking = true;\r\n    private boolean active_braking=false;\r\n    private int gearGlobal=0;\r\n    private int handBrakeStatus = 0;\r\n    private Button LlightingButton;\r\n    private ImageButton imageButton_forward,imageButton_backward,imageButton_brake;\r\n    private ImageView app_video_play;\r\n    private Spinner Video_Modul_Spinner;\r\n\r\n    private double wheelAngle=0.0;\r\n    private double speed=0.0;\r\n\r\n\r\n\r\n    /*虛擬機*/\r\n/*\r\n    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"android_test_phone\";\r\n    private String mDevPSK  = \"KdV+RSnHAlmEpM75aWZQZg==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/android_test_phone/data\";\r\n*/\r\n\r\n    /*OPPO A57t*/\r\n/*    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"OPPOA57t\";\r\n    private String mDevPSK  = \"TbtnFhJDmRe7N41vDBRVtA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/OPPOA57t/data\";  */  // productID/DeviceName/TopicName\r\n\r\n    /*真车配置*/\r\n    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";\r\n    private String mProductID = \"KM8UZXZOV9\";\r\n    private String mDevName = \"android_test\";\r\n    private String mDevPSK  = \"+xRWqTlp0UPbwSKXVgiNxA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"KM8UZXZOV9/android_test/data\";    // productID/DeviceName/TopicName\r\n    private String mSubProductID = \"\"; // If you wont test gateway, let this to be null\r\n    private String mSubDevName = \"\";\r\n    private String mSubDevPsk = \"BuildConfig.SUB_DEVICE_PSK\";\r\n    private String mDevCertName = \"YOUR_DEVICE_NAME_cert.crt\";\r\n    private String mDevKeyName  = \"YOUR_DEVICE_NAME_private.key\";\r\n    private String mProductKey = \"BuildConfig.PRODUCT_KEY\";        // Used for dynamic register\r\n    private String mDevCert = \"\";           // Cert String\r\n    private String mDevPriv = \"\";           // Priv String\r\n\r\n    private volatile boolean mIsConnected=false;\r\n    ScalableImageView sImgView ;\r\n\r\n    @SuppressLint(\"InvalidWakeLockTag\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        Log.d(TAG, \"onCreate: \");\r\n        super.onCreate(savedInstanceState);\r\n        this.mContext = this;\r\n        this.mActivity = this;\r\n        rootView = getLayoutInflater().from(this).inflate(R.layout.activity_remote_control, null);\r\n\r\n        setContentView(rootView);\r\n\r\n        while (!mIsConnected) {\r\n            Log.d(TAG, \"onCreate: Connecting Mqtt\");\r\n            //轮询连接,万分感谢陈岩大佬\r\n            mqttSample= new MQTTSample(getApplication(), new SelfMqttActionCallBack(), mBrokerURL, mProductID, mDevName, mDevPSK,\r\n                    mDevCert, mDevPriv, mSubProductID, mSubDevName, mTestTopic, null, null, true, new SelfMqttLogCallBack());\r\n            Log.d(TAG, \"onCreate: mqttSample\"+mqttSample.toString());\r\n            mqttSample.connect();\r\n            sleep(2000);}\r\n\r\n        mqttSample.subscribeTopic();\r\n\r\n\r\n        shiftHandbrake(1);\r\n        Log.d(TAG, \"onCreate: \");\r\n\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                 while (true) {\r\n                     if(braking){\r\n                    try {\r\n                        if (active_braking){\r\n                            moveVehicle(-1.0,0.0,wheelAngle);\r\n                        }\r\n                        else {\r\n                        moveVehicle(-0.1,0.0,wheelAngle);}\r\n                        sleep(50);\r\n                    } catch (Exception e) {\r\n                        e.printStackTrace();\r\n                    }}\r\n            }\r\n        }}).start();\r\n\r\n        /**常亮*/\r\n        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);\r\n        wakeLock = pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK, \"liveTAG\");\r\n        wakeLock.acquire();\r\n\r\n        CompentOnTouch compentOnTouch = new CompentOnTouch();\r\n\r\n        //返回键\r\n        findViewById(R.id.back2).setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View V){\r\n                //对话框\r\n                View my_view = LayoutInflater.from(RemoteControl.this).inflate(R.layout.my_dialog,null,false);\r\n                final AlertDialog dialog = new AlertDialog.Builder(RemoteControl.this).setView(my_view).create();\r\n                TextView Title = my_view.findViewById(R.id.title);\r\n                TextView Context = my_view.findViewById(R.id.content);\r\n                Title.setText(\"结束挪车\");\r\n                Context.setText(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");\r\n                ImageButton Confirm = my_view.findViewById(R.id.confirm);\r\n                ImageButton cancel = my_view.findViewById(R.id.cancel);\r\n                Confirm.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n                        finish();\r\n                        Intent intent=new Intent(RemoteControl.this, MainActivity.class);\r\n                        startActivity(intent);\r\n                        dialog.dismiss();\r\n                    }\r\n                });\r\n                cancel.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n                        Toast.makeText(RemoteControl.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                        player.startPlay();\r\n                        dialog.dismiss();\r\n                    }\r\n                });\r\n                dialog.show();\r\n                player.onPause();\r\n                dialog.getWindow().setLayout(1000,600);\r\n            }\r\n        });\r\n\r\n        imageButton_forward=findViewById(R.id.forward);\r\n        imageButton_forward.setOnTouchListener(compentOnTouch);\r\n\r\n        imageButton_backward=findViewById(R.id.backward);\r\n        imageButton_backward.setOnTouchListener(compentOnTouch);\r\n\r\n        imageButton_brake=findViewById(R.id.brake);\r\n        imageButton_brake.setOnTouchListener(compentOnTouch);\r\n        sImgView = findViewById(R.id.steering_wheel);\r\n\r\n        //方向盘角度在速度处显示\r\n        countDownTimer=new CountDownTimer(1000000,200) {\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                wheelAngle = sImgView.getmDegree();\r\n                Speed = findViewById(R.id.speed);\r\n                Speed.setText(String.valueOf((int)wheelAngle));\r\n            }\r\n            @Override\r\n            public void onFinish() {\r\n            }\r\n        }.start();\r\n\r\n        //下拉单选按钮\r\n        Video_Modul_Spinner = (Spinner)findViewById(R.id.Spinner_VIdeo_Model);\r\n//        Video_Modul_Spinner.setOutlineSpotShadowColor(Color.BLUE);\r\n        Video_Modul_Spinner.setSelection(0);//进入不会自动播放\r\n        Video_Modul_Spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener(){\r\n            @Override\r\n            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {\r\n                    String result = parent.getItemAtPosition(position).toString();\r\n                    Toast.makeText(RemoteControl.this, result, Toast.LENGTH_SHORT).show();\r\n                    switch (position) {\r\n                        case 0: {\r\n                            /**前摄像*/\r\n                            list = new ArrayList<VideoijkBean>();\r\n                            String url1 = \"rtmp://150.158.176.170/live/test_vin_1\";\r\n                            String url2 = \"rtmp://150.158.176.170:1935/live/test\";\r\n                            VideoijkBean m1 = new VideoijkBean();\r\n                            m1.setStream(\"原始视频\");\r\n                            m1.setUrl(url1);\r\n                            VideoijkBean m2 = new VideoijkBean();\r\n                            m2.setStream(\"融合视频\");\r\n                            m2.setUrl(url2);\r\n                            list.add(m1);\r\n                            list.add(m2);\r\n                            player = new PlayerView(mActivity, rootView)\r\n                                    .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                                    .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                                    .forbidTouch(false)\r\n                                    .hideSteam(false)\r\n                                    .hideMenu(true)\r\n                                    .hideCenterPlayer(true)\r\n                                    .hideBack(false)\r\n                                    .setOnlyFullScreen(true)\r\n                                    .setNetWorkTypeTie(false)\r\n                                    .hideRotation(true)\r\n                                    .hideFullscreen(true)\r\n                                    .hideBack(true)\r\n                                    .setChargeTie(true, 480)//设置最长播放时间\r\n                                    .showThumbnail(new OnShowThumbnailListener() {\r\n                                        @Override\r\n                                        public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                                            Glide.with(mContext)\r\n                                                    .load(R.drawable.pic_before_video)\r\n                                                    .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                                    .error(R.color.cl_error)//加载错误之后的错误图\r\n                                                    .into(ivThumbnail);\r\n                                        }\r\n                                    })\r\n                                    .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                                        @Override\r\n                                        public void onStartOrPause() {\r\n                                            //对话框\r\n                                            AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                                            builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                                            builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                                            builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    player.startPlay();\r\n                                                }\r\n                                            });\r\n                                            builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    finish();\r\n                                                    Intent intent=new Intent(RemoteControl.this,MainActivity.class);\r\n                                                    startActivity(intent);\r\n                                                }\r\n                                            });\r\n                                            AlertDialog b=builder.create();\r\n                                            b.show();\r\n                                        }\r\n                                    })\r\n                                    .setPlaySource(list)\r\n                                    .startPlay();\r\n                        }\r\n                        break;\r\n\r\n                        case 1: {\r\n                            /**后摄像*/\r\n                            String url3 = \"rtmp://150.158.176.170/live/test_vin_2\";\r\n                            playVideoUrl(url3);\r\n                        }\r\n                        break;\r\n\r\n                        case 2: {\r\n                            /**左摄像*/\r\n                            String url4 = \"rtmp://150.158.176.170/live/test_vin_3\";\r\n                            playVideoUrl(url4);\r\n                        }\r\n                        break;\r\n\r\n                        case 3: {\r\n                            /**右摄像*/\r\n                            String url5 = \"rtmp://150.158.176.170/live/test_vin_4\";\r\n                            playVideoUrl(url5);\r\n\r\n                        }\r\n                        break;\r\n\r\n                        case 4: {\r\n                            /**上帝*/\r\n                            String url6 = \"http://ivi.bupt.edu.cn/hls/cctv13.m3u8\";\r\n                            playVideoUrl(url6);\r\n                        }\r\n                        break;\r\n\r\n                        default:\r\n                            break;\r\n                    }\r\n\r\n            }\r\n            @Override\r\n            public void onNothingSelected(AdapterView<?> parent) { }\r\n        });\r\n\r\n    }\r\n\r\n    //后四个视频播放器播放\r\n    public  void playVideoUrl( String url){\r\n        player = new PlayerView(mActivity, rootView)\r\n                .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                .forbidTouch(false)\r\n                .hideSteam(true)\r\n                .hideMenu(true)\r\n                .hideCenterPlayer(true)\r\n                .hideBack(false)\r\n                .setOnlyFullScreen(true)\r\n                .setNetWorkTypeTie(false)\r\n                .hideRotation(true)\r\n                .hideFullscreen(true)\r\n                .hideBack(true)\r\n                .setChargeTie(true, 480)//设置最长播放时间\r\n                .showThumbnail(new OnShowThumbnailListener() {\r\n                    @Override\r\n                    public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                        Glide.with(mContext)\r\n                                .load(R.drawable.pic_before_video)\r\n                                .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                .error(R.color.cl_error)//加载错误之后的错误图\r\n                                .into(ivThumbnail);\r\n                    }\r\n                })\r\n                .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                    @Override\r\n                    public void onStartOrPause() {\r\n                        //对话框\r\n                        AlertDialog.Builder builder = new AlertDialog.Builder(mContext);\r\n                        builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                        builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                        builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                player.startPlay();\r\n                            }\r\n                        });\r\n                        builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                finish();\r\n                                Intent intent = new Intent(RemoteControl.this, MainActivity.class);\r\n                                startActivity(intent);\r\n                            }\r\n                        });\r\n                        AlertDialog b = builder.create();\r\n                        b.show();\r\n                    }\r\n                })\r\n                .setPlaySource(url)\r\n                .startPlay();\r\n    }\r\n\r\n\r\n    /**\r\n    1表示手刹释放，0表示手刹锁定\r\n     **/\r\n\r\n    private void shiftHandbrake(int handbrakeToSet) {\r\n        if(handbrakeToSet!=handBrakeStatus){\r\n            for(int i=0;i<5;i++){\r\n                Handbrake mHandbrake = new Handbrake();\r\n                mHandbrake.setTimestamp(System.currentTimeMillis());\r\n                mHandbrake.setStatus(handbrakeToSet);\r\n                mHandbrake.setType(14);\r\n                mHandbrake.setTaskid(\"6D\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mHandbrake));\r\n                Log.d(TAG, \"onClick: 手刹\"+JSON.toJSONString(mHandbrake));\r\n                sleep(50);\r\n            }\r\n            handBrakeStatus=handbrakeToSet;}\r\n        else return;\r\n    }\r\n\r\n    /**\r\n    1,2,3,4分別對應P,R,N,D四個檔位\r\n     **/\r\n    private void shiftGear(final int gear){\r\n//        if(speed==0){\r\n        for(int i=0;i<10;i++){\r\n                Gears mGear = new Gears();\r\n                mGear.setTimestamp(System.currentTimeMillis());\r\n                Log.d(TAG, \"onClick: \"+System.currentTimeMillis());\r\n                mGear.setGear(gear);\r\n                mGear.setType(13);\r\n                mGear.setTaskid(\"手機挂\"+gear+\"档\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mGear));\r\n                Log.d(TAG, \"onClick: \"+JSON.toJSONString(mGear));\r\n                sleep(50);\r\n        }\r\n        gearGlobal=gear;\r\n//    }\r\n//        else {\r\n//            moveVehicle(-0.3,0.0,0.0);\r\n//            shiftGear(gear);\r\n//        }\r\n    }\r\n\r\n    /**\r\n\r\n     @videoType\r\n     1为前方原始视频流，2为后方原始视频流，3为左侧原始视频流，4为右侧原始视频流，5为感知融合视频流，6为上帝视角视频流\r\n     @videoStatus\r\n     1为打开，0为关闭\r\n     */\r\n    private void shiftVideoType(int videoType,int videoStatus){\r\n        Video mVideo = new Video();\r\n        mVideo.setTimestamp(System.currentTimeMillis());\r\n        mVideo.setVideo_type(videoType);\r\n        mVideo.setOperation(videoStatus);\r\n        mVideo.setType(12);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        mqttSample.publishTopic(\"data\", JSON.toJSONString(mVideo));\r\n        Log.d(TAG, \"onClick: \"+JSON.toJSONString(mVideo));\r\n    }\r\n\r\n    /**\r\n     * @acceleration 加速度，正是加速，負的是減速\r\n     * @speed 目標速度\r\n     * @wheelAngle 方向盤轉角\r\n     */\r\n    private void moveVehicle(Double acceleration,Double speed,Double wheelAngle){\r\n        Control mMove = new Control();\r\n        mMove.setTimestamp(System.currentTimeMillis());\r\n        mMove.setAcceleration(acceleration);\r\n        mMove.setSpeed(speed);\r\n        mMove.setType(11);\r\n        mMove.setWheel_angle(wheelAngle);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        mqttSample.publishTopic(\"data\", JSON.toJSONString(mMove));\r\n        Log.d(TAG, \"onClick: 上传指令\"+JSON.toJSONString(mMove));\r\n    }\r\n\r\n    @Override\r\n    protected void onPostCreate(Bundle savedInstanceState) {\r\n        super.onPostCreate(savedInstanceState);\r\n    }\r\n\r\n\r\n\r\n\r\n    //ms为需要休眠的时长\r\n    public static void sleep(long ms)\r\n    {\r\n        //uptimeMillis() Returns milliseconds since boot, not counting time spent in deep sleep.\r\n        long start = uptimeMillis();\r\n        long duration = ms;\r\n        boolean interrupted = false;\r\n        do {\r\n            try {\r\n                Thread.sleep(duration);\r\n            }\r\n            catch (InterruptedException e) {\r\n                interrupted = true;\r\n            }\r\n            duration = start + ms - uptimeMillis();\r\n        } while (duration > 0);\r\n\r\n        if (interrupted) {\r\n            Thread.currentThread().interrupt();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttActionCallBack回调接口\r\n     */\r\n    private class SelfMqttActionCallBack extends TXMqttActionCallBack {\r\n\r\n        @Override\r\n        public void onConnectCompleted(Status status, boolean reconnect, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onConnectCompleted, status[%s], reconnect[%b], userContext[%s], msg[%s]\",\r\n                    status.name(), reconnect, userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            if(status==Status.OK){\r\n             mIsConnected = true;}\r\n        }\r\n\r\n        @Override\r\n        public void onConnectionLost(Throwable cause) {\r\n            String logInfo = String.format(\"onConnectionLost, cause[%s]\", cause.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onDisconnectCompleted(Status status, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onDisconnectCompleted, status[%s], userContext[%s], msg[%s]\", status.name(), userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            mIsConnected = false;\r\n        }\r\n\r\n        @Override\r\n        public void onPublishCompleted(Status status, IMqttToken token, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onPublishCompleted, status[%s], topics[%s],  userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(token.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            if (Status.ERROR == status) {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            } else {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public void onUnSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onUnSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onMessageReceived(final String topic, final MqttMessage message) {\r\n            String logInfo = String.format(\"receive command, topic[%s], message[%s]\", topic, message.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttLogCallBack回调接口\r\n     */\r\n    private class SelfMqttLogCallBack extends TXMqttLogCallBack {\r\n\r\n        @Override\r\n        public String setSecretKey() {\r\n            String secertKey;\r\n            if (mDevPSK != null && mDevPSK.length() != 0) {  //密钥认证\r\n                secertKey = mDevPSK;\r\n                secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                return secertKey;\r\n            } else {\r\n                BufferedReader cert;\r\n\r\n                if (mDevCert != null && mDevCert.length() != 0) { //动态注册,从DevCert中读取\r\n                    cert = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(mDevCert.getBytes(Charset.forName(\"utf8\"))), Charset.forName(\"utf8\")));\r\n\r\n                } else { //证书认证，从证书文件中读取\r\n                    AssetManager assetManager = mParent.getAssets();\r\n                    if (assetManager == null) {\r\n                        return null;\r\n                    }\r\n                    try {\r\n                        cert=new BufferedReader(new InputStreamReader(assetManager.open(mDevCertName)));\r\n                    } catch (IOException e) {\r\n//                        mParent.printLogInfo(TAG, \"getSecertKey failed, cannot open CRT Files.\",mLogInfoText);\r\n                        return null;\r\n                    }\r\n                }\r\n                //获取密钥\r\n                try {\r\n                    if (cert.readLine().contains(\"-----BEGIN\")) {\r\n                        secertKey = cert.readLine();\r\n                        secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                    } else {\r\n                        secertKey = null;\r\n//                        mParent.printLogInfo(TAG,\"Invaild CRT Files.\", mLogInfoText);\r\n                    }\r\n                    cert.close();\r\n                } catch (IOException e) {\r\n                    TXLog.e(TAG, \"getSecertKey failed.\", e);\r\n//                    mParent.printLogInfo(TAG,\"getSecertKey failed.\", mLogInfoText);\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return secertKey;\r\n        }\r\n\r\n        @Override\r\n        public void printDebug(String message){\r\n//            mParent.printLogInfo(TAG, message, mLogInfoText);\r\n            //TXLog.d(TAG,message);\r\n        }\r\n\r\n        @Override\r\n        public boolean saveLogOffline(String log){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"saveLogOffline not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Save log to %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedWriter wLog = new BufferedWriter(new FileWriter(new File(logFilePath), true));\r\n                wLog.write(log);\r\n                wLog.flush();\r\n                wLog.close();\r\n                return true;\r\n            } catch (IOException e) {\r\n                String logInfo = String.format(\"Save log to [%s] failed, check the Storage permission!\", logFilePath);\r\n//                mParent.printLogInfo(TAG,logInfo, mLogInfoText);\r\n                e.printStackTrace();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public String readOfflineLog(){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"readOfflineLog not ready\", mLogInfoText);\r\n                return null;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Read log from %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedReader logReader = new BufferedReader(new FileReader(logFilePath));\r\n                StringBuilder offlineLog = new StringBuilder();\r\n                int data;\r\n                while (( data = logReader.read()) != -1 ) {\r\n                    offlineLog.append((char)data);\r\n                }\r\n                logReader.close();\r\n                return offlineLog.toString();\r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n                return null;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public boolean delOfflineLog(){\r\n\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"delOfflineLog not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            File file = new File(logFilePath);\r\n            if (file.exists() && file.isFile()) {\r\n                if (file.delete()) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    class\r\n    CompentOnTouch implements View.OnTouchListener {\r\n\r\n        public boolean isOnLongClick=false;\r\n        int i = 0;\r\n\r\n        @Override\r\n        public boolean onTouch(View view, MotionEvent motionEvent) {\r\n            switch (view.getId()) {\r\n// 这是btnMius下的一个层，为了增强易点击性\r\n                case R.id.backward:\r\n                    onTouchChange(\"backward\", motionEvent.getAction());\r\n                    break;\r\n// 这里也写，是为了增强易点击性\r\n                case R.id.forward:\r\n                    onTouchChange(\"forward\", motionEvent.getAction());\r\n                    break;\r\n                case R.id.brake:\r\n                    active_braking=true;\r\n                    break;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        private void onTouchChange(String methodName, int eventAction) {\r\n            Log.d(TAG, \"onTouchChange: \"+methodName+eventAction);\r\n            braking =false;\r\n            active_braking=false;\r\n// 按下松开分别对应启动停止前进方法\r\n            if (\"backward\".equals(methodName)) {\r\n                if(gearGlobal!=2){ shiftGear(2);}\r\n                MiusThread miusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    miusThread = new MiusThread();\r\n                    isOnLongClick = true;\r\n                    miusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\"+ braking);\r\n//                    Log.d(TAG, \"onTouchChange: isOnLongClick=false\"+miusThread.isInterrupted());\r\n                    if (miusThread != null) {\r\n                        miusThread.interrupt();\r\n                        Log.d(TAG, \"onTouchChange: 终止线程\");\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (miusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n// 按下松开分别对应启动停止加线程方法\r\n            else if (\"forward\".equals(methodName)) {\r\n                if(gearGlobal!=4){ shiftGear(4);}\r\n                PlusThread plusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    plusThread = new PlusThread();\r\n                    isOnLongClick = true;\r\n                    plusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\");\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        // 后退操作\r\n        class MiusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(2);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n\r\n        // 前进操作\r\n        class PlusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(1);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n        Handler myHandler = new Handler() {\r\n            public void handleMessage(Message msg) {\r\n                switch (msg.what) {\r\n                    case 1:\r\n                        //前进操作\r\n                        Control mForward = new Control(5.0,0.1,wheelAngle);\r\n                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mForward));\r\n                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mForward));\r\n                        moveVehicle(0.1,5.0,wheelAngle);\r\n                        break;\r\n                    case 2:\r\n                        Control mBackward = new Control(-5.0,0.1,wheelAngle);\r\n                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBackward));\r\n                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBackward));\r\n                        moveVehicle(0.1,-5.0,wheelAngle);\r\n                        break;\r\n                    case 3:\r\n                        Control mBreak = new Control(0.0,-0.1,wheelAngle);\r\n                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBreak));\r\n                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBreak));\r\n                        break;\r\n                }\r\n            };\r\n        };\r\n    }\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        if (player != null) {\r\n            player.onPause();\r\n        }\r\n        /**demo的内容，恢复系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, true);\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        if (player != null) {\r\n            player.onResume();\r\n        }\r\n        /**demo的内容，暂停系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, false);\r\n        /**demo的内容，激活设备常亮状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.acquire();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onDestroy() {\r\n        super.onDestroy();\r\n        if (player != null) {\r\n            for(int i=1;i<7;i++){\r\n            shiftVideoType(i,0);}\r\n            player.onDestroy();\r\n        }\r\n        if(speed!=0){moveVehicle(-0.3,0.0,0.0);}\r\n        if(braking){braking=false;}\r\n        if(gearGlobal!=1){shiftGear(1);}\r\n        if(handBrakeStatus==1){shiftHandbrake(0);}\r\n        if(mIsConnected){mqttSample.disconnect();}\r\n\r\n        Log.d(TAG, \"onDestroy: 斷開視頻以及MQTT連接\");\r\n    }\r\n\r\n    @Override\r\n    public void onConfigurationChanged(Configuration newConfig) {\r\n        super.onConfigurationChanged(newConfig);\r\n        if (player != null) {\r\n            player.onConfigurationChanged(newConfig);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onBackPressed() {\r\n        if (player != null && player.onBackPressed()) {\r\n            return;\r\n        }\r\n//        super.onBackPressed();\r\n        //对话框\r\n        AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n        builder.setTitle(\"结束挪车\");//设置对话框的标题\r\n        builder.setMessage(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");//设置对话框的内容\r\n        builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n            @Override\r\n            public void onClick(DialogInterface arg0, int arg1) {\r\n                finish();\r\n                Intent intent=new Intent(RemoteControl.this, MainActivity.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n        builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n            @Override\r\n            public void onClick(DialogInterface arg0, int arg1) {\r\n                Toast.makeText(RemoteControl.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                player.startPlay();\r\n            }\r\n        });\r\n        AlertDialog b=builder.create();\r\n        b.show();\r\n        player.onPause();\r\n        /**demo的内容，恢复设备亮度状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.release();\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(revision e962e336aaaab82d0b16a9fddf934ebf95847741)
+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(date 1609835375845)
@@ -179,7 +179,7 @@
                             moveVehicle(-1.0,0.0,wheelAngle);
                         }
                         else {
-                        moveVehicle(-0.1,0.0,wheelAngle);}
+                        moveVehicle(-0.2,0.0,wheelAngle);}
                         sleep(50);
                     } catch (Exception e) {
                         e.printStackTrace();
@@ -884,19 +884,19 @@
                 switch (msg.what) {
                     case 1:
                         //前进操作
-                        Control mForward = new Control(5.0,0.1,wheelAngle);
+                        Control mForward = new Control(5.0,0.2,wheelAngle);
                         mqttSample.publishTopic("data", JSON.toJSONString(mForward));
                         Log.d(TAG, "第 "+(i++)+"次上传\n"+JSON.toJSONString(mForward));
                         moveVehicle(0.1,5.0,wheelAngle);
                         break;
                     case 2:
-                        Control mBackward = new Control(-5.0,0.1,wheelAngle);
+                        Control mBackward = new Control(-5.0,0.2,wheelAngle);
                         mqttSample.publishTopic("data", JSON.toJSONString(mBackward));
                         Log.d(TAG, "第 "+(i++)+"次上传\n"+JSON.toJSONString(mBackward));
                         moveVehicle(0.1,-5.0,wheelAngle);
                         break;
                     case 3:
-                        Control mBreak = new Control(0.0,-0.1,wheelAngle);
+                        Control mBreak = new Control(0.0,-0.2,wheelAngle);
                         mqttSample.publishTopic("data", JSON.toJSONString(mBreak));
                         Log.d(TAG, "第 "+(i++)+"次上传\n"+JSON.toJSONString(mBreak));
                         break;
Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/videomonitoring/VideoMonitor.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.dou361.jjdxm_ijkplayer.videomonitoring;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.app.Activity;\r\nimport android.content.Context;\r\nimport android.content.res.Configuration;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.os.PowerManager;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.RadioButton;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.alibaba.fastjson.JSON;\r\nimport com.bumptech.glide.Glide;\r\nimport com.dou361.ijkplayer.bean.VideoijkBean;\r\nimport com.dou361.ijkplayer.listener.OnShowThumbnailListener;\r\nimport com.dou361.ijkplayer.widget.PlayStateParams;\r\nimport com.dou361.ijkplayer.widget.PlayerView;\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.utlis.MediaUtils;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\n\r\nimport butterknife.ButterKnife;\r\nimport butterknife.OnClick;\r\nimport okhttp3.MediaType;\r\nimport okhttp3.OkHttpClient;\r\nimport okhttp3.Request;\r\nimport okhttp3.RequestBody;\r\nimport okhttp3.Response;\r\n\r\nimport static android.content.ContentValues.TAG;\r\n\r\npublic class VideoMonitor extends Activity implements View.OnClickListener , MyRadioGroup.OnCheckedChangeListener {\r\n\r\n    public String hostURL=\"http://10.6.206.20:30549/appBackend/\";\r\n    public CountDownTimer countDownTimer;\r\n    public VideoRequest videoRequest;\r\n    public VideoReply videoReply,videoReply2,videoReplyMethod;\r\n    public String videoResponseString;//视频Post请求返回数据\r\n    private PlayerView player;\r\n    private Context mContext;\r\n    private List<VideoijkBean> list;\r\n    private PowerManager.WakeLock wakeLock;\r\n    View rootView;\r\n    private MyRadioGroup videoRatioGroup;\r\n    private RadioButton buttonFront, buttonBack, buttonLeft, buttonRight, channelGodPerspective;\r\n    private HashMap<String, RadioButton> channels = new HashMap<>(5);\r\n    private ImageButton lightControllerButton;\r\n\r\n    private TextView replyTextView,requestTextView;\r\n\r\n    @SuppressLint(\"InvalidWakeLockTag\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        this.mContext = this;\r\n        rootView = getLayoutInflater().from(this).inflate(R.layout.activity_videomonitor, null);\r\n        setContentView(rootView);\r\n//        setContentView(R.layout.activity_main);\r\n        ButterKnife.bind(this);\r\n\r\n        lightControllerButton=(ImageButton) findViewById(R.id.light);\r\n        lightControllerButton.setOnClickListener(this);\r\n\r\n        buttonFront = (RadioButton) findViewById(R.id.front_Click);\r\n        buttonBack = (RadioButton)findViewById(R.id.back_Click);\r\n        buttonLeft = (RadioButton)findViewById(R.id.left_Click);\r\n        buttonRight = (RadioButton)findViewById(R.id.right_Click);\r\n        channelGodPerspective = (RadioButton)findViewById(R.id.god_perspective_Click);\r\n        buttonFront.setOnClickListener(this);\r\n        buttonBack.setOnClickListener(this);\r\n        buttonLeft.setOnClickListener(this);\r\n        buttonRight.setOnClickListener(this);\r\n        channelGodPerspective.setOnClickListener(this);\r\n        channels.put(\"Channel_Front\",buttonFront);\r\n        channels.put(\"Channel_Back\",buttonBack);\r\n        channels.put(\"Channel_Left\",buttonLeft);\r\n        channels.put(\"Channel_Right\",buttonRight);\r\n        channels.put(\"Channel_God_Perspective\", channelGodPerspective);\r\n\r\n//        replyTextView=findViewById(R.id.replyTextView);\r\n//        requestTextView=findViewById(R.id.requestTextView);\r\n\r\n\r\n        /**常亮*/\r\n        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);\r\n        wakeLock = pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK, \"liveTAG\");\r\n        wakeLock.acquire();\r\n\r\n\r\n        videoRatioGroup = (MyRadioGroup)findViewById(R.id.radiogroup);\r\n        videoRatioGroup.setOnCheckedChangeListener(new MyRadioGroup.OnCheckedChangeListener() {\r\n            @Override\r\n            public void onCheckedChanged(MyRadioGroup group, int checkedId) {\r\n                videoReply = new VideoReply(\"原始\");\r\n                videoReply2 = new VideoReply(\"融合\");\r\n\r\n//                replyTextView.setText(\"当前选择\"+checkedId);\r\n                switch (checkedId){\r\n                    case R.id.left_Click:\r\n                        try2play(3);\r\n                        break;\r\n                    case R.id.right_Click:\r\n                        try2play(4);\r\n                        break;\r\n                    case R.id.front_Click:\r\n                        try2play(0);\r\n                        break;\r\n                    case R.id.back_Click:\r\n                        try2play(2);\r\n                        break;\r\n                    case R.id.god_perspective_Click:\r\n                        try2play(5);\r\n                        break;\r\n                    default:\r\n                        Toast defualt =Toast.makeText(VideoMonitor.this, \"上帝\", Toast.LENGTH_SHORT);\r\n                        new ShowMyToast().showMyToast(defualt,100);\r\n                        break;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private void try2play(final int videoNum) {\r\n        videoReply.initialVideoReply();\r\n        videoReply2.initialVideoReply();\r\n        Log.d(TAG, \"Initial: videoReply1：\"+videoReply.toString()+\"\\nvideoReply2：\"+videoReply2.toString());\r\n\r\n        if (videoNum!=0){\r\n        countDownTimer=new CountDownTimer(10000,1000) {\r\n            int i=0;\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                i=i+1;\r\n//                replyTextView.setText(\"执行第\"+i+\"次请求：\"+videoReply.toString());\r\n                if (videoReply.getCode().equals(\"InitialString\")){\r\n                    String replyOriginalString = postVideoRequest(videoNum);\r\n                    if(replyOriginalString!=null){\r\n                        //当请求数据不为空时，设置videoReply类，，，，，反序列化操作即 由字符串--->对象\r\n                        videoReply = JSON.parseObject(replyOriginalString, VideoReply.class);}\r\n                }\r\n//                else if(videoReply.getCode().equals(\"0030000\"))//请求成功播放视频取消轮询\r\n                {playVideo(videoNum);\r\n                    cancel();}\r\n//                else\r\n//                {\r\n//                    replyTextView.setText(\"播放错误\");\r\n//                }\r\n            }\r\n            @Override\r\n            public void onFinish() {\r\n                replyTextView.setText(\"请求超时!\");\r\n            }\r\n        }.start();}\r\n        else {//播放前视角视频时有四种情况\r\n            countDownTimer=new CountDownTimer(10000,1000) {\r\n                int i=0;\r\n                @Override\r\n                public void onTick(long millisUntilFinished) {\r\n                    i=i+1;\r\n//                    replyTextView.setText(\"执行第\"+i+\"次请求：\"+videoReply.toString());\r\n                    if (videoReply.getCode().equals(\"InitialString\")){//原始視頻為初始數據\r\n                        if (videoReply2.getCode().equals(\"InitialString\")){//均為初始數據\r\n                            String replyOriginalFront = postVideoRequest(videoNum+1);//VideoNum是0，请求的是原始视频1和融合视频6\r\n                            if(replyOriginalFront!=null){\r\n                            videoReply = JSON.parseObject(replyOriginalFront, VideoReply.class);\r\n                            Log.d(TAG, \"onTick: replyOriginalFront\"+videoReply.toString());}\r\n\r\n                            String replyMergeFront=postVideoRequest(videoNum+6);//VideoNum是0，请求的是原始视频1和融合视频6\r\n                            if(replyMergeFront!=null){\r\n                            videoReply2 = JSON.parseObject(replyMergeFront, VideoReply.class);//兩個視頻都請求\r\n                            Log.d(TAG, \"onTick: replyMergeFront\"+videoReply2.toString());}\r\n//                        videoReply.setCode(\"00\"+i);\r\n                        }else {//融合視頻有數據\r\n                            String replyOriginalRetry = postVideoRequest(videoNum+1);\r\n                            if(replyOriginalRetry!=null){\r\n                            videoReply = JSON.parseObject(replyOriginalRetry, VideoReply.class);//繼續請求原始視頻\r\n                            Log.d(TAG, \"onTick: 融合视频成功，原始失败\");}\r\n                        }\r\n                    }\r\n                    else {//原始視頻已請求数据\r\n                            if (videoReply2.getCode().equals(\"InitialString\")){//融合視頻為初始數據\r\n                                String replyMergeRetry=postVideoRequest(videoNum+6);\r\n                                if(replyMergeRetry!=null){\r\n                                videoReply2 = JSON.parseObject(replyMergeRetry, VideoReply.class);\r\n                                Log.d(TAG, \"onTick: 原始视频成功，融合失败\");}\r\n//                                videoReply2.setCode(\"00\"+i);\r\n                            }else {//全部有數據\r\n                                Log.d(TAG, i+\"onTick: videoReply1：\"+videoReply.toString()+\"\\nvideoReply2：\"+videoReply2.toString());\r\n                                onFinish();//對code的四種狀態進行判斷\r\n                                cancel();\r\n                            }\r\n                    }\r\n                }\r\n\r\n                @Override\r\n                public void onFinish() {\r\n                    if(videoReply.getCode().equals(\"0030000\")){//原始視頻可用\r\n                        if (videoReply2.getCode().equals(\"0030000\")){\r\n                            playVideo(0);//最理想情況，同時可播倆視頻\r\n                        }else{\r\n                            playVideo(1);//融合視頻不可用，播放原始視頻\r\n                        }\r\n                    }\r\n                    else{//原始視頻不可用\r\n                        if (videoReply2.getCode().equals(\"0030000\")){\r\n                            playVideo(6);//只播融合視頻\r\n                        }else{\r\n//                            replyTextView.setText(\"WRONG!\");\r\n                        }\r\n                    }\r\n                }\r\n            }.start();\r\n        }\r\n    }\r\n\r\n    public String postVideoRequest(int videoNum){\r\n        videoRequest = new VideoRequest();\r\n        videoRequest.setUserId(\"6D\");\r\n        videoRequest.setVin(\"test\");\r\n        videoRequest.setVideo_type(Integer.toString(videoNum));\r\n        videoRequest.setServicetype(\"1\");\r\n        final String videoRequestJson = JSON.toJSONString(videoRequest);//序列化\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                try {\r\n                    requestTextView.setText(videoRequestJson);\r\n\r\n                    OkHttpClient videoClient=new OkHttpClient();\r\n                    Request videoRequest= new Request.Builder()\r\n                            .url(hostURL+\"videoRequest\")\r\n                            .post(RequestBody.create(MediaType.parse(\"application/json\"),videoRequestJson))\r\n                            .build();//创造HTTP请求\r\n\r\n                    //执行发送的指令\r\n                    Response videoResponse = videoClient.newCall(videoRequest).execute();\r\n                    videoResponseString=videoResponse.body().string();\r\n                    Log.d(\"Reply\",videoResponseString);\r\n                    replyTextView.setText(videoResponseString);\r\n//                    videoReply2 = JSON.parseObject(videoResponseString,VideoReply.class);\r\n                }catch (Exception e){\r\n                    e.printStackTrace();\r\n                    Log.d(\"POST失敗\", \"onClick: \"+e.toString());\r\n                    runOnUiThread(new Runnable() {\r\n                        @Override\r\n                        public void run() {\r\n                            Toast.makeText(VideoMonitor.this,\"請求視頻失败！\",Toast.LENGTH_LONG).show();\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }).start();\r\n        return videoResponseString;\r\n    }\r\n\r\n    public void playVideoUrl( String url){\r\n      Toast.makeText(VideoMonitor.this, \"請求成功！\", Toast.LENGTH_SHORT).show();\r\n      player = new PlayerView(VideoMonitor.this, rootView)\r\n              //.setTitle(\"前摄像\")\r\n              .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n              .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n              .forbidTouch(false)\r\n              .hideSteam(true)\r\n              .hideMenu(true)\r\n              .hideCenterPlayer(false)\r\n              .setNetWorkTypeTie(false)\r\n              .hideRotation(true) //隐藏旋转按钮\r\n              .setChargeTie(true, 480)//设置最长播放时间\r\n              .showThumbnail(new OnShowThumbnailListener() {\r\n                  @Override\r\n                  public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                      Glide.with(mContext)\r\n                              .load(R.drawable.pic_before_video)//\"http://cn.bing.com/az/hprichbg/rb/Dongdaemun_ZH-CN10736487148_1920x1080.jpg\"\r\n                              .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                              .error(R.color.cl_error)//加载错误之后的错误图\r\n                              .into(ivThumbnail);\r\n                  }\r\n              })\r\n             .setPlaySource(url)\r\n              .startPlay();\r\n    }\r\n\r\n    public void playVideo(int videoNum){\r\n\r\n        switch (videoNum){\r\n            case 0:\r\n                //前视角原始视频与融合视频在一个按钮，通过视频窗口内部按钮切换\r\n                Toast.makeText(VideoMonitor.this,\"請求成功！\",Toast.LENGTH_SHORT).show();\r\n                list = new ArrayList<VideoijkBean>();\r\n                //有部分视频加载有问题，这个视频是有声音显示不出图像的，没有解决http://fzkt-biz.oss-cn-hangzhou.aliyuncs.com/vedio/2f58be65f43946c588ce43ea08491515.mp4\r\n                //这里模拟一个本地视频的播放，视频需要将testvideo文件夹的视频放到安卓设备的内置sd卡根目录中\r\n                String url1 = \"http://ivi.bupt.edu.cn/hls/cctv1.m3u8\";//\"rtmp://150.158.176.170/live/1\";\r\n                String url2 = \"rtsp://150.158.176.170/test.mkv\";\r\n                VideoijkBean m1 = new VideoijkBean();\r\n                m1.setStream(\"原始视频\");\r\n                m1.setUrl(url1);\r\n                VideoijkBean m2 = new VideoijkBean();\r\n                m2.setStream(\"融合视频\");\r\n                m2.setUrl(url2);\r\n                list.add(m1);\r\n                list.add(m2);\r\n                player = new PlayerView(this, rootView) {\r\n                    @Override\r\n                    public PlayerView setPlaySource(List<VideoijkBean> list) {\r\n                        return super.setPlaySource(list);\r\n                    }\r\n                }\r\n                        //.setTitle(\"前摄像\")\r\n                        .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                        .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                        .forbidTouch(false)\r\n                        .hideSteam(false)\r\n                        .hideMenu(true)\r\n                        .hideCenterPlayer(true)\r\n                        .setNetWorkTypeTie(false)\r\n                        .hideRotation(true) //隐藏旋转按钮\r\n                        .setChargeTie(true,480)//设置最长播放时间\r\n                        .showThumbnail(new OnShowThumbnailListener() {\r\n                            @Override\r\n                            public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                                Glide.with(mContext)\r\n                                        .load(R.drawable.pic_before_video)//\"http://cn.bing.com/az/hprichbg/rb/Dongdaemun_ZH-CN10736487148_1920x1080.jpg\"\r\n                                        .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                        .error(R.color.cl_error)//加载错误之后的错误图\r\n                                        .into(ivThumbnail);\r\n                            }\r\n                        })\r\n                        .setPlaySource(list)\r\n                        .startPlay();\r\n                break;\r\n            case 1:\r\n                //只播原始視頻\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv1.m3u8\");\r\n                break;\r\n            case 2:\r\n                //后视角\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv2.m3u8\");\r\n                break;\r\n            case 3:\r\n                //左视角\r\n                playVideoUrl(\"rtsp://150.158.176.170/test.mkv\");\r\n                break;\r\n            case 4:\r\n                //右视角\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv4.m3u8\");\r\n                break;\r\n            case 5:\r\n                //上帝视角\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv5.m3u8\");\r\n                break;\r\n            case 6:\r\n                //只有融合視頻\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv6.m3u8\");\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n\r\n    @OnClick({R.id.light})\r\n    public void onClick(View view) {\r\n        switch (view.getId()) {\r\n            case R.id.light:\r\n                {   \r\n//                    requestTextView.setText(\"請求開燈/關燈\");\r\n                    }\r\n            break;\r\n\r\n        }\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        if (player != null) {\r\n            player.onPause();\r\n        }\r\n        /**demo的内容，恢复系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, true);\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        if (player != null) {\r\n            player.onResume();\r\n        }\r\n        /**demo的内容，暂停系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, false);\r\n        /**demo的内容，激活设备常亮状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.acquire();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onDestroy() {\r\n        super.onDestroy();\r\n        if (player != null) {\r\n            player.onDestroy();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onConfigurationChanged(Configuration newConfig) {\r\n        super.onConfigurationChanged(newConfig);\r\n        if (player != null) {\r\n            player.onConfigurationChanged(newConfig);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onBackPressed() {\r\n        if (player != null && player.onBackPressed()) {\r\n            return;\r\n        }\r\n        super.onBackPressed();\r\n        /**demo的内容，恢复设备亮度状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.release();\r\n        }\r\n    }\r\n\r\n\r\n    @Override\r\n    public void onCheckedChanged(MyRadioGroup group, int checkedId) {\r\n\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/dou361/jjdxm_ijkplayer/videomonitoring/VideoMonitor.java	(revision e962e336aaaab82d0b16a9fddf934ebf95847741)
+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/videomonitoring/VideoMonitor.java	(date 1610787520605)
@@ -41,7 +41,7 @@
 
 public class VideoMonitor extends Activity implements View.OnClickListener , MyRadioGroup.OnCheckedChangeListener {
 
-    public String hostURL="http://10.6.206.20:30549/appBackend/";
+    public String hostURL="http://vehicleroadcloud.faw.cn:60443/backend/appBackend/";
     public CountDownTimer countDownTimer;
     public VideoRequest videoRequest;
     public VideoReply videoReply,videoReply2,videoReplyMethod;
@@ -86,7 +86,7 @@
         channels.put("Channel_Left",buttonLeft);
         channels.put("Channel_Right",buttonRight);
         channels.put("Channel_God_Perspective", channelGodPerspective);
-
+//
 //        replyTextView=findViewById(R.id.replyTextView);
 //        requestTextView=findViewById(R.id.requestTextView);
 
Index: .idea/shelf/Uncommitted_changes_before_Update_at_2021_1_5_10_36_[Default_Changelist]/shelved.patch
===================================================================
--- .idea/shelf/Uncommitted_changes_before_Update_at_2021_1_5_10_36_[Default_Changelist]/shelved.patch	(revision e962e336aaaab82d0b16a9fddf934ebf95847741)
+++ .idea/shelf/Uncommitted_changes_before_Update_at_2021_1_5_10_36_[Default_Changelist]/shelved.patch	(revision e962e336aaaab82d0b16a9fddf934ebf95847741)
@@ -1,1000 +0,0 @@
-Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.app.Activity;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.content.res.AssetManager;\r\nimport android.content.res.Configuration;\r\nimport android.graphics.Color;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.os.Environment;\r\nimport android.os.Handler;\r\nimport android.os.Message;\r\nimport android.os.PowerManager;\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.AdapterView;\r\nimport android.widget.Button;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.Spinner;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.OnBackPressedCallback;\r\n\r\nimport com.alibaba.fastjson.JSON;\r\nimport com.bumptech.glide.Glide;\r\nimport com.dou361.ijkplayer.bean.VideoijkBean;\r\nimport com.dou361.ijkplayer.listener.OnPlayerBackListener;\r\nimport com.dou361.ijkplayer.listener.OnPlayerStartOrPauseListener;\r\nimport com.dou361.ijkplayer.listener.OnShowThumbnailListener;\r\nimport com.dou361.ijkplayer.widget.PlayStateParams;\r\nimport com.dou361.ijkplayer.widget.PlayerView;\r\nimport com.dou361.jjdxm_ijkplayer.MainActivity;\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\nimport com.dou361.jjdxm_ijkplayer.command.Control;\r\nimport com.dou361.jjdxm_ijkplayer.command.Gears;\r\nimport com.dou361.jjdxm_ijkplayer.command.Handbrake;\r\nimport com.dou361.jjdxm_ijkplayer.command.Video;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTRequest;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTSample;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.VideoMonitor;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.utlis.MediaUtils;\r\nimport com.tencent.iot.hub.device.android.core.log.TXMqttLogCallBack;\r\nimport com.tencent.iot.hub.device.android.core.util.TXLog;\r\nimport com.tencent.iot.hub.device.java.core.common.Status;\r\nimport com.tencent.iot.hub.device.java.core.mqtt.TXMqttActionCallBack;\r\n\r\n\r\nimport org.eclipse.paho.client.mqttv3.IMqttToken;\r\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\r\n\r\nimport java.io.BufferedReader;\r\nimport java.io.BufferedWriter;\r\nimport java.io.ByteArrayInputStream;\r\nimport java.io.File;\r\nimport java.io.FileReader;\r\nimport java.io.FileWriter;\r\nimport java.io.IOException;\r\nimport java.io.InputStreamReader;\r\nimport java.nio.charset.Charset;\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\n\r\nimport static android.os.SystemClock.uptimeMillis;\r\n\r\n/**\r\n 遥控车辆进行移动\r\n */\r\npublic class RemoteControl extends Activity {\r\n\r\n    public String hostIP = /*\"192.168.0.108:18081\";*/\"10.6.206.20:30549\";\r\n    public String userId = \"6D的安卓測試機\";\r\n    public String vin = \"001\";\r\n\r\n    private final static String mLogPath = Environment.getExternalStorageDirectory().getPath() + \"/tencent/\";\r\n\r\n    public CountDownTimer countDownTimer;\r\n    private MainActivity mParent;\r\n    private MQTTSample mqttSample;\r\n\r\n    private PlayerView player;\r\n    private Context mContext;\r\n    private TextView  Speed;\r\n    private List<VideoijkBean> list;\r\n    private PowerManager.WakeLock wakeLock;\r\n    private View rootView;\r\n    private Activity mActivity;\r\n\r\n    private static final String TAG = \"FullscreenActivity\";\r\n    private boolean braking = true;\r\n    private int gearGlobal=0;\r\n    private int handBrakeStatus = 0;\r\n    private Button LlightingButton;\r\n    private ImageButton imageButton_forward,imageButton_backward;\r\n    private ImageView app_video_play;\r\n    private Spinner Video_Modul_Spinner;\r\n\r\n    private double wheelAngle=0.0;\r\n    private double speed=0.0;\r\n\r\n\r\n\r\n    /*虛擬機*/\r\n/*\r\n    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"android_test_phone\";\r\n    private String mDevPSK  = \"KdV+RSnHAlmEpM75aWZQZg==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/android_test_phone/data\";\r\n*/\r\n\r\n    /*OPPO A57t*/\r\n/*    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"OPPOA57t\";\r\n    private String mDevPSK  = \"TbtnFhJDmRe7N41vDBRVtA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/OPPOA57t/data\";  */  // productID/DeviceName/TopicName\r\n\r\n    /*真车配置*/\r\n    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";\r\n    private String mProductID = \"KM8UZXZOV9\";\r\n    private String mDevName = \"android_test\";\r\n    private String mDevPSK  = \"+xRWqTlp0UPbwSKXVgiNxA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"KM8UZXZOV9/android_test/data\";    // productID/DeviceName/TopicName\r\n    private String mSubProductID = \"\"; // If you wont test gateway, let this to be null\r\n    private String mSubDevName = \"\";\r\n    private String mSubDevPsk = \"BuildConfig.SUB_DEVICE_PSK\";\r\n    private String mDevCertName = \"YOUR_DEVICE_NAME_cert.crt\";\r\n    private String mDevKeyName  = \"YOUR_DEVICE_NAME_private.key\";\r\n    private String mProductKey = \"BuildConfig.PRODUCT_KEY\";        // Used for dynamic register\r\n    private String mDevCert = \"\";           // Cert String\r\n    private String mDevPriv = \"\";           // Priv String\r\n\r\n    private volatile boolean mIsConnected=false;\r\n    ScalableImageView sImgView ;\r\n\r\n    @SuppressLint(\"InvalidWakeLockTag\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        Log.d(TAG, \"onCreate: \");\r\n        super.onCreate(savedInstanceState);\r\n        this.mContext = this;\r\n        this.mActivity = this;\r\n        rootView = getLayoutInflater().from(this).inflate(R.layout.activity_remote_control, null);\r\n\r\n        setContentView(rootView);\r\n\r\n        if (!mIsConnected) {\r\n            Log.d(TAG, \"onCreate: Connecting Mqtt\");\r\n            //轮询连接,万分感谢陈岩大佬\r\n            mqttSample= new MQTTSample(getApplication(), new SelfMqttActionCallBack(), mBrokerURL, mProductID, mDevName, mDevPSK,\r\n                    mDevCert, mDevPriv, mSubProductID, mSubDevName, mTestTopic, null, null, true, new SelfMqttLogCallBack());\r\n            Log.d(TAG, \"onCreate: mqttSample\"+mqttSample.toString());\r\n            mqttSample.connect();\r\n            sleep(2000);}\r\n\r\n        mqttSample.subscribeTopic();\r\n\r\n\r\n        shiftHandbrake(1);\r\n        Log.d(TAG, \"onCreate: \");\r\n\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                 while (true) {\r\n                     if(braking){\r\n                    try {\r\n                        moveVehicle(-0.1,0.0,wheelAngle);\r\n                        sleep(50);\r\n                    } catch (Exception e) {\r\n                        e.printStackTrace();\r\n                    }}\r\n            }\r\n        }}).start();\r\n\r\n        /**常亮*/\r\n        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);\r\n        wakeLock = pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK, \"liveTAG\");\r\n        wakeLock.acquire();\r\n\r\n        CompentOnTouch compentOnTouch = new CompentOnTouch();\r\n\r\n        //返回键\r\n        findViewById(R.id.back2).setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View V){\r\n                //对话框\r\n                View my_view = LayoutInflater.from(RemoteControl.this).inflate(R.layout.my_dialog,null,false);\r\n                final AlertDialog dialog = new AlertDialog.Builder(RemoteControl.this).setView(my_view).create();\r\n                TextView Title = my_view.findViewById(R.id.title);\r\n                TextView Context = my_view.findViewById(R.id.content);\r\n                Title.setText(\"结束挪车\");\r\n                Context.setText(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");\r\n                ImageButton Confirm = my_view.findViewById(R.id.confirm);\r\n                ImageButton cancel = my_view.findViewById(R.id.cancel);\r\n                Confirm.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n                        finish();\r\n                        Intent intent=new Intent(RemoteControl.this, MainActivity.class);\r\n                        startActivity(intent);\r\n                        dialog.dismiss();\r\n                    }\r\n                });\r\n                cancel.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n                        Toast.makeText(RemoteControl.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                        player.startPlay();\r\n                        dialog.dismiss();\r\n                    }\r\n                });\r\n                dialog.show();\r\n                player.onPause();\r\n                dialog.getWindow().setLayout(1000,600);\r\n            }\r\n        });\r\n\r\n        imageButton_forward=findViewById(R.id.forward);\r\n        imageButton_forward.setOnTouchListener(compentOnTouch);\r\n\r\n        imageButton_backward=findViewById(R.id.backward);\r\n        imageButton_backward.setOnTouchListener(compentOnTouch);\r\n        sImgView = findViewById(R.id.steering_wheel);\r\n\r\n        //方向盘角度在速度处显示\r\n        countDownTimer=new CountDownTimer(1000000,200) {\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                wheelAngle = sImgView.getmDegree();\r\n                Speed = findViewById(R.id.speed);\r\n                Speed.setText(String.valueOf((int)wheelAngle));\r\n            }\r\n            @Override\r\n            public void onFinish() {\r\n            }\r\n        }.start();\r\n\r\n        //下拉单选按钮\r\n        Video_Modul_Spinner = (Spinner)findViewById(R.id.Spinner_VIdeo_Model);\r\n        Video_Modul_Spinner.setOutlineSpotShadowColor(Color.BLUE);\r\n        Video_Modul_Spinner.setSelection(0);//进入不会自动播放\r\n        Video_Modul_Spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener(){\r\n            @Override\r\n            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {\r\n                    String result = parent.getItemAtPosition(position).toString();\r\n                    Toast.makeText(RemoteControl.this, result, Toast.LENGTH_SHORT).show();\r\n                    switch (position) {\r\n                        case 0: {\r\n                            /**前摄像*/\r\n                            list = new ArrayList<VideoijkBean>();\r\n                            String url1 = \"http://ivi.bupt.edu.cn/hls/cctv13.m3u8\";\r\n                            String url2 = \"rtmp://150.158.176.170/live/test_vin_1\";\r\n                            VideoijkBean m1 = new VideoijkBean();\r\n                            m1.setStream(\"原始视频\");\r\n                            m1.setUrl(url1);\r\n                            VideoijkBean m2 = new VideoijkBean();\r\n                            m2.setStream(\"融合视频\");\r\n                            m2.setUrl(url2);\r\n                            list.add(m1);\r\n                            list.add(m2);\r\n                            player = new PlayerView(mActivity, rootView)\r\n                                    .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                                    .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                                    .forbidTouch(false)\r\n                                    .hideSteam(false)\r\n                                    .hideMenu(true)\r\n                                    .hideCenterPlayer(true)\r\n                                    .hideBack(false)\r\n                                    .setOnlyFullScreen(true)\r\n                                    .setNetWorkTypeTie(false)\r\n                                    .hideRotation(true)\r\n                                    .hideFullscreen(true)\r\n                                    .hideBack(true)\r\n                                    .setChargeTie(true, 480)//设置最长播放时间\r\n                                    .showThumbnail(new OnShowThumbnailListener() {\r\n                                        @Override\r\n                                        public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                                            Glide.with(mContext)\r\n                                                    .load(R.drawable.pic_before_video)\r\n                                                    .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                                    .error(R.color.cl_error)//加载错误之后的错误图\r\n                                                    .into(ivThumbnail);\r\n                                        }\r\n                                    })\r\n                                    .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                                        @Override\r\n                                        public void onStartOrPause() {\r\n                                            //对话框\r\n                                            AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                                            builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                                            builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                                            builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    player.startPlay();\r\n                                                }\r\n                                            });\r\n                                            builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    finish();\r\n                                                    Intent intent=new Intent(RemoteControl.this,MainActivity.class);\r\n                                                    startActivity(intent);\r\n                                                }\r\n                                            });\r\n                                            AlertDialog b=builder.create();\r\n                                            b.show();\r\n                                        }\r\n                                    })\r\n                                    .setPlaySource(list)\r\n                                    .startPlay();\r\n                        }\r\n                        break;\r\n\r\n                        case 1: {\r\n                            /**后摄像*/\r\n                            String url3 = \"http://ivi.bupt.edu.cn/hls/cctv2.m3u8\";\r\n                            playVideoUrl(url3);\r\n                        }\r\n                        break;\r\n\r\n                        case 2: {\r\n                            /**左摄像*/\r\n                            String url4 = \"http://ivi.bupt.edu.cn/hls/cctv3.m3u8\";\r\n                            playVideoUrl(url4);\r\n                        }\r\n                        break;\r\n\r\n                        case 3: {\r\n                            /**右摄像*/\r\n                            String url5 = \"http://ivi.bupt.edu.cn/hls/cctv4.m3u8\";\r\n                            playVideoUrl(url5);\r\n\r\n                        }\r\n                        break;\r\n\r\n                        case 4: {\r\n                            /**上帝*/\r\n                            String url6 = \"http://ivi.bupt.edu.cn/hls/cctv13.m3u8\";\r\n                            playVideoUrl(url6);\r\n                        }\r\n                        break;\r\n\r\n                        default:\r\n                            break;\r\n                    }\r\n\r\n            }\r\n            @Override\r\n            public void onNothingSelected(AdapterView<?> parent) { }\r\n        });\r\n\r\n    }\r\n\r\n    //后四个视频播放器播放\r\n    public  void playVideoUrl( String url){\r\n        player = new PlayerView(mActivity, rootView)\r\n                .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                .forbidTouch(false)\r\n                .hideSteam(true)\r\n                .hideMenu(true)\r\n                .hideCenterPlayer(true)\r\n                .hideBack(false)\r\n                .setOnlyFullScreen(true)\r\n                .setNetWorkTypeTie(false)\r\n                .hideRotation(true)\r\n                .hideFullscreen(true)\r\n                .hideBack(true)\r\n                .setChargeTie(true, 480)//设置最长播放时间\r\n                .showThumbnail(new OnShowThumbnailListener() {\r\n                    @Override\r\n                    public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                        Glide.with(mContext)\r\n                                .load(R.drawable.pic_before_video)\r\n                                .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                .error(R.color.cl_error)//加载错误之后的错误图\r\n                                .into(ivThumbnail);\r\n                    }\r\n                })\r\n                .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                    @Override\r\n                    public void onStartOrPause() {\r\n                        //对话框\r\n                        AlertDialog.Builder builder = new AlertDialog.Builder(mContext);\r\n                        builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                        builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                        builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                player.startPlay();\r\n                            }\r\n                        });\r\n                        builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                finish();\r\n                                Intent intent = new Intent(RemoteControl.this, MainActivity.class);\r\n                                startActivity(intent);\r\n                            }\r\n                        });\r\n                        AlertDialog b = builder.create();\r\n                        b.show();\r\n                    }\r\n                })\r\n                .setPlaySource(url)\r\n                .startPlay();\r\n    }\r\n\r\n\r\n    /**\r\n    1表示手刹释放，0表示手刹锁定\r\n     **/\r\n\r\n    private void shiftHandbrake(int handbrakeToSet) {\r\n        if(handbrakeToSet!=handBrakeStatus){\r\n            for(int i=0;i<5;i++){\r\n                Handbrake mHandbrake = new Handbrake();\r\n                mHandbrake.setTimestamp(System.currentTimeMillis());\r\n                mHandbrake.setStatus(handbrakeToSet);\r\n                mHandbrake.setType(14);\r\n                mHandbrake.setTaskid(\"6D\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mHandbrake));\r\n                Log.d(TAG, \"onClick: 手刹\"+JSON.toJSONString(mHandbrake));\r\n                sleep(50);\r\n            }\r\n            handBrakeStatus=handbrakeToSet;}\r\n        else return;\r\n    }\r\n\r\n    /**\r\n    1,2,3,4分別對應P,R,N,D四個檔位\r\n     **/\r\n    private void shiftGear(final int gear){\r\n//        if(speed==0){\r\n        for(int i=0;i<10;i++){\r\n                Gears mGear = new Gears();\r\n                mGear.setTimestamp(System.currentTimeMillis());\r\n                Log.d(TAG, \"onClick: \"+System.currentTimeMillis());\r\n                mGear.setGear(gear);\r\n                mGear.setType(13);\r\n                mGear.setTaskid(\"手機挂\"+gear+\"档\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mGear));\r\n                Log.d(TAG, \"onClick: \"+JSON.toJSONString(mGear));\r\n                sleep(50);\r\n        }\r\n        gearGlobal=gear;\r\n//    }\r\n//        else {\r\n//            moveVehicle(-0.3,0.0,0.0);\r\n//            shiftGear(gear);\r\n//        }\r\n    }\r\n\r\n    /**\r\n\r\n     @videoType\r\n     1为前方原始视频流，2为后方原始视频流，3为左侧原始视频流，4为右侧原始视频流，5为感知融合视频流，6为上帝视角视频流\r\n     @videoStatus\r\n     1为打开，0为关闭\r\n     */\r\n    private void shiftVideoType(int videoType,int videoStatus){\r\n        Video mVideo = new Video();\r\n        mVideo.setTimestamp(System.currentTimeMillis());\r\n        mVideo.setVideo_type(videoType);\r\n        mVideo.setOperation(videoStatus);\r\n        mVideo.setType(12);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        mqttSample.publishTopic(\"data\", JSON.toJSONString(mVideo));\r\n        Log.d(TAG, \"onClick: \"+JSON.toJSONString(mVideo));\r\n    }\r\n\r\n    /**\r\n     * @acceleration 加速度，正是加速，負的是減速\r\n     * @speed 目標速度\r\n     * @wheelAngle 方向盤轉角\r\n     */\r\n    private void moveVehicle(Double acceleration,Double speed,Double wheelAngle){\r\n        Control mMove = new Control();\r\n        mMove.setTimestamp(System.currentTimeMillis());\r\n        mMove.setAcceleration(acceleration);\r\n        mMove.setSpeed(speed);\r\n        mMove.setType(11);\r\n        mMove.setWheel_angle(wheelAngle);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        //mqttSample.publishTopic(\"data\", JSON.toJSONString(mMove));\r\n        //Log.d(TAG, \"onClick: 上传刹车\"+JSON.toJSONString(mMove));\r\n    }\r\n\r\n    @Override\r\n    protected void onPostCreate(Bundle savedInstanceState) {\r\n        super.onPostCreate(savedInstanceState);\r\n    }\r\n\r\n\r\n\r\n\r\n    //ms为需要休眠的时长\r\n    public static void sleep(long ms)\r\n    {\r\n        //uptimeMillis() Returns milliseconds since boot, not counting time spent in deep sleep.\r\n        long start = uptimeMillis();\r\n        long duration = ms;\r\n        boolean interrupted = false;\r\n        do {\r\n            try {\r\n                Thread.sleep(duration);\r\n            }\r\n            catch (InterruptedException e) {\r\n                interrupted = true;\r\n            }\r\n            duration = start + ms - uptimeMillis();\r\n        } while (duration > 0);\r\n\r\n        if (interrupted) {\r\n            Thread.currentThread().interrupt();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttActionCallBack回调接口\r\n     */\r\n    private class SelfMqttActionCallBack extends TXMqttActionCallBack {\r\n\r\n        @Override\r\n        public void onConnectCompleted(Status status, boolean reconnect, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onConnectCompleted, status[%s], reconnect[%b], userContext[%s], msg[%s]\",\r\n                    status.name(), reconnect, userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            if(status==Status.OK){\r\n             mIsConnected = true;}\r\n        }\r\n\r\n        @Override\r\n        public void onConnectionLost(Throwable cause) {\r\n            String logInfo = String.format(\"onConnectionLost, cause[%s]\", cause.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onDisconnectCompleted(Status status, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onDisconnectCompleted, status[%s], userContext[%s], msg[%s]\", status.name(), userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            mIsConnected = false;\r\n        }\r\n\r\n        @Override\r\n        public void onPublishCompleted(Status status, IMqttToken token, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onPublishCompleted, status[%s], topics[%s],  userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(token.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            if (Status.ERROR == status) {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            } else {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public void onUnSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onUnSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onMessageReceived(final String topic, final MqttMessage message) {\r\n            String logInfo = String.format(\"receive command, topic[%s], message[%s]\", topic, message.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttLogCallBack回调接口\r\n     */\r\n    private class SelfMqttLogCallBack extends TXMqttLogCallBack {\r\n\r\n        @Override\r\n        public String setSecretKey() {\r\n            String secertKey;\r\n            if (mDevPSK != null && mDevPSK.length() != 0) {  //密钥认证\r\n                secertKey = mDevPSK;\r\n                secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                return secertKey;\r\n            } else {\r\n                BufferedReader cert;\r\n\r\n                if (mDevCert != null && mDevCert.length() != 0) { //动态注册,从DevCert中读取\r\n                    cert = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(mDevCert.getBytes(Charset.forName(\"utf8\"))), Charset.forName(\"utf8\")));\r\n\r\n                } else { //证书认证，从证书文件中读取\r\n                    AssetManager assetManager = mParent.getAssets();\r\n                    if (assetManager == null) {\r\n                        return null;\r\n                    }\r\n                    try {\r\n                        cert=new BufferedReader(new InputStreamReader(assetManager.open(mDevCertName)));\r\n                    } catch (IOException e) {\r\n//                        mParent.printLogInfo(TAG, \"getSecertKey failed, cannot open CRT Files.\",mLogInfoText);\r\n                        return null;\r\n                    }\r\n                }\r\n                //获取密钥\r\n                try {\r\n                    if (cert.readLine().contains(\"-----BEGIN\")) {\r\n                        secertKey = cert.readLine();\r\n                        secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                    } else {\r\n                        secertKey = null;\r\n//                        mParent.printLogInfo(TAG,\"Invaild CRT Files.\", mLogInfoText);\r\n                    }\r\n                    cert.close();\r\n                } catch (IOException e) {\r\n                    TXLog.e(TAG, \"getSecertKey failed.\", e);\r\n//                    mParent.printLogInfo(TAG,\"getSecertKey failed.\", mLogInfoText);\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return secertKey;\r\n        }\r\n\r\n        @Override\r\n        public void printDebug(String message){\r\n//            mParent.printLogInfo(TAG, message, mLogInfoText);\r\n            //TXLog.d(TAG,message);\r\n        }\r\n\r\n        @Override\r\n        public boolean saveLogOffline(String log){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"saveLogOffline not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Save log to %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedWriter wLog = new BufferedWriter(new FileWriter(new File(logFilePath), true));\r\n                wLog.write(log);\r\n                wLog.flush();\r\n                wLog.close();\r\n                return true;\r\n            } catch (IOException e) {\r\n                String logInfo = String.format(\"Save log to [%s] failed, check the Storage permission!\", logFilePath);\r\n//                mParent.printLogInfo(TAG,logInfo, mLogInfoText);\r\n                e.printStackTrace();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public String readOfflineLog(){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"readOfflineLog not ready\", mLogInfoText);\r\n                return null;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Read log from %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedReader logReader = new BufferedReader(new FileReader(logFilePath));\r\n                StringBuilder offlineLog = new StringBuilder();\r\n                int data;\r\n                while (( data = logReader.read()) != -1 ) {\r\n                    offlineLog.append((char)data);\r\n                }\r\n                logReader.close();\r\n                return offlineLog.toString();\r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n                return null;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public boolean delOfflineLog(){\r\n\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"delOfflineLog not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            File file = new File(logFilePath);\r\n            if (file.exists() && file.isFile()) {\r\n                if (file.delete()) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    class\r\n    CompentOnTouch implements View.OnTouchListener {\r\n\r\n        public boolean isOnLongClick=false;\r\n        int i = 0;\r\n\r\n        @Override\r\n        public boolean onTouch(View view, MotionEvent motionEvent) {\r\n\r\n            switch (view.getId()) {\r\n// 这是btnMius下的一个层，为了增强易点击性\r\n                case R.id.backward:\r\n                    onTouchChange(\"backward\", motionEvent.getAction());\r\n                    break;\r\n// 这里也写，是为了增强易点击性\r\n                case R.id.forward:\r\n                    onTouchChange(\"forward\", motionEvent.getAction());\r\n                    break;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        private void onTouchChange(String methodName, int eventAction) {\r\n            Log.d(TAG, \"onTouchChange: \"+methodName+eventAction);\r\n            braking =false;\r\n// 按下松开分别对应启动停止前进方法\r\n            if (\"backward\".equals(methodName)) {\r\n//                if(gearGlobal!=2){ shiftGear(2);}\r\n                MiusThread miusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    miusThread = new MiusThread();\r\n                    isOnLongClick = true;\r\n                    miusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\"+ braking);\r\n//                    Log.d(TAG, \"onTouchChange: isOnLongClick=false\"+miusThread.isInterrupted());\r\n                    if (miusThread != null) {\r\n                        miusThread.interrupt();\r\n                        Log.d(TAG, \"onTouchChange: 终止线程\");\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (miusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n// 按下松开分别对应启动停止加线程方法\r\n            else if (\"forward\".equals(methodName)) {\r\n//                if(gearGlobal!=4){ shiftGear(4);}\r\n                PlusThread plusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    plusThread = new PlusThread();\r\n                    isOnLongClick = true;\r\n                    plusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\");\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        // 后退操作\r\n        class MiusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(2);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n\r\n        // 前进操作\r\n        class PlusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(1);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n        Handler myHandler = new Handler() {\r\n            public void handleMessage(Message msg) {\r\n                switch (msg.what) {\r\n                    case 1:\r\n                        //前进操作\r\n//                        Control mForward = new Control(5.0,0.1,wheelAngle);\r\n//                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mForward));\r\n//                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mForward));\r\n                        moveVehicle(0.1,5.0,wheelAngle);\r\n                        break;\r\n                    case 2:\r\n//                        Control mBackward = new Control(-5.0,0.1,wheelAngle);\r\n//                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBackward));\r\n//                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBackward));\r\n                        moveVehicle(0.1,-5.0,wheelAngle);\r\n                        Log.d(\"TAG\",\"Backward:\"+i--);\r\n                        break;\r\n                    case 3:\r\n                        Control mBreak = new Control(0.0,-0.1,wheelAngle);\r\n                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBreak));\r\n                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBreak));\r\n                        break;\r\n                }\r\n            };\r\n        };\r\n    }\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        if (player != null) {\r\n            player.onPause();\r\n        }\r\n        /**demo的内容，恢复系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, true);\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        if (player != null) {\r\n            player.onResume();\r\n        }\r\n        /**demo的内容，暂停系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, false);\r\n        /**demo的内容，激活设备常亮状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.acquire();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onDestroy() {\r\n        super.onDestroy();\r\n        if (player != null) {\r\n            for(int i=1;i<7;i++){\r\n            shiftVideoType(i,0);}\r\n            player.onDestroy();\r\n        }\r\n        if(speed!=0){moveVehicle(-0.3,0.0,0.0);}\r\n        if(braking){braking=false;}\r\n//        if(gearGlobal!=1){shiftGear(1);}\r\n        if(handBrakeStatus==1){shiftHandbrake(0);}\r\n        if(mIsConnected){mqttSample.disconnect();}\r\n\r\n        Log.d(TAG, \"onDestroy: 斷開視頻以及MQTT連接\");\r\n    }\r\n\r\n    @Override\r\n    public void onConfigurationChanged(Configuration newConfig) {\r\n        super.onConfigurationChanged(newConfig);\r\n        if (player != null) {\r\n            player.onConfigurationChanged(newConfig);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onBackPressed() {\r\n        if (player != null && player.onBackPressed()) {\r\n            return;\r\n        }\r\n//        super.onBackPressed();\r\n        //对话框\r\n        AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n        builder.setTitle(\"结束挪车\");//设置对话框的标题\r\n        builder.setMessage(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");//设置对话框的内容\r\n        builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n            @Override\r\n            public void onClick(DialogInterface arg0, int arg1) {\r\n                finish();\r\n                Intent intent=new Intent(RemoteControl.this, MainActivity.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n        builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n            @Override\r\n            public void onClick(DialogInterface arg0, int arg1) {\r\n                Toast.makeText(RemoteControl.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                player.startPlay();\r\n            }\r\n        });\r\n        AlertDialog b=builder.create();\r\n        b.show();\r\n        player.onPause();\r\n        /**demo的内容，恢复设备亮度状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.release();\r\n        }\r\n    }\r\n}\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
---- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(date 1609813797873)
-@@ -96,10 +96,11 @@
- 
-     private static final String TAG = "FullscreenActivity";
-     private boolean braking = true;
-+    private boolean active_braking=false;
-     private int gearGlobal=0;
-     private int handBrakeStatus = 0;
-     private Button LlightingButton;
--    private ImageButton imageButton_forward,imageButton_backward;
-+    private ImageButton imageButton_forward,imageButton_backward,imageButton_brake;
-     private ImageView app_video_play;
-     private Spinner Video_Modul_Spinner;
- 
-@@ -153,7 +154,7 @@
- 
-         setContentView(rootView);
- 
--        if (!mIsConnected) {
-+        while (!mIsConnected) {
-             Log.d(TAG, "onCreate: Connecting Mqtt");
-             //轮询连接,万分感谢陈岩大佬
-             mqttSample= new MQTTSample(getApplication(), new SelfMqttActionCallBack(), mBrokerURL, mProductID, mDevName, mDevPSK,
-@@ -174,7 +175,11 @@
-                  while (true) {
-                      if(braking){
-                     try {
--                        moveVehicle(-0.1,0.0,wheelAngle);
-+                        if (active_braking){
-+                            moveVehicle(-1.0,0.0,wheelAngle);
-+                        }
-+                        else {
-+                        moveVehicle(-0.1,0.0,wheelAngle);}
-                         sleep(50);
-                     } catch (Exception e) {
-                         e.printStackTrace();
-@@ -230,6 +235,9 @@
- 
-         imageButton_backward=findViewById(R.id.backward);
-         imageButton_backward.setOnTouchListener(compentOnTouch);
-+
-+        imageButton_brake=findViewById(R.id.brake);
-+        imageButton_brake.setOnTouchListener(compentOnTouch);
-         sImgView = findViewById(R.id.steering_wheel);
- 
-         //方向盘角度在速度处显示
-@@ -247,7 +255,7 @@
- 
-         //下拉单选按钮
-         Video_Modul_Spinner = (Spinner)findViewById(R.id.Spinner_VIdeo_Model);
--        Video_Modul_Spinner.setOutlineSpotShadowColor(Color.BLUE);
-+//        Video_Modul_Spinner.setOutlineSpotShadowColor(Color.BLUE);
-         Video_Modul_Spinner.setSelection(0);//进入不会自动播放
-         Video_Modul_Spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener(){
-             @Override
-@@ -258,8 +266,8 @@
-                         case 0: {
-                             /**前摄像*/
-                             list = new ArrayList<VideoijkBean>();
--                            String url1 = "http://ivi.bupt.edu.cn/hls/cctv13.m3u8";
--                            String url2 = "rtmp://150.158.176.170/live/test_vin_1";
-+                            String url1 = "rtmp://150.158.176.170/live/test_vin_1";
-+                            String url2 = "rtmp://150.158.176.170:1935/live/test";
-                             VideoijkBean m1 = new VideoijkBean();
-                             m1.setStream("原始视频");
-                             m1.setUrl(url1);
-@@ -326,21 +334,21 @@
- 
-                         case 1: {
-                             /**后摄像*/
--                            String url3 = "http://ivi.bupt.edu.cn/hls/cctv2.m3u8";
-+                            String url3 = "rtmp://150.158.176.170/live/test_vin_2";
-                             playVideoUrl(url3);
-                         }
-                         break;
- 
-                         case 2: {
-                             /**左摄像*/
--                            String url4 = "http://ivi.bupt.edu.cn/hls/cctv3.m3u8";
-+                            String url4 = "rtmp://150.158.176.170/live/test_vin_3";
-                             playVideoUrl(url4);
-                         }
-                         break;
- 
-                         case 3: {
-                             /**右摄像*/
--                            String url5 = "http://ivi.bupt.edu.cn/hls/cctv4.m3u8";
-+                            String url5 = "rtmp://150.158.176.170/live/test_vin_4";
-                             playVideoUrl(url5);
- 
-                         }
-@@ -499,8 +507,8 @@
-         mMove.setType(11);
-         mMove.setWheel_angle(wheelAngle);
-         // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据
--        //mqttSample.publishTopic("data", JSON.toJSONString(mMove));
--        //Log.d(TAG, "onClick: 上传刹车"+JSON.toJSONString(mMove));
-+        mqttSample.publishTopic("data", JSON.toJSONString(mMove));
-+        Log.d(TAG, "onClick: 上传指令"+JSON.toJSONString(mMove));
-     }
- 
-     @Override
-@@ -752,7 +760,6 @@
- 
-         @Override
-         public boolean onTouch(View view, MotionEvent motionEvent) {
--
-             switch (view.getId()) {
- // 这是btnMius下的一个层，为了增强易点击性
-                 case R.id.backward:
-@@ -762,6 +769,9 @@
-                 case R.id.forward:
-                     onTouchChange("forward", motionEvent.getAction());
-                     break;
-+                case R.id.brake:
-+                    active_braking=true;
-+                    break;
-             }
-             return true;
-         }
-@@ -769,9 +779,10 @@
-         private void onTouchChange(String methodName, int eventAction) {
-             Log.d(TAG, "onTouchChange: "+methodName+eventAction);
-             braking =false;
-+            active_braking=false;
- // 按下松开分别对应启动停止前进方法
-             if ("backward".equals(methodName)) {
--//                if(gearGlobal!=2){ shiftGear(2);}
-+                if(gearGlobal!=2){ shiftGear(2);}
-                 MiusThread miusThread = null;
-                 if (eventAction == MotionEvent.ACTION_DOWN) {
-                     miusThread = new MiusThread();
-@@ -795,7 +806,7 @@
-             }
- // 按下松开分别对应启动停止加线程方法
-             else if ("forward".equals(methodName)) {
--//                if(gearGlobal!=4){ shiftGear(4);}
-+                if(gearGlobal!=4){ shiftGear(4);}
-                 PlusThread plusThread = null;
-                 if (eventAction == MotionEvent.ACTION_DOWN) {
-                     plusThread = new PlusThread();
-@@ -873,17 +884,16 @@
-                 switch (msg.what) {
-                     case 1:
-                         //前进操作
--//                        Control mForward = new Control(5.0,0.1,wheelAngle);
--//                        mqttSample.publishTopic("data", JSON.toJSONString(mForward));
--//                        Log.d(TAG, "第 "+(i++)+"次上传\n"+JSON.toJSONString(mForward));
-+                        Control mForward = new Control(5.0,0.1,wheelAngle);
-+                        mqttSample.publishTopic("data", JSON.toJSONString(mForward));
-+                        Log.d(TAG, "第 "+(i++)+"次上传\n"+JSON.toJSONString(mForward));
-                         moveVehicle(0.1,5.0,wheelAngle);
-                         break;
-                     case 2:
--//                        Control mBackward = new Control(-5.0,0.1,wheelAngle);
--//                        mqttSample.publishTopic("data", JSON.toJSONString(mBackward));
--//                        Log.d(TAG, "第 "+(i++)+"次上传\n"+JSON.toJSONString(mBackward));
-+                        Control mBackward = new Control(-5.0,0.1,wheelAngle);
-+                        mqttSample.publishTopic("data", JSON.toJSONString(mBackward));
-+                        Log.d(TAG, "第 "+(i++)+"次上传\n"+JSON.toJSONString(mBackward));
-                         moveVehicle(0.1,-5.0,wheelAngle);
--                        Log.d("TAG","Backward:"+i--);
-                         break;
-                     case 3:
-                         Control mBreak = new Control(0.0,-0.1,wheelAngle);
-@@ -930,7 +940,7 @@
-         }
-         if(speed!=0){moveVehicle(-0.3,0.0,0.0);}
-         if(braking){braking=false;}
--//        if(gearGlobal!=1){shiftGear(1);}
-+        if(gearGlobal!=1){shiftGear(1);}
-         if(handBrakeStatus==1){shiftHandbrake(0);}
-         if(mIsConnected){mqttSample.disconnect();}
- 
-Index: app/src/main/res/layout/activity_remote_control.xml
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".remotecontrol.RemoteControl\">\r\n\r\n\r\n    <ImageButton\r\n        android:id=\"@+id/light\"\r\n        android:layout_width=\"200px\"\r\n        android:layout_height=\"200px\"\r\n        android:layout_marginEnd=\"10dp\"\r\n        android:layout_marginBottom=\"10dp\"\r\n        android:background=\"#00000000\"\r\n        android:scaleType=\"fitXY\"\r\n        android:src=\"@drawable/light\"\r\n        app:layout_constraintBottom_toTopOf=\"@+id/remove_bottombar_2\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\" />\r\n\r\n    <Spinner\r\n        android:id=\"@+id/Spinner_VIdeo_Model\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginTop=\"30dp\"\r\n        android:layout_marginStart=\"60dp\"\r\n        android:entries=\"@array/Video_Model\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/remove_topbar_2\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        />\r\n\r\n    <include\r\n        layout=\"@layout/simple_player_view_player\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\"\r\n        android:layout_marginLeft=\"200dp\"\r\n        android:layout_marginRight=\"100dp\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n    <include\r\n        android:id=\"@+id/remove_topbar_2\"\r\n        layout=\"@layout/remove_topbar\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        android:layout_marginTop=\"10dp\"\r\n        />\r\n\r\n    <include\r\n        android:id=\"@+id/remove_bottombar_2\"\r\n        layout=\"@layout/remove_bottombar\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        android:layout_marginBottom=\"10dp\"\r\n       />\r\n\r\n\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
---- app/src/main/res/layout/activity_remote_control.xml	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-+++ app/src/main/res/layout/activity_remote_control.xml	(date 1609744752255)
-@@ -16,6 +16,17 @@
-         android:background="#00000000"
-         android:scaleType="fitXY"
-         android:src="@drawable/light"
-+        app:layout_constraintTop_toBottomOf="@id/remove_topbar_2"
-+        app:layout_constraintEnd_toEndOf="parent" />
-+    <ImageButton
-+        android:id="@+id/brake"
-+        android:layout_width="200px"
-+        android:layout_height="200px"
-+        android:layout_marginEnd="10dp"
-+        android:layout_marginBottom="10dp"
-+        android:background="#00000000"
-+        android:scaleType="fitXY"
-+        android:src="@drawable/brake"
-         app:layout_constraintBottom_toTopOf="@+id/remove_bottombar_2"
-         app:layout_constraintEnd_toEndOf="parent" />
- 
-Index: .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_9_28_[Default_Changelist]/shelved.patch
-===================================================================
---- .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_9_28_[Default_Changelist]/shelved.patch	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-+++ .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_9_28_[Default_Changelist]/shelved.patch	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-@@ -1,198 +0,0 @@
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.app.Activity;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.content.res.AssetManager;\r\nimport android.content.res.Configuration;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.os.Environment;\r\nimport android.os.Handler;\r\nimport android.os.Message;\r\nimport android.os.PowerManager;\r\nimport android.util.Log;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.AdapterView;\r\nimport android.widget.Button;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.Spinner;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.OnBackPressedCallback;\r\n\r\nimport com.alibaba.fastjson.JSON;\r\nimport com.bumptech.glide.Glide;\r\nimport com.dou361.ijkplayer.bean.VideoijkBean;\r\nimport com.dou361.ijkplayer.listener.OnPlayerBackListener;\r\nimport com.dou361.ijkplayer.listener.OnPlayerStartOrPauseListener;\r\nimport com.dou361.ijkplayer.listener.OnShowThumbnailListener;\r\nimport com.dou361.ijkplayer.widget.PlayStateParams;\r\nimport com.dou361.ijkplayer.widget.PlayerView;\r\nimport com.dou361.jjdxm_ijkplayer.MainActivity;\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\nimport com.dou361.jjdxm_ijkplayer.command.Control;\r\nimport com.dou361.jjdxm_ijkplayer.command.Gears;\r\nimport com.dou361.jjdxm_ijkplayer.command.Handbrake;\r\nimport com.dou361.jjdxm_ijkplayer.command.Video;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTRequest;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTSample;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.VideoMonitor;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.utlis.MediaUtils;\r\nimport com.tencent.iot.hub.device.android.core.log.TXMqttLogCallBack;\r\nimport com.tencent.iot.hub.device.android.core.util.TXLog;\r\nimport com.tencent.iot.hub.device.java.core.common.Status;\r\nimport com.tencent.iot.hub.device.java.core.mqtt.TXMqttActionCallBack;\r\n\r\n\r\nimport org.eclipse.paho.client.mqttv3.IMqttToken;\r\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\r\n\r\nimport java.io.BufferedReader;\r\nimport java.io.BufferedWriter;\r\nimport java.io.ByteArrayInputStream;\r\nimport java.io.File;\r\nimport java.io.FileReader;\r\nimport java.io.FileWriter;\r\nimport java.io.IOException;\r\nimport java.io.InputStreamReader;\r\nimport java.nio.charset.Charset;\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\n\r\nimport static android.os.SystemClock.uptimeMillis;\r\n\r\n/**\r\n 遥控车辆进行移动\r\n */\r\npublic class RemoteControl extends Activity {\r\n\r\n    public String hostIP = /*\"192.168.0.108:18081\";*/\"10.6.206.20:30549\";\r\n    public String userId = \"6D的安卓測試機\";\r\n    public String vin = \"001\";\r\n\r\n    private final static String mLogPath = Environment.getExternalStorageDirectory().getPath() + \"/tencent/\";\r\n\r\n    public CountDownTimer countDownTimer;\r\n    private MainActivity mParent;\r\n    private MQTTSample mqttSample;\r\n\r\n    private PlayerView player;\r\n    private Context mContext;\r\n    private TextView  Speed;\r\n    private List<VideoijkBean> list;\r\n    private PowerManager.WakeLock wakeLock;\r\n    private View rootView;\r\n    private Activity mActivity;\r\n\r\n    private static final String TAG = \"FullscreenActivity\";\r\n    private boolean braking = true;\r\n    private int gearGlobal=0;\r\n    private int handBrakeStatus = 0;\r\n    private Button LlightingButton;\r\n    private ImageButton imageButton_forward,imageButton_backward;\r\n    private ImageView app_video_play;\r\n    private Spinner Video_Modul_Spinner;\r\n\r\n    private double wheelAngle=0.0;\r\n    private double speed=0.0;\r\n\r\n\r\n\r\n    /*虛擬機*/\r\n    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"android_test_phone\";\r\n    private String mDevPSK  = \"KdV+RSnHAlmEpM75aWZQZg==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/android_test_phone/data\";\r\n\r\n    /*OPPO A57t*/\r\n/*    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"OPPOA57t\";\r\n    private String mDevPSK  = \"TbtnFhJDmRe7N41vDBRVtA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/OPPOA57t/data\";  */  // productID/DeviceName/TopicName\r\n\r\n    /*真车配置*/\r\n    /*private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";\r\n    private String mProductID = \"KM8UZXZOV9\";\r\n    private String mDevName = \"android_test\";\r\n    private String mDevPSK  = \"+xRWqTlp0UPbwSKXVgiNxA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"KM8UZXZOV9/android_test/data\";    // productID/DeviceName/TopicName\r\n*/    private String mSubProductID = \"\"; // If you wont test gateway, let this to be null\r\n    private String mSubDevName = \"\";\r\n    private String mSubDevPsk = \"BuildConfig.SUB_DEVICE_PSK\";\r\n    private String mDevCertName = \"YOUR_DEVICE_NAME_cert.crt\";\r\n    private String mDevKeyName  = \"YOUR_DEVICE_NAME_private.key\";\r\n    private String mProductKey = \"BuildConfig.PRODUCT_KEY\";        // Used for dynamic register\r\n    private String mDevCert = \"\";           // Cert String\r\n    private String mDevPriv = \"\";           // Priv String\r\n\r\n    private volatile boolean mIsConnected=false;\r\n    ScalableImageView sImgView ;\r\n\r\n    @SuppressLint(\"InvalidWakeLockTag\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        Log.d(TAG, \"onCreate: \");\r\n        super.onCreate(savedInstanceState);\r\n        this.mContext = this;\r\n        this.mActivity = this;\r\n        rootView = getLayoutInflater().from(this).inflate(R.layout.activity_remote_control, null);\r\n\r\n        setContentView(rootView);\r\n\r\n        if (!mIsConnected) {\r\n            Log.d(TAG, \"onCreate: Connecting Mqtt\");\r\n            //轮询连接,万分感谢陈岩大佬\r\n            mqttSample= new MQTTSample(getApplication(), new SelfMqttActionCallBack(), mBrokerURL, mProductID, mDevName, mDevPSK,\r\n                    mDevCert, mDevPriv, mSubProductID, mSubDevName, mTestTopic, null, null, true, new SelfMqttLogCallBack());\r\n            Log.d(TAG, \"onCreate: mqttSample\"+mqttSample.toString());\r\n            mqttSample.connect();\r\n            sleep(2000);}\r\n        mqttSample.subscribeTopic();\r\n\r\n\r\n        shiftHandbrake(1);\r\n        Log.d(TAG, \"onCreate: \");\r\n\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                 while (true) {\r\n                     if(braking){\r\n                    try {\r\n\r\n                        moveVehicle(-0.1,0.0,wheelAngle);\r\n                        sleep(50);\r\n                    } catch (Exception e) {\r\n                        e.printStackTrace();\r\n                    }}\r\n            }\r\n        }}).start();\r\n\r\n        /**常亮*/\r\n        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);\r\n        wakeLock = pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK, \"liveTAG\");\r\n        wakeLock.acquire();\r\n\r\n        CompentOnTouch compentOnTouch = new CompentOnTouch();\r\n\r\n        imageButton_forward=findViewById(R.id.forward);\r\n        imageButton_forward.setOnTouchListener(compentOnTouch);\r\n\r\n        imageButton_backward=findViewById(R.id.backward);\r\n        imageButton_backward.setOnTouchListener(compentOnTouch);\r\n        sImgView = findViewById(R.id.steering_wheel);\r\n\r\n        //方向盘角度在速度处显示\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                while(true){\r\n                    wheelAngle = sImgView.getmDegree();\r\n                }\r\n            }\r\n        }).start();\r\n\r\n        countDownTimer=new CountDownTimer(100000,200) {\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                Speed = findViewById(R.id.speed);\r\n                Speed.setText(String.valueOf((int)wheelAngle));\r\n            }\r\n            @Override\r\n            public void onFinish() {\r\n            }\r\n        }.start();\r\n\r\n        //下拉单选按钮\r\n        Video_Modul_Spinner = (Spinner)findViewById(R.id.Spinner_VIdeo_Model);\r\n        Video_Modul_Spinner.setSelection(0);//进入不会自动播放\r\n        Video_Modul_Spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener(){\r\n            @Override\r\n            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {\r\n                    String result = parent.getItemAtPosition(position).toString();\r\n                    Toast.makeText(RemoteControl.this, result, Toast.LENGTH_SHORT).show();\r\n                    switch (position) {\r\n                        case 0: {\r\n                            /**前摄像*/\r\n                            list = new ArrayList<VideoijkBean>();\r\n                            String url1 = \"http://ivi.bupt.edu.cn/hls/cctv13.m3u8\";\r\n                            String url2 = \"rtmp://150.158.176.170/live/test_vin_1\";\r\n                            VideoijkBean m1 = new VideoijkBean();\r\n                            m1.setStream(\"原始视频\");\r\n                            m1.setUrl(url1);\r\n                            VideoijkBean m2 = new VideoijkBean();\r\n                            m2.setStream(\"融合视频\");\r\n                            m2.setUrl(url2);\r\n                            list.add(m1);\r\n                            list.add(m2);\r\n                            player = new PlayerView(mActivity, rootView)\r\n                                    .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                                    .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                                    .forbidTouch(false)\r\n                                    .hideSteam(false)\r\n                                    .hideMenu(false)\r\n                                    .hideCenterPlayer(true)\r\n                                    .hideBack(false)\r\n                                    .setOnlyFullScreen(true)\r\n                                    .setNetWorkTypeTie(false)\r\n                                    .hideRotation(true)\r\n                                    .hideFullscreen(true)\r\n                                    .setChargeTie(true, 480)//设置最长播放时间\r\n                                    .showThumbnail(new OnShowThumbnailListener() {\r\n                                        @Override\r\n                                        public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                                            Glide.with(mContext)\r\n                                                    .load(R.drawable.pic_before_video)\r\n                                                    .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                                    .error(R.color.cl_error)//加载错误之后的错误图\r\n                                                    .into(ivThumbnail);\r\n                                        }\r\n                                    })\r\n                                    .setPlayerBackListener(new OnPlayerBackListener() {\r\n                            @Override\r\n                            public void onPlayerBack() {\r\n                                //对话框\r\n                                AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                                builder.setIcon(R.drawable.shangbackground);\r\n                                builder.setTitle(\"结束挪车\");//设置对话框的标题\r\n                                builder.setMessage(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");//设置对话框的内容\r\n                                builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                                    @Override\r\n                                    public void onClick(DialogInterface arg0, int arg1) {\r\n                                        finish();\r\n                                        Intent intent=new Intent(RemoteControl.this, MainActivity.class);\r\n                                        startActivity(intent);\r\n                                    }\r\n                                });\r\n                                builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                                    @Override\r\n                                    public void onClick(DialogInterface arg0, int arg1) {\r\n                                        Toast.makeText(RemoteControl.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                                        player.startPlay();\r\n                                    }\r\n                                });\r\n                                AlertDialog b=builder.create();\r\n                                b.show();\r\n                                player.onPause();\r\n\r\n                            }\r\n                        })\r\n                                    .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                                        @Override\r\n                                        public void onStartOrPause() {\r\n                                            //对话框\r\n                                            AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                                            builder.setIcon(R.drawable.shangbackground);\r\n                                            builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                                            builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                                            builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    player.startPlay();\r\n                                                }\r\n                                            });\r\n                                            builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    finish();\r\n                                                    Intent intent=new Intent(RemoteControl.this,MainActivity.class);\r\n                                                    startActivity(intent);\r\n                                                }\r\n                                            });\r\n                                            AlertDialog b=builder.create();\r\n                                            b.show();\r\n                                        }\r\n                                    })\r\n                                    .setPlaySource(list)\r\n                                    .startPlay();\r\n                        }\r\n                        break;\r\n\r\n                        case 1: {\r\n                            /**后摄像*/\r\n                            String url3 = \"http://ivi.bupt.edu.cn/hls/cctv2.m3u8\";\r\n                            playVideoUrl(url3);\r\n                        }\r\n                        break;\r\n\r\n                        case 2: {\r\n                            /**左摄像*/\r\n                            String url4 = \"http://ivi.bupt.edu.cn/hls/cctv3.m3u8\";\r\n                            playVideoUrl(url4);\r\n                        }\r\n                        break;\r\n\r\n                        case 3: {\r\n                            /**右摄像*/\r\n                            String url5 = \"http://ivi.bupt.edu.cn/hls/cctv4.m3u8\";\r\n                            playVideoUrl(url5);\r\n\r\n                        }\r\n                        break;\r\n\r\n                        case 4: {\r\n                            /**上帝*/\r\n                            String url6 = \"http://ivi.bupt.edu.cn/hls/cctv13.m3u8\";\r\n                            playVideoUrl(url6);\r\n                        }\r\n                        break;\r\n\r\n                        default:\r\n                            break;\r\n                    }\r\n\r\n            }\r\n            @Override\r\n            public void onNothingSelected(AdapterView<?> parent) { }\r\n        });\r\n\r\n    }\r\n\r\n    //后四个视频播放器播放\r\n    public  void playVideoUrl( String url){\r\n        player = new PlayerView(mActivity, rootView)\r\n                .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                .forbidTouch(false)\r\n                .hideSteam(true)\r\n                .hideMenu(true)\r\n                .hideCenterPlayer(true)\r\n                .hideBack(false)\r\n                .setOnlyFullScreen(true)\r\n                .setNetWorkTypeTie(false)\r\n                .hideRotation(true)\r\n                .hideFullscreen(true)\r\n                .setChargeTie(true, 480)//设置最长播放时间\r\n                .showThumbnail(new OnShowThumbnailListener() {\r\n                    @Override\r\n                    public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                        Glide.with(mContext)\r\n                                .load(R.drawable.pic_before_video)\r\n                                .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                .error(R.color.cl_error)//加载错误之后的错误图\r\n                                .into(ivThumbnail);\r\n                    }\r\n                })\r\n                .setPlayerBackListener(new OnPlayerBackListener() {\r\n                    @Override\r\n                    public void onPlayerBack() {\r\n                        //对话框\r\n                        AlertDialog.Builder builder = new AlertDialog.Builder(mContext);\r\n                        builder.setIcon(R.drawable.shangbackground);\r\n                        builder.setTitle(\"结束挪车\");//设置对话框的标题\r\n                        builder.setMessage(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");//设置对话框的内容\r\n                        builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                finish();\r\n                                Intent intent = new Intent(RemoteControl.this, MainActivity.class);\r\n                                startActivity(intent);\r\n                            }\r\n                        });\r\n                        builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                Toast.makeText(RemoteControl.this, \"取消成功\", Toast.LENGTH_SHORT).show();\r\n                                player.startPlay();\r\n                            }\r\n                        });\r\n                        AlertDialog b = builder.create();\r\n                        b.show();\r\n                        player.onPause();\r\n                    }\r\n                })\r\n                .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                    @Override\r\n                    public void onStartOrPause() {\r\n                        //对话框\r\n                        AlertDialog.Builder builder = new AlertDialog.Builder(mContext);\r\n                        builder.setIcon(R.drawable.shangbackground);\r\n                        builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                        builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                        builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                player.startPlay();\r\n                            }\r\n                        });\r\n                        builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                finish();\r\n                                Intent intent = new Intent(RemoteControl.this, MainActivity.class);\r\n                                startActivity(intent);\r\n                            }\r\n                        });\r\n                        AlertDialog b = builder.create();\r\n                        b.show();\r\n                    }\r\n                })\r\n                .setPlaySource(url)\r\n                .startPlay();\r\n    }\r\n\r\n\r\n    /**\r\n    1表示手刹释放，0表示手刹锁定\r\n     **/\r\n\r\n    private void shiftHandbrake(int handbrakeToSet) {\r\n        if(handbrakeToSet!=handBrakeStatus){\r\n            for(int i=0;i<5;i++){\r\n                Handbrake mHandbrake = new Handbrake();\r\n                mHandbrake.setTimestamp(System.currentTimeMillis());\r\n                mHandbrake.setStatus(handbrakeToSet);\r\n                mHandbrake.setType(14);\r\n                mHandbrake.setTaskid(\"6D\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mHandbrake));\r\n                Log.d(TAG, \"onClick: 手刹\"+JSON.toJSONString(mHandbrake));\r\n                sleep(50);\r\n            }\r\n            handBrakeStatus=handbrakeToSet;}\r\n        else return;\r\n    }\r\n\r\n    /**\r\n    1,2,3,4分別對應P,R,N,D四個檔位\r\n     **/\r\n    private void shiftGear(final int gear){\r\n        if(speed==0){\r\n        for(int i=0;i<10;i++){\r\n                Gears mGear = new Gears();\r\n                mGear.setTimestamp(System.currentTimeMillis());\r\n                Log.d(TAG, \"onClick: \"+System.currentTimeMillis());\r\n                mGear.setGear(gear);\r\n                mGear.setType(13);\r\n                mGear.setTaskid(\"手機挂\"+gear+\"档\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mGear));\r\n                Log.d(TAG, \"onClick: \"+JSON.toJSONString(mGear));\r\n                sleep(50);\r\n        }\r\n        gearGlobal=gear;}\r\n        else {\r\n            moveVehicle(-0.3,0.0,0.0);\r\n            shiftGear(gear);\r\n        }\r\n    }\r\n\r\n    /**\r\n\r\n     @videoType\r\n     1为前方原始视频流，2为后方原始视频流，3为左侧原始视频流，4为右侧原始视频流，5为感知融合视频流，6为上帝视角视频流\r\n     @videoStatus\r\n     1为打开，0为关闭\r\n     */\r\n    private void shiftVideoType(int videoType,int videoStatus){\r\n        Video mVideo = new Video();\r\n        mVideo.setTimestamp(System.currentTimeMillis());\r\n        mVideo.setVideo_type(videoType);\r\n        mVideo.setOperation(videoStatus);\r\n        mVideo.setType(12);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        mqttSample.publishTopic(\"data\", JSON.toJSONString(mVideo));\r\n        Log.d(TAG, \"onClick: \"+JSON.toJSONString(mVideo));\r\n    }\r\n\r\n    /**\r\n     * @acceleration 加速度，正是加速，負的是減速\r\n     * @speed 目標速度\r\n     * @wheelAngle 方向盤轉角\r\n     */\r\n    private void moveVehicle(Double acceleration,Double speed,Double wheelAngle){\r\n        Control mMove = new Control();\r\n        mMove.setTimestamp(System.currentTimeMillis());\r\n        mMove.setAcceleration(acceleration);\r\n        mMove.setSpeed(speed);\r\n        mMove.setType(11);\r\n        mMove.setWheel_angle(wheelAngle);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        //mqttSample.publishTopic(\"data\", JSON.toJSONString(mMove));\r\n        //Log.d(TAG, \"onClick: 上传刹车\"+JSON.toJSONString(mMove));\r\n    }\r\n\r\n    @Override\r\n    protected void onPostCreate(Bundle savedInstanceState) {\r\n        super.onPostCreate(savedInstanceState);\r\n    }\r\n\r\n\r\n\r\n\r\n    //ms为需要休眠的时长\r\n    public static void sleep(long ms)\r\n    {\r\n        //uptimeMillis() Returns milliseconds since boot, not counting time spent in deep sleep.\r\n        long start = uptimeMillis();\r\n        long duration = ms;\r\n        boolean interrupted = false;\r\n        do {\r\n            try {\r\n                Thread.sleep(duration);\r\n            }\r\n            catch (InterruptedException e) {\r\n                interrupted = true;\r\n            }\r\n            duration = start + ms - uptimeMillis();\r\n        } while (duration > 0);\r\n\r\n        if (interrupted) {\r\n            Thread.currentThread().interrupt();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttActionCallBack回调接口\r\n     */\r\n    private class SelfMqttActionCallBack extends TXMqttActionCallBack {\r\n\r\n        @Override\r\n        public void onConnectCompleted(Status status, boolean reconnect, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onConnectCompleted, status[%s], reconnect[%b], userContext[%s], msg[%s]\",\r\n                    status.name(), reconnect, userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            if(status==Status.OK){\r\n             mIsConnected = true;}\r\n        }\r\n\r\n        @Override\r\n        public void onConnectionLost(Throwable cause) {\r\n            String logInfo = String.format(\"onConnectionLost, cause[%s]\", cause.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onDisconnectCompleted(Status status, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onDisconnectCompleted, status[%s], userContext[%s], msg[%s]\", status.name(), userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            mIsConnected = false;\r\n        }\r\n\r\n        @Override\r\n        public void onPublishCompleted(Status status, IMqttToken token, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onPublishCompleted, status[%s], topics[%s],  userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(token.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            if (Status.ERROR == status) {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            } else {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public void onUnSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onUnSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onMessageReceived(final String topic, final MqttMessage message) {\r\n            String logInfo = String.format(\"receive command, topic[%s], message[%s]\", topic, message.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttLogCallBack回调接口\r\n     */\r\n    private class SelfMqttLogCallBack extends TXMqttLogCallBack {\r\n\r\n        @Override\r\n        public String setSecretKey() {\r\n            String secertKey;\r\n            if (mDevPSK != null && mDevPSK.length() != 0) {  //密钥认证\r\n                secertKey = mDevPSK;\r\n                secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                return secertKey;\r\n            } else {\r\n                BufferedReader cert;\r\n\r\n                if (mDevCert != null && mDevCert.length() != 0) { //动态注册,从DevCert中读取\r\n                    cert = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(mDevCert.getBytes(Charset.forName(\"utf8\"))), Charset.forName(\"utf8\")));\r\n\r\n                } else { //证书认证，从证书文件中读取\r\n                    AssetManager assetManager = mParent.getAssets();\r\n                    if (assetManager == null) {\r\n                        return null;\r\n                    }\r\n                    try {\r\n                        cert=new BufferedReader(new InputStreamReader(assetManager.open(mDevCertName)));\r\n                    } catch (IOException e) {\r\n//                        mParent.printLogInfo(TAG, \"getSecertKey failed, cannot open CRT Files.\",mLogInfoText);\r\n                        return null;\r\n                    }\r\n                }\r\n                //获取密钥\r\n                try {\r\n                    if (cert.readLine().contains(\"-----BEGIN\")) {\r\n                        secertKey = cert.readLine();\r\n                        secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                    } else {\r\n                        secertKey = null;\r\n//                        mParent.printLogInfo(TAG,\"Invaild CRT Files.\", mLogInfoText);\r\n                    }\r\n                    cert.close();\r\n                } catch (IOException e) {\r\n                    TXLog.e(TAG, \"getSecertKey failed.\", e);\r\n//                    mParent.printLogInfo(TAG,\"getSecertKey failed.\", mLogInfoText);\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return secertKey;\r\n        }\r\n\r\n        @Override\r\n        public void printDebug(String message){\r\n//            mParent.printLogInfo(TAG, message, mLogInfoText);\r\n            //TXLog.d(TAG,message);\r\n        }\r\n\r\n        @Override\r\n        public boolean saveLogOffline(String log){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"saveLogOffline not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Save log to %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedWriter wLog = new BufferedWriter(new FileWriter(new File(logFilePath), true));\r\n                wLog.write(log);\r\n                wLog.flush();\r\n                wLog.close();\r\n                return true;\r\n            } catch (IOException e) {\r\n                String logInfo = String.format(\"Save log to [%s] failed, check the Storage permission!\", logFilePath);\r\n//                mParent.printLogInfo(TAG,logInfo, mLogInfoText);\r\n                e.printStackTrace();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public String readOfflineLog(){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"readOfflineLog not ready\", mLogInfoText);\r\n                return null;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Read log from %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedReader logReader = new BufferedReader(new FileReader(logFilePath));\r\n                StringBuilder offlineLog = new StringBuilder();\r\n                int data;\r\n                while (( data = logReader.read()) != -1 ) {\r\n                    offlineLog.append((char)data);\r\n                }\r\n                logReader.close();\r\n                return offlineLog.toString();\r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n                return null;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public boolean delOfflineLog(){\r\n\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"delOfflineLog not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            File file = new File(logFilePath);\r\n            if (file.exists() && file.isFile()) {\r\n                if (file.delete()) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    class\r\n    CompentOnTouch implements View.OnTouchListener {\r\n\r\n        public boolean isOnLongClick=false;\r\n        int i = 0;\r\n\r\n        @Override\r\n        public boolean onTouch(View view, MotionEvent motionEvent) {\r\n\r\n            switch (view.getId()) {\r\n// 这是btnMius下的一个层，为了增强易点击性\r\n                case R.id.backward:\r\n                    onTouchChange(\"backward\", motionEvent.getAction());\r\n                    break;\r\n// 这里也写，是为了增强易点击性\r\n                case R.id.forward:\r\n                    onTouchChange(\"forward\", motionEvent.getAction());\r\n                    break;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        private void onTouchChange(String methodName, int eventAction) {\r\n            Log.d(TAG, \"onTouchChange: \"+methodName+eventAction);\r\n            braking =false;\r\n// 按下松开分别对应启动停止前进方法\r\n            if (\"backward\".equals(methodName)) {\r\n                if(gearGlobal!=2){\r\n                shiftGear(2);}\r\n                MiusThread miusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    miusThread = new MiusThread();\r\n                    isOnLongClick = true;\r\n                    miusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\"+ braking);\r\n//                    Log.d(TAG, \"onTouchChange: isOnLongClick=false\"+miusThread.isInterrupted());\r\n                    if (miusThread != null) {\r\n                        miusThread.interrupt();\r\n                        Log.d(TAG, \"onTouchChange: 终止线程\");\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (miusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n// 按下松开分别对应启动停止加线程方法\r\n            else if (\"forward\".equals(methodName)) {\r\n                if(gearGlobal!=4){\r\n                shiftGear(4);}\r\n                PlusThread plusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    plusThread = new PlusThread();\r\n                    isOnLongClick = true;\r\n                    plusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\");\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        // 后退操作\r\n        class MiusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(2);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n\r\n        // 前进操作\r\n        class PlusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(1);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n        Handler myHandler = new Handler() {\r\n            public void handleMessage(Message msg) {\r\n                switch (msg.what) {\r\n                    case 1:\r\n                        //前进操作\r\n//                        Control mForward = new Control(5.0,0.1,wheelAngle);\r\n//                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mForward));\r\n//                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mForward));\r\n                        moveVehicle(0.1,5.0,wheelAngle);\r\n                        break;\r\n                    case 2:\r\n//                        Control mBackward = new Control(-5.0,0.1,wheelAngle);\r\n//                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBackward));\r\n//                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBackward));\r\n                        moveVehicle(0.1,-5.0,wheelAngle);\r\n                        Log.d(\"TAG\",\"Backward:\"+i--);\r\n                        break;\r\n                    case 3:\r\n                        Control mBreak = new Control(0.0,-0.1,wheelAngle);\r\n                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBreak));\r\n                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBreak));\r\n                        break;\r\n                }\r\n            };\r\n        };\r\n    }\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        if (player != null) {\r\n            player.onPause();\r\n        }\r\n        /**demo的内容，恢复系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, true);\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        if (player != null) {\r\n            player.onResume();\r\n        }\r\n        /**demo的内容，暂停系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, false);\r\n        /**demo的内容，激活设备常亮状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.acquire();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onDestroy() {\r\n        super.onDestroy();\r\n        if (player != null) {\r\n            for(int i=1;i<7;i++){\r\n            shiftVideoType(i,0);}\r\n            player.onDestroy();\r\n        }\r\n        if(speed!=0){moveVehicle(-0.3,0.0,0.0);}\r\n        if(braking){braking=false;}\r\n        if(gearGlobal!=1){shiftGear(1);}\r\n        if(handBrakeStatus==1){shiftHandbrake(0);}\r\n        if(mIsConnected){mqttSample.disconnect();}\r\n\r\n        Log.d(TAG, \"onDestroy: 斷開視頻以及MQTT連接\");\r\n    }\r\n\r\n    @Override\r\n    public void onConfigurationChanged(Configuration newConfig) {\r\n        super.onConfigurationChanged(newConfig);\r\n        if (player != null) {\r\n            player.onConfigurationChanged(newConfig);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onBackPressed() {\r\n        if (player != null && player.onBackPressed()) {\r\n            return;\r\n        }\r\n        super.onBackPressed();\r\n        /**demo的内容，恢复设备亮度状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.release();\r\n        }\r\n    }\r\n}\r\n
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(revision d2145b2e60a213e962bd4c4bdbc527cedbf64ea5)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(date 1608799611253)
--@@ -169,7 +169,6 @@
--                  while (true) {
--                      if(braking){
--                     try {
---
--                         moveVehicle(-0.1,0.0,wheelAngle);
--                         sleep(50);
--                     } catch (Exception e) {
--@@ -193,18 +192,10 @@
--         sImgView = findViewById(R.id.steering_wheel);
-- 
--         //方向盘角度在速度处显示
---        new Thread(new Runnable() {
--+        countDownTimer=new CountDownTimer(1000000,200) {
--             @Override
---            public void run() {
---                while(true){
---                    wheelAngle = sImgView.getmDegree();
---                }
---            }
---        }).start();
---
---        countDownTimer=new CountDownTimer(100000,200) {
---            @Override
---            public void onTick(long millisUntilFinished) {
--+            public void onTick(long millisUntilFinished) {
--+                wheelAngle = sImgView.getmDegree();
--                 Speed = findViewById(R.id.speed);
--                 Speed.setText(String.valueOf((int)wheelAngle));
--             }
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControlInitial.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.app.Activity;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.view.View;\r\nimport android.view.WindowManager;\r\nimport android.widget.Button;\r\nimport android.widget.ImageButton;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\n\r\npublic class RemoteControlInitial extends Activity {\r\n\r\n    private Context mContext;\r\n    private Button StartRemove;\r\n    private ImageButton imageButton_forward,imageButton_backward;\r\n    private TextView speedTextView;\r\n    private double wheelAngle=0.0;\r\n\r\n\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        getWindow().addFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);\r\n\r\n        //一直连接Iothub\r\n\r\n\r\n\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_remote_controlinitial);\r\n        this.mContext = this;\r\n        CountDownTimer countDownTimer = new CountDownTimer(100000, 200) {\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                speedTextView = findViewById(R.id.speed);\r\n                speedTextView.setText(String.valueOf((int) wheelAngle));\r\n            }\r\n\r\n            @Override\r\n            public void onFinish() {\r\n            }\r\n        }.start();\r\n\r\n\r\n        StartRemove= (Button)findViewById(R.id.startRemove);\r\n        StartRemove.setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View V){\r\n\r\n                        //IotHub连接成功弹出对话框，否则提示当前连接车辆失败\r\n                        AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                        builder.setIcon(R.drawable.shangbackground);\r\n                        builder.setTitle(\"开始挪车\");//设置对话框的标题\r\n                        builder.setMessage(\"挪车功能提供用户通过手机遥控移动车辆的功能请问您要开始挪车吗？\");//设置对话框的内容\r\n                        builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                Intent intent=new Intent(RemoteControlInitial.this, RemoteControl.class);\r\n                                startActivity(intent);\r\n                            }\r\n                        });\r\n                        builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                Toast.makeText(RemoteControlInitial.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                            }\r\n                        });\r\n                        AlertDialog b=builder.create();\r\n                        b.show();\r\n                    }\r\n                 });\r\n    }\r\n}\r\n\r\n
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControlInitial.java	(revision d2145b2e60a213e962bd4c4bdbc527cedbf64ea5)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControlInitial.java	(date 1608799611260)
--@@ -23,6 +23,8 @@
--     private ImageButton imageButton_forward,imageButton_backward;
--     private TextView speedTextView;
--     private double wheelAngle=0.0;
--+    ScalableImageView sImgView ;
--+
-- 
-- 
-- 
--@@ -30,16 +32,16 @@
--     protected void onCreate(Bundle savedInstanceState) {
--         getWindow().addFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);
-- 
---        //一直连接Iothub
---
---
---
--         super.onCreate(savedInstanceState);
--         setContentView(R.layout.activity_remote_controlinitial);
--         this.mContext = this;
---        CountDownTimer countDownTimer = new CountDownTimer(100000, 200) {
--+
--+        sImgView = findViewById(R.id.steering_wheel);
--+
--+        CountDownTimer countDownTimer = new CountDownTimer(1000000, 200) {
--             @Override
--             public void onTick(long millisUntilFinished) {
--+                wheelAngle=sImgView.getmDegree();
--                 speedTextView = findViewById(R.id.speed);
--                 speedTextView.setText(String.valueOf((int) wheelAngle));
--             }
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/ScalableImageView.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.content.Context;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapFactory;\r\nimport android.graphics.Matrix;\r\nimport android.graphics.Point;\r\nimport android.graphics.PointF;\r\nimport android.util.AttributeSet;\r\nimport android.util.Log;\r\nimport android.view.MotionEvent;\r\nimport android.view.animation.RotateAnimation;\r\n\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport static android.content.ContentValues.TAG;\r\n\r\n\r\n/**\r\n * Fixed on 2020/9/17,which is a happy day!\r\n */\r\npublic class ScalableImageView extends androidx.appcompat.widget.AppCompatImageView{\r\n\r\n\r\n    private static final double MAX_DEGREE = 600.0;//方向盘最大转角\r\n    private Matrix matrix;\r\n    private Matrix cacheMatrix;  //缓存的matrix ，同时记录上一次滑动的位置\r\n    private float mPointDistinct = 1f;\r\n    private  double mDegree=0.0;// 旋转的ScalableImageView角度\r\n    double radius0 =0.0;\r\n\r\n\r\n    private Bitmap bitmap;\r\n\r\n    public  Double getmDegree() {\r\n        return mDegree;\r\n\r\n    }\r\n\r\n    List<Double> angleList= new ArrayList<>();//For story the angle data\r\n    List<PointF> pointFList = new ArrayList<>();\r\n    PointF point2store=new PointF();\r\n    int circle =0;\r\n    double degree0 = 0.0;//按下角度\r\n    double degree = 0.0;//转动角度\r\n    double radiusLast;\r\n    double degreeLast;\r\n    double radiusNow;\r\n    double degreeNow;\r\n    double delta_degree;\r\n\r\n    enum Mode {\r\n        NONE, DOWN, MOVE\r\n    }\r\n\r\n    private Mode mode; //当前mode\r\n    private Context mContext;\r\n\r\n    private PointF mStart = new PointF();\r\n\r\n    public ScalableImageView(Context context) {\r\n        this(context, null);\r\n    }\r\n\r\n    public ScalableImageView(Context context, AttributeSet attrs) {\r\n        this(context, attrs, 0);\r\n    }\r\n\r\n    public ScalableImageView(Context context, AttributeSet attrs, int defStyleAttr) {\r\n        super(context, attrs, defStyleAttr);\r\n        this.mContext = context;\r\n        init();\r\n    }\r\n\r\n    private void init() {\r\n        circle = 0;\r\n        degree = 0.0;\r\n        degree0 = 0.0;\r\n        mDegree = 0.0;\r\n        radius0 = 0.0;\r\n        matrix = new Matrix();\r\n        cacheMatrix = new Matrix();\r\n        pointFList.clear();\r\n        mode = Mode.NONE;\r\n        bitmap= BitmapFactory.decodeResource(getResources(), R.drawable.steering_wheel);  //避免OOM\r\n        setImageBitmap(bitmap);\r\n    }\r\n\r\n    @Override\r\n    public boolean onTouchEvent(MotionEvent event) {\r\n        switch (event.getAction() & MotionEvent.ACTION_MASK) {\r\n            case MotionEvent.ACTION_DOWN:\r\n            case MotionEvent.ACTION_POINTER_DOWN:\r\n                cacheMatrix.set(matrix); //先拷贝一份到缓存\r\n                float delta_x0 = (event.getX()- bitmap.getWidth()/2);\r\n                float delta_y0 = (event.getY() - bitmap.getHeight()/ 2);\r\n                radius0 = Math.atan2(delta_y0,delta_x0);\r\n                degree0= (Double) Math.toDegrees(radius0);\r\n                Log.d(TAG, \"onTouchEvent: 初始角度\"+degree0);\r\n                mode = Mode.DOWN;\r\n                mStart.set(delta_x0, delta_y0);\r\n                pointFList.add(mStart);\r\n                break;\r\n\r\n            case MotionEvent.ACTION_MOVE:\r\n                //单点触控的时候\r\n                if (mode == Mode.DOWN) {\r\n                    matrix.set(cacheMatrix);\r\n                    float delta_x = (event.getX()- bitmap.getWidth()/2);\r\n                    float delta_y = (event.getY() - bitmap.getHeight()/ 2);\r\n\r\n                    pointFList.add(new PointF(delta_x,delta_y));\r\n                    if(pointFList.size()>5){\r\n                        for(int i=0;i<pointFList.size()-5;i++){\r\n                            pointFList.remove(i);\r\n                        }\r\n                    }\r\n                    if(pointFList.size()>=2){\r\n                        for(int i=0;i<pointFList.size();i++){\r\n                            Log.d(TAG, \"onTouchEvent: \\n第\"+i+\"个点：\"+pointFList.get(i).x+\",\"+pointFList.get(i).y+\"\\n\");\r\n                        }\r\n                         radiusLast = Math.atan2(pointFList.get(pointFList.size()-2).y,pointFList.get(pointFList.size()-2).x);\r\n                         degreeLast = Math.toDegrees(radiusLast);\r\n                         radiusNow = Math.atan2(pointFList.get(pointFList.size()-1).y,pointFList.get(pointFList.size()-1).x);\r\n                         degreeNow = Math.toDegrees(radiusNow);\r\n                         delta_degree = degreeNow - degreeLast;\r\n                        if(delta_degree<=0&&Math.abs(delta_degree)<180){\r\n                            mDegree=mDegree-Math.abs(delta_degree);\r\n                        }else if(delta_degree<=0&&Math.abs(delta_degree)>=180){\r\n                            mDegree= mDegree+360-Math.abs(delta_degree);\r\n                        }else if(delta_degree>0&&Math.abs(delta_degree)<180){\r\n                            mDegree= mDegree+Math.abs(delta_degree);\r\n                        }else if(delta_degree>0&&Math.abs(delta_degree)>=180){\r\n                            mDegree= mDegree-360+Math.abs(delta_degree);\r\n                        }\r\n                        Log.d(TAG, \"onTouchEvent: 現在角度\"+mDegree);\r\n                    }\r\n                    if(mDegree>MAX_DEGREE) {mDegree = MAX_DEGREE;}\r\n                    if(mDegree<-MAX_DEGREE){mDegree =-MAX_DEGREE;}\r\n\r\n                    /*double radius = Math.atan2(delta_y,delta_x);\r\n                    Log.d(TAG, \"onTouchEvent: pass弧度\"+(radius-radius0));\r\n                    //向量叉乘判斷正負\r\n                    if(event.getY()-mStart.y>0){\r\n                        Log.d(TAG, \"onTouchEvent: 順時針\"+Math.atan2(1,-1));\r\n//                        degree=degree+360;\r\n                    }else {\r\n                        Log.d(TAG, \"onTouchEvent: 逆時針\"+Math.atan2(-1,1));\r\n                    }\r\n\r\n                    Log.d(TAG, \"onTouchEvent: 現在弧度\"+radius);\r\n                    Log.d(TAG, \"onTouchEvent: 現在角度\"+Math.toDegrees(radius));\r\n                    degree= (Double) Math.toDegrees(radius)-degree0;\r\n                    Log.d(TAG, \"onTouchEvent: 旋轉角度\"+degree);\r\n                    angleList.add(degree);\r\n                    if(angleList.size()>5){\r\n                        for(int i=0;i<angleList.size()-5;i++){\r\n                            angleList.remove(i);\r\n                        }\r\n                    }\r\n                    if(angleList.size()>2) {\r\n                        //\r\n                        Log.d(TAG, \"onTouchEvent: \\n當前角度\"+angleList.get(angleList.size() - 1)+\"上次角度\"+angleList.get(angleList.size() - 2));\r\n                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) > 300)\r\n                        {\r\n//                            circle--;\r\n                        Log.d(TAG, \"onTouchEvent: 減了一圈\"+circle);}\r\n                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) < -300)\r\n                        {\r\n//                            circle++;\r\n                        Log.d(TAG, \"onTouchEvent: 加了一圈\"+circle);}\r\n                        degree = degree + 360 * circle;\r\n\r\n                        if(degree>MAX_DEGREE) {degree = MAX_DEGREE;}\r\n                        if(degree<-MAX_DEGREE){degree =-MAX_DEGREE;}\r\n                    }\r\n                    Log.d(\"赋值Degree\",mDegree+\"\");\r\n                    mDegree = degree;*/\r\n\r\n//                    final RotateAnimation rotateAnimation = new RotateAnimation(0f, (float)degree, bitmap.getWidth() / 2, bitmap.getHeight() / 2);\r\n                    matrix.postRotate((float) mDegree,bitmap.getWidth()/2, bitmap.getHeight()/ 2);\r\n                }\r\n                break;\r\n            case MotionEvent.ACTION_UP:\r\n                init();\r\n            case MotionEvent.ACTION_POINTER_UP:\r\n            case MotionEvent.ACTION_CANCEL:\r\n                mode = Mode.NONE;\r\n                break;\r\n        }\r\n        setImageMatrix(matrix);\r\n        return true;\r\n    }\r\n\r\n}
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/ScalableImageView.java	(revision d2145b2e60a213e962bd4c4bdbc527cedbf64ea5)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/ScalableImageView.java	(date 1608799854637)
--@@ -28,8 +28,7 @@
--     private static final double MAX_DEGREE = 600.0;//方向盘最大转角
--     private Matrix matrix;
--     private Matrix cacheMatrix;  //缓存的matrix ，同时记录上一次滑动的位置
---    private float mPointDistinct = 1f;
---    private  double mDegree=0.0;// 旋转的ScalableImageView角度
--+    private double mDegree=0.0;// 旋转的ScalableImageView角度
--     double radius0 =0.0;
-- 
-- 
--@@ -40,12 +39,10 @@
-- 
--     }
-- 
---    List<Double> angleList= new ArrayList<>();//For story the angle data
---    List<PointF> pointFList = new ArrayList<>();
--+    List<PointF> pointFList = new ArrayList<>();//儲存最近劃過的幾個點
--     PointF point2store=new PointF();
---    int circle =0;
--+
--     double degree0 = 0.0;//按下角度
---    double degree = 0.0;//转动角度
--     double radiusLast;
--     double degreeLast;
--     double radiusNow;
--@@ -59,8 +56,6 @@
--     private Mode mode; //当前mode
--     private Context mContext;
-- 
---    private PointF mStart = new PointF();
---
--     public ScalableImageView(Context context) {
--         this(context, null);
--     }
--@@ -76,8 +71,6 @@
--     }
-- 
--     private void init() {
---        circle = 0;
---        degree = 0.0;
--         degree0 = 0.0;
--         mDegree = 0.0;
--         radius0 = 0.0;
--@@ -101,8 +94,7 @@
--                 degree0= (Double) Math.toDegrees(radius0);
--                 Log.d(TAG, "onTouchEvent: 初始角度"+degree0);
--                 mode = Mode.DOWN;
---                mStart.set(delta_x0, delta_y0);
---                pointFList.add(mStart);
--+                pointFList.add(new PointF(delta_x0,delta_y0));
--                 break;
-- 
--             case MotionEvent.ACTION_MOVE:
--@@ -119,9 +111,6 @@
--                         }
--                     }
--                     if(pointFList.size()>=2){
---                        for(int i=0;i<pointFList.size();i++){
---                            Log.d(TAG, "onTouchEvent: \n第"+i+"个点："+pointFList.get(i).x+","+pointFList.get(i).y+"\n");
---                        }
--                          radiusLast = Math.atan2(pointFList.get(pointFList.size()-2).y,pointFList.get(pointFList.size()-2).x);
--                          degreeLast = Math.toDegrees(radiusLast);
--                          radiusNow = Math.atan2(pointFList.get(pointFList.size()-1).y,pointFList.get(pointFList.size()-1).x);
--@@ -141,46 +130,6 @@
--                     if(mDegree>MAX_DEGREE) {mDegree = MAX_DEGREE;}
--                     if(mDegree<-MAX_DEGREE){mDegree =-MAX_DEGREE;}
-- 
---                    /*double radius = Math.atan2(delta_y,delta_x);
---                    Log.d(TAG, "onTouchEvent: pass弧度"+(radius-radius0));
---                    //向量叉乘判斷正負
---                    if(event.getY()-mStart.y>0){
---                        Log.d(TAG, "onTouchEvent: 順時針"+Math.atan2(1,-1));
---//                        degree=degree+360;
---                    }else {
---                        Log.d(TAG, "onTouchEvent: 逆時針"+Math.atan2(-1,1));
---                    }
---
---                    Log.d(TAG, "onTouchEvent: 現在弧度"+radius);
---                    Log.d(TAG, "onTouchEvent: 現在角度"+Math.toDegrees(radius));
---                    degree= (Double) Math.toDegrees(radius)-degree0;
---                    Log.d(TAG, "onTouchEvent: 旋轉角度"+degree);
---                    angleList.add(degree);
---                    if(angleList.size()>5){
---                        for(int i=0;i<angleList.size()-5;i++){
---                            angleList.remove(i);
---                        }
---                    }
---                    if(angleList.size()>2) {
---                        //
---                        Log.d(TAG, "onTouchEvent: \n當前角度"+angleList.get(angleList.size() - 1)+"上次角度"+angleList.get(angleList.size() - 2));
---                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) > 300)
---                        {
---//                            circle--;
---                        Log.d(TAG, "onTouchEvent: 減了一圈"+circle);}
---                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) < -300)
---                        {
---//                            circle++;
---                        Log.d(TAG, "onTouchEvent: 加了一圈"+circle);}
---                        degree = degree + 360 * circle;
---
---                        if(degree>MAX_DEGREE) {degree = MAX_DEGREE;}
---                        if(degree<-MAX_DEGREE){degree =-MAX_DEGREE;}
---                    }
---                    Log.d("赋值Degree",mDegree+"");
---                    mDegree = degree;*/
---
---//                    final RotateAnimation rotateAnimation = new RotateAnimation(0f, (float)degree, bitmap.getWidth() / 2, bitmap.getHeight() / 2);
--                     matrix.postRotate((float) mDegree,bitmap.getWidth()/2, bitmap.getHeight()/ 2);
--                 }
--                 break;
-Index: .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_9_28__Default_Changelist_.xml
-===================================================================
---- .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_9_28__Default_Changelist_.xml	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-+++ .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_9_28__Default_Changelist_.xml	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-@@ -1,4 +0,0 @@
--<changelist name="Uncommitted_changes_before_Update_at_2020_12_28_9_28_[Default_Changelist]" date="1609118932719" recycled="true" deleted="true">
--  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_9_28_[Default_Changelist]/shelved.patch" />
--  <option name="DESCRIPTION" value="Uncommitted changes before Update at 2020/12/28 9:28 [Default Changelist]" />
--</changelist>
-\ No newline at end of file
-Index: .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_16_53_[Default_Changelist]/shelved.patch
-===================================================================
---- .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_16_53_[Default_Changelist]/shelved.patch	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-+++ .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_16_53_[Default_Changelist]/shelved.patch	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-@@ -1,367 +0,0 @@
--Index: app/src/main/res/layout/remove_bottombar.xml
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:id=\"@+id/remove_bottom_box\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"wrap_content\"\r\n    android:background=\"#00000000\"\r\n    android:gravity=\"center_vertical\"\r\n    android:orientation=\"horizontal\">\r\n\r\n\r\n    <com.dou361.jjdxm_ijkplayer.remotecontrol.ScalableImageView\r\n        android:id=\"@+id/steering_wheel\"\r\n        android:layout_width=\"180dp\"\r\n        android:layout_height=\"180dp\"\r\n        android:adjustViewBounds=\"true\"\r\n        android:scaleType=\"fitXY\"\r\n\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        android:layout_marginStart=\"10dp\"\r\n        />\r\n\r\n\r\n\r\n    <LinearLayout\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_weight=\"1\"\r\n        android:orientation=\"vertical\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        android:layout_marginTop=\"15dp\"\r\n        android:layout_marginEnd=\"10dp\">\r\n\r\n        <ImageButton\r\n            android:id=\"@+id/forward\"\r\n            android:layout_width=\"200px\"\r\n            android:layout_height=\"200px\"\r\n            android:layout_alignTop=\"@id/steering_wheel\"\r\n            android:scaleType=\"fitXY\"\r\n            android:src=\"@drawable/forward\"\r\n            android:background=\"#00000000\">\r\n        </ImageButton>\r\n\r\n        <ImageButton\r\n            android:id=\"@+id/backward\"\r\n            android:layout_width=\"200px\"\r\n            android:layout_height=\"200px\"\r\n            android:layout_below=\"@id/forward\"\r\n            android:layout_marginTop=\"10dp\"\r\n            android:scaleType=\"fitXY\"\r\n            android:src=\"@drawable/backward\"\r\n            android:background=\"#00000000\">\r\n        </ImageButton>\r\n\r\n\r\n    </LinearLayout>\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/res/layout/remove_bottombar.xml	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/res/layout/remove_bottombar.xml	(date 1609143509512)
--@@ -15,15 +15,11 @@
--         android:id="@+id/steering_wheel"
--         android:layout_width="180dp"
--         android:layout_height="180dp"
--+        android:layout_marginStart="16dp"
--         android:adjustViewBounds="true"
---        android:scaleType="fitXY"
---
--+        android:scaleType="matrix"
--         app:layout_constraintStart_toStartOf="parent"
---        app:layout_constraintTop_toTopOf="parent"
---        android:layout_marginStart="10dp"
---        />
---
---
--+        app:layout_constraintTop_toTopOf="parent" />
-- 
--     <LinearLayout
--         android:layout_width="wrap_content"
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.app.Activity;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.content.res.AssetManager;\r\nimport android.content.res.Configuration;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.os.Environment;\r\nimport android.os.Handler;\r\nimport android.os.Message;\r\nimport android.os.PowerManager;\r\nimport android.util.Log;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.AdapterView;\r\nimport android.widget.Button;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.Spinner;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.OnBackPressedCallback;\r\n\r\nimport com.alibaba.fastjson.JSON;\r\nimport com.bumptech.glide.Glide;\r\nimport com.dou361.ijkplayer.bean.VideoijkBean;\r\nimport com.dou361.ijkplayer.listener.OnPlayerBackListener;\r\nimport com.dou361.ijkplayer.listener.OnPlayerStartOrPauseListener;\r\nimport com.dou361.ijkplayer.listener.OnShowThumbnailListener;\r\nimport com.dou361.ijkplayer.widget.PlayStateParams;\r\nimport com.dou361.ijkplayer.widget.PlayerView;\r\nimport com.dou361.jjdxm_ijkplayer.MainActivity;\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\nimport com.dou361.jjdxm_ijkplayer.command.Control;\r\nimport com.dou361.jjdxm_ijkplayer.command.Gears;\r\nimport com.dou361.jjdxm_ijkplayer.command.Handbrake;\r\nimport com.dou361.jjdxm_ijkplayer.command.Video;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTRequest;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTSample;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.VideoMonitor;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.utlis.MediaUtils;\r\nimport com.tencent.iot.hub.device.android.core.log.TXMqttLogCallBack;\r\nimport com.tencent.iot.hub.device.android.core.util.TXLog;\r\nimport com.tencent.iot.hub.device.java.core.common.Status;\r\nimport com.tencent.iot.hub.device.java.core.mqtt.TXMqttActionCallBack;\r\n\r\n\r\nimport org.eclipse.paho.client.mqttv3.IMqttToken;\r\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\r\n\r\nimport java.io.BufferedReader;\r\nimport java.io.BufferedWriter;\r\nimport java.io.ByteArrayInputStream;\r\nimport java.io.File;\r\nimport java.io.FileReader;\r\nimport java.io.FileWriter;\r\nimport java.io.IOException;\r\nimport java.io.InputStreamReader;\r\nimport java.nio.charset.Charset;\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\n\r\nimport static android.os.SystemClock.uptimeMillis;\r\n\r\n/**\r\n 遥控车辆进行移动\r\n */\r\npublic class RemoteControl extends Activity {\r\n\r\n    public String hostIP = /*\"192.168.0.108:18081\";*/\"10.6.206.20:30549\";\r\n    public String userId = \"6D的安卓測試機\";\r\n    public String vin = \"001\";\r\n\r\n    private final static String mLogPath = Environment.getExternalStorageDirectory().getPath() + \"/tencent/\";\r\n\r\n    public CountDownTimer countDownTimer;\r\n    private MainActivity mParent;\r\n    private MQTTSample mqttSample;\r\n\r\n    private PlayerView player;\r\n    private Context mContext;\r\n    private TextView  Speed;\r\n    private List<VideoijkBean> list;\r\n    private PowerManager.WakeLock wakeLock;\r\n    private View rootView;\r\n    private Activity mActivity;\r\n\r\n    private static final String TAG = \"FullscreenActivity\";\r\n    private boolean braking = true;\r\n    private int gearGlobal=0;\r\n    private int handBrakeStatus = 0;\r\n    private Button LlightingButton;\r\n    private ImageButton imageButton_forward,imageButton_backward;\r\n    private ImageView app_video_play;\r\n    private Spinner Video_Modul_Spinner;\r\n\r\n    private double wheelAngle=0.0;\r\n    private double speed=0.0;\r\n\r\n\r\n\r\n    /*虛擬機*/\r\n    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"android_test_phone\";\r\n    private String mDevPSK  = \"KdV+RSnHAlmEpM75aWZQZg==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/android_test_phone/data\";\r\n\r\n    /*OPPO A57t*/\r\n/*    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"OPPOA57t\";\r\n    private String mDevPSK  = \"TbtnFhJDmRe7N41vDBRVtA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/OPPOA57t/data\";  */  // productID/DeviceName/TopicName\r\n\r\n    /*真车配置*/\r\n    /*private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";\r\n    private String mProductID = \"KM8UZXZOV9\";\r\n    private String mDevName = \"android_test\";\r\n    private String mDevPSK  = \"+xRWqTlp0UPbwSKXVgiNxA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"KM8UZXZOV9/android_test/data\";    // productID/DeviceName/TopicName\r\n*/    private String mSubProductID = \"\"; // If you wont test gateway, let this to be null\r\n    private String mSubDevName = \"\";\r\n    private String mSubDevPsk = \"BuildConfig.SUB_DEVICE_PSK\";\r\n    private String mDevCertName = \"YOUR_DEVICE_NAME_cert.crt\";\r\n    private String mDevKeyName  = \"YOUR_DEVICE_NAME_private.key\";\r\n    private String mProductKey = \"BuildConfig.PRODUCT_KEY\";        // Used for dynamic register\r\n    private String mDevCert = \"\";           // Cert String\r\n    private String mDevPriv = \"\";           // Priv String\r\n\r\n    private volatile boolean mIsConnected=false;\r\n    ScalableImageView sImgView ;\r\n\r\n    @SuppressLint(\"InvalidWakeLockTag\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        Log.d(TAG, \"onCreate: \");\r\n        super.onCreate(savedInstanceState);\r\n        this.mContext = this;\r\n        this.mActivity = this;\r\n        rootView = getLayoutInflater().from(this).inflate(R.layout.activity_remote_control, null);\r\n\r\n        setContentView(rootView);\r\n\r\n        if (!mIsConnected) {\r\n            Log.d(TAG, \"onCreate: Connecting Mqtt\");\r\n            //轮询连接,万分感谢陈岩大佬\r\n            mqttSample= new MQTTSample(getApplication(), new SelfMqttActionCallBack(), mBrokerURL, mProductID, mDevName, mDevPSK,\r\n                    mDevCert, mDevPriv, mSubProductID, mSubDevName, mTestTopic, null, null, true, new SelfMqttLogCallBack());\r\n            Log.d(TAG, \"onCreate: mqttSample\"+mqttSample.toString());\r\n            mqttSample.connect();\r\n            sleep(2000);}\r\n        mqttSample.subscribeTopic();\r\n\r\n\r\n        shiftHandbrake(1);\r\n        Log.d(TAG, \"onCreate: \");\r\n\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                 while (true) {\r\n                     if(braking){\r\n                    try {\r\n\r\n                        moveVehicle(-0.1,0.0,wheelAngle);\r\n                        sleep(50);\r\n                    } catch (Exception e) {\r\n                        e.printStackTrace();\r\n                    }}\r\n            }\r\n        }}).start();\r\n\r\n        /**常亮*/\r\n        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);\r\n        wakeLock = pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK, \"liveTAG\");\r\n        wakeLock.acquire();\r\n\r\n        CompentOnTouch compentOnTouch = new CompentOnTouch();\r\n\r\n        //返回键\r\n        findViewById(R.id.back2).setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View V){\r\n                //对话框\r\n                AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                builder.setTitle(\"结束挪车\");//设置对话框的标题\r\n                builder.setMessage(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");//设置对话框的内容\r\n                builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                    @Override\r\n                    public void onClick(DialogInterface arg0, int arg1) {\r\n                        finish();\r\n                        Intent intent=new Intent(RemoteControl.this, MainActivity.class);\r\n                        startActivity(intent);\r\n                    }\r\n                });\r\n                builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                    @Override\r\n                    public void onClick(DialogInterface arg0, int arg1) {\r\n                        Toast.makeText(RemoteControl.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                        player.startPlay();\r\n                    }\r\n                });\r\n                AlertDialog b=builder.create();\r\n                b.show();\r\n                player.onPause();\r\n            }\r\n        });\r\n\r\n        imageButton_forward=findViewById(R.id.forward);\r\n        imageButton_forward.setOnTouchListener(compentOnTouch);\r\n\r\n        imageButton_backward=findViewById(R.id.backward);\r\n        imageButton_backward.setOnTouchListener(compentOnTouch);\r\n        sImgView = findViewById(R.id.steering_wheel);\r\n\r\n        //方向盘角度在速度处显示\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                while(true){\r\n                    wheelAngle = sImgView.getmDegree();\r\n                }\r\n            }\r\n        }).start();\r\n\r\n        countDownTimer=new CountDownTimer(100000,200) {\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                Speed = findViewById(R.id.speed);\r\n                Speed.setText(String.valueOf((int)wheelAngle));\r\n            }\r\n            @Override\r\n            public void onFinish() {\r\n            }\r\n        }.start();\r\n\r\n        //下拉单选按钮\r\n        Video_Modul_Spinner = (Spinner)findViewById(R.id.Spinner_VIdeo_Model);\r\n        Video_Modul_Spinner.setSelection(0);//进入不会自动播放\r\n        Video_Modul_Spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener(){\r\n            @Override\r\n            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {\r\n                    String result = parent.getItemAtPosition(position).toString();\r\n                    Toast.makeText(RemoteControl.this, result, Toast.LENGTH_SHORT).show();\r\n                    switch (position) {\r\n                        case 0: {\r\n                            /**前摄像*/\r\n                            list = new ArrayList<VideoijkBean>();\r\n                            String url1 = \"http://ivi.bupt.edu.cn/hls/cctv13.m3u8\";\r\n                            String url2 = \"rtmp://150.158.176.170/live/test_vin_1\";\r\n                            VideoijkBean m1 = new VideoijkBean();\r\n                            m1.setStream(\"原始视频\");\r\n                            m1.setUrl(url1);\r\n                            VideoijkBean m2 = new VideoijkBean();\r\n                            m2.setStream(\"融合视频\");\r\n                            m2.setUrl(url2);\r\n                            list.add(m1);\r\n                            list.add(m2);\r\n                            player = new PlayerView(mActivity, rootView)\r\n                                    .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                                    .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                                    .forbidTouch(false)\r\n                                    .hideSteam(false)\r\n                                    .hideMenu(true)\r\n                                    .hideCenterPlayer(true)\r\n                                    .hideBack(false)\r\n                                    .setOnlyFullScreen(true)\r\n                                    .setNetWorkTypeTie(false)\r\n                                    .hideRotation(true)\r\n                                    .hideFullscreen(true)\r\n                                    .hideBack(true)\r\n                                    .setChargeTie(true, 480)//设置最长播放时间\r\n                                    .showThumbnail(new OnShowThumbnailListener() {\r\n                                        @Override\r\n                                        public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                                            Glide.with(mContext)\r\n                                                    .load(R.drawable.pic_before_video)\r\n                                                    .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                                    .error(R.color.cl_error)//加载错误之后的错误图\r\n                                                    .into(ivThumbnail);\r\n                                        }\r\n                                    })\r\n                                    .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                                        @Override\r\n                                        public void onStartOrPause() {\r\n                                            //对话框\r\n                                            AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                                            builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                                            builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                                            builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    player.startPlay();\r\n                                                }\r\n                                            });\r\n                                            builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    finish();\r\n                                                    Intent intent=new Intent(RemoteControl.this,MainActivity.class);\r\n                                                    startActivity(intent);\r\n                                                }\r\n                                            });\r\n                                            AlertDialog b=builder.create();\r\n                                            b.show();\r\n                                        }\r\n                                    })\r\n                                    .setPlaySource(list)\r\n                                    .startPlay();\r\n                        }\r\n                        break;\r\n\r\n                        case 1: {\r\n                            /**后摄像*/\r\n                            String url3 = \"http://ivi.bupt.edu.cn/hls/cctv2.m3u8\";\r\n                            playVideoUrl(url3);\r\n                        }\r\n                        break;\r\n\r\n                        case 2: {\r\n                            /**左摄像*/\r\n                            String url4 = \"http://ivi.bupt.edu.cn/hls/cctv3.m3u8\";\r\n                            playVideoUrl(url4);\r\n                        }\r\n                        break;\r\n\r\n                        case 3: {\r\n                            /**右摄像*/\r\n                            String url5 = \"http://ivi.bupt.edu.cn/hls/cctv4.m3u8\";\r\n                            playVideoUrl(url5);\r\n\r\n                        }\r\n                        break;\r\n\r\n                        case 4: {\r\n                            /**上帝*/\r\n                            String url6 = \"http://ivi.bupt.edu.cn/hls/cctv13.m3u8\";\r\n                            playVideoUrl(url6);\r\n                        }\r\n                        break;\r\n\r\n                        default:\r\n                            break;\r\n                    }\r\n\r\n            }\r\n            @Override\r\n            public void onNothingSelected(AdapterView<?> parent) { }\r\n        });\r\n\r\n    }\r\n\r\n    //后四个视频播放器播放\r\n    public  void playVideoUrl( String url){\r\n        player = new PlayerView(mActivity, rootView)\r\n                .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                .forbidTouch(false)\r\n                .hideSteam(true)\r\n                .hideMenu(true)\r\n                .hideCenterPlayer(true)\r\n                .hideBack(false)\r\n                .setOnlyFullScreen(true)\r\n                .setNetWorkTypeTie(false)\r\n                .hideRotation(true)\r\n                .hideFullscreen(true)\r\n                .hideBack(true)\r\n                .setChargeTie(true, 480)//设置最长播放时间\r\n                .showThumbnail(new OnShowThumbnailListener() {\r\n                    @Override\r\n                    public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                        Glide.with(mContext)\r\n                                .load(R.drawable.pic_before_video)\r\n                                .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                .error(R.color.cl_error)//加载错误之后的错误图\r\n                                .into(ivThumbnail);\r\n                    }\r\n                })\r\n                .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                    @Override\r\n                    public void onStartOrPause() {\r\n                        //对话框\r\n                        AlertDialog.Builder builder = new AlertDialog.Builder(mContext);\r\n                        builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                        builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                        builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                player.startPlay();\r\n                            }\r\n                        });\r\n                        builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                finish();\r\n                                Intent intent = new Intent(RemoteControl.this, MainActivity.class);\r\n                                startActivity(intent);\r\n                            }\r\n                        });\r\n                        AlertDialog b = builder.create();\r\n                        b.show();\r\n                    }\r\n                })\r\n                .setPlaySource(url)\r\n                .startPlay();\r\n    }\r\n\r\n\r\n    /**\r\n    1表示手刹释放，0表示手刹锁定\r\n     **/\r\n\r\n    private void shiftHandbrake(int handbrakeToSet) {\r\n        if(handbrakeToSet!=handBrakeStatus){\r\n            for(int i=0;i<5;i++){\r\n                Handbrake mHandbrake = new Handbrake();\r\n                mHandbrake.setTimestamp(System.currentTimeMillis());\r\n                mHandbrake.setStatus(handbrakeToSet);\r\n                mHandbrake.setType(14);\r\n                mHandbrake.setTaskid(\"6D\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mHandbrake));\r\n                Log.d(TAG, \"onClick: 手刹\"+JSON.toJSONString(mHandbrake));\r\n                sleep(50);\r\n            }\r\n            handBrakeStatus=handbrakeToSet;}\r\n        else return;\r\n    }\r\n\r\n    /**\r\n    1,2,3,4分別對應P,R,N,D四個檔位\r\n     **/\r\n    private void shiftGear(final int gear){\r\n        if(speed==0){\r\n        for(int i=0;i<10;i++){\r\n                Gears mGear = new Gears();\r\n                mGear.setTimestamp(System.currentTimeMillis());\r\n                Log.d(TAG, \"onClick: \"+System.currentTimeMillis());\r\n                mGear.setGear(gear);\r\n                mGear.setType(13);\r\n                mGear.setTaskid(\"手機挂\"+gear+\"档\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mGear));\r\n                Log.d(TAG, \"onClick: \"+JSON.toJSONString(mGear));\r\n                sleep(50);\r\n        }\r\n        gearGlobal=gear;}\r\n        else {\r\n            moveVehicle(-0.3,0.0,0.0);\r\n            shiftGear(gear);\r\n        }\r\n    }\r\n\r\n    /**\r\n\r\n     @videoType\r\n     1为前方原始视频流，2为后方原始视频流，3为左侧原始视频流，4为右侧原始视频流，5为感知融合视频流，6为上帝视角视频流\r\n     @videoStatus\r\n     1为打开，0为关闭\r\n     */\r\n    private void shiftVideoType(int videoType,int videoStatus){\r\n        Video mVideo = new Video();\r\n        mVideo.setTimestamp(System.currentTimeMillis());\r\n        mVideo.setVideo_type(videoType);\r\n        mVideo.setOperation(videoStatus);\r\n        mVideo.setType(12);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        mqttSample.publishTopic(\"data\", JSON.toJSONString(mVideo));\r\n        Log.d(TAG, \"onClick: \"+JSON.toJSONString(mVideo));\r\n    }\r\n\r\n    /**\r\n     * @acceleration 加速度，正是加速，負的是減速\r\n     * @speed 目標速度\r\n     * @wheelAngle 方向盤轉角\r\n     */\r\n    private void moveVehicle(Double acceleration,Double speed,Double wheelAngle){\r\n        Control mMove = new Control();\r\n        mMove.setTimestamp(System.currentTimeMillis());\r\n        mMove.setAcceleration(acceleration);\r\n        mMove.setSpeed(speed);\r\n        mMove.setType(11);\r\n        mMove.setWheel_angle(wheelAngle);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        //mqttSample.publishTopic(\"data\", JSON.toJSONString(mMove));\r\n        //Log.d(TAG, \"onClick: 上传刹车\"+JSON.toJSONString(mMove));\r\n    }\r\n\r\n    @Override\r\n    protected void onPostCreate(Bundle savedInstanceState) {\r\n        super.onPostCreate(savedInstanceState);\r\n    }\r\n\r\n\r\n\r\n\r\n    //ms为需要休眠的时长\r\n    public static void sleep(long ms)\r\n    {\r\n        //uptimeMillis() Returns milliseconds since boot, not counting time spent in deep sleep.\r\n        long start = uptimeMillis();\r\n        long duration = ms;\r\n        boolean interrupted = false;\r\n        do {\r\n            try {\r\n                Thread.sleep(duration);\r\n            }\r\n            catch (InterruptedException e) {\r\n                interrupted = true;\r\n            }\r\n            duration = start + ms - uptimeMillis();\r\n        } while (duration > 0);\r\n\r\n        if (interrupted) {\r\n            Thread.currentThread().interrupt();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttActionCallBack回调接口\r\n     */\r\n    private class SelfMqttActionCallBack extends TXMqttActionCallBack {\r\n\r\n        @Override\r\n        public void onConnectCompleted(Status status, boolean reconnect, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onConnectCompleted, status[%s], reconnect[%b], userContext[%s], msg[%s]\",\r\n                    status.name(), reconnect, userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            if(status==Status.OK){\r\n             mIsConnected = true;}\r\n        }\r\n\r\n        @Override\r\n        public void onConnectionLost(Throwable cause) {\r\n            String logInfo = String.format(\"onConnectionLost, cause[%s]\", cause.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onDisconnectCompleted(Status status, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onDisconnectCompleted, status[%s], userContext[%s], msg[%s]\", status.name(), userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            mIsConnected = false;\r\n        }\r\n\r\n        @Override\r\n        public void onPublishCompleted(Status status, IMqttToken token, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onPublishCompleted, status[%s], topics[%s],  userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(token.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            if (Status.ERROR == status) {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            } else {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public void onUnSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onUnSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onMessageReceived(final String topic, final MqttMessage message) {\r\n            String logInfo = String.format(\"receive command, topic[%s], message[%s]\", topic, message.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttLogCallBack回调接口\r\n     */\r\n    private class SelfMqttLogCallBack extends TXMqttLogCallBack {\r\n\r\n        @Override\r\n        public String setSecretKey() {\r\n            String secertKey;\r\n            if (mDevPSK != null && mDevPSK.length() != 0) {  //密钥认证\r\n                secertKey = mDevPSK;\r\n                secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                return secertKey;\r\n            } else {\r\n                BufferedReader cert;\r\n\r\n                if (mDevCert != null && mDevCert.length() != 0) { //动态注册,从DevCert中读取\r\n                    cert = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(mDevCert.getBytes(Charset.forName(\"utf8\"))), Charset.forName(\"utf8\")));\r\n\r\n                } else { //证书认证，从证书文件中读取\r\n                    AssetManager assetManager = mParent.getAssets();\r\n                    if (assetManager == null) {\r\n                        return null;\r\n                    }\r\n                    try {\r\n                        cert=new BufferedReader(new InputStreamReader(assetManager.open(mDevCertName)));\r\n                    } catch (IOException e) {\r\n//                        mParent.printLogInfo(TAG, \"getSecertKey failed, cannot open CRT Files.\",mLogInfoText);\r\n                        return null;\r\n                    }\r\n                }\r\n                //获取密钥\r\n                try {\r\n                    if (cert.readLine().contains(\"-----BEGIN\")) {\r\n                        secertKey = cert.readLine();\r\n                        secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                    } else {\r\n                        secertKey = null;\r\n//                        mParent.printLogInfo(TAG,\"Invaild CRT Files.\", mLogInfoText);\r\n                    }\r\n                    cert.close();\r\n                } catch (IOException e) {\r\n                    TXLog.e(TAG, \"getSecertKey failed.\", e);\r\n//                    mParent.printLogInfo(TAG,\"getSecertKey failed.\", mLogInfoText);\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return secertKey;\r\n        }\r\n\r\n        @Override\r\n        public void printDebug(String message){\r\n//            mParent.printLogInfo(TAG, message, mLogInfoText);\r\n            //TXLog.d(TAG,message);\r\n        }\r\n\r\n        @Override\r\n        public boolean saveLogOffline(String log){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"saveLogOffline not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Save log to %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedWriter wLog = new BufferedWriter(new FileWriter(new File(logFilePath), true));\r\n                wLog.write(log);\r\n                wLog.flush();\r\n                wLog.close();\r\n                return true;\r\n            } catch (IOException e) {\r\n                String logInfo = String.format(\"Save log to [%s] failed, check the Storage permission!\", logFilePath);\r\n//                mParent.printLogInfo(TAG,logInfo, mLogInfoText);\r\n                e.printStackTrace();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public String readOfflineLog(){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"readOfflineLog not ready\", mLogInfoText);\r\n                return null;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Read log from %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedReader logReader = new BufferedReader(new FileReader(logFilePath));\r\n                StringBuilder offlineLog = new StringBuilder();\r\n                int data;\r\n                while (( data = logReader.read()) != -1 ) {\r\n                    offlineLog.append((char)data);\r\n                }\r\n                logReader.close();\r\n                return offlineLog.toString();\r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n                return null;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public boolean delOfflineLog(){\r\n\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"delOfflineLog not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            File file = new File(logFilePath);\r\n            if (file.exists() && file.isFile()) {\r\n                if (file.delete()) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    class\r\n    CompentOnTouch implements View.OnTouchListener {\r\n\r\n        public boolean isOnLongClick=false;\r\n        int i = 0;\r\n\r\n        @Override\r\n        public boolean onTouch(View view, MotionEvent motionEvent) {\r\n\r\n            switch (view.getId()) {\r\n// 这是btnMius下的一个层，为了增强易点击性\r\n                case R.id.backward:\r\n                    onTouchChange(\"backward\", motionEvent.getAction());\r\n                    break;\r\n// 这里也写，是为了增强易点击性\r\n                case R.id.forward:\r\n                    onTouchChange(\"forward\", motionEvent.getAction());\r\n                    break;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        private void onTouchChange(String methodName, int eventAction) {\r\n            Log.d(TAG, \"onTouchChange: \"+methodName+eventAction);\r\n            braking =false;\r\n// 按下松开分别对应启动停止前进方法\r\n            if (\"backward\".equals(methodName)) {\r\n                if(gearGlobal!=2){\r\n                shiftGear(2);}\r\n                MiusThread miusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    miusThread = new MiusThread();\r\n                    isOnLongClick = true;\r\n                    miusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\"+ braking);\r\n//                    Log.d(TAG, \"onTouchChange: isOnLongClick=false\"+miusThread.isInterrupted());\r\n                    if (miusThread != null) {\r\n                        miusThread.interrupt();\r\n                        Log.d(TAG, \"onTouchChange: 终止线程\");\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (miusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n// 按下松开分别对应启动停止加线程方法\r\n            else if (\"forward\".equals(methodName)) {\r\n                if(gearGlobal!=4){\r\n                shiftGear(4);}\r\n                PlusThread plusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    plusThread = new PlusThread();\r\n                    isOnLongClick = true;\r\n                    plusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\");\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        // 后退操作\r\n        class MiusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(2);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n\r\n        // 前进操作\r\n        class PlusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(1);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n        Handler myHandler = new Handler() {\r\n            public void handleMessage(Message msg) {\r\n                switch (msg.what) {\r\n                    case 1:\r\n                        //前进操作\r\n//                        Control mForward = new Control(5.0,0.1,wheelAngle);\r\n//                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mForward));\r\n//                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mForward));\r\n                        moveVehicle(0.1,5.0,wheelAngle);\r\n                        break;\r\n                    case 2:\r\n//                        Control mBackward = new Control(-5.0,0.1,wheelAngle);\r\n//                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBackward));\r\n//                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBackward));\r\n                        moveVehicle(0.1,-5.0,wheelAngle);\r\n                        Log.d(\"TAG\",\"Backward:\"+i--);\r\n                        break;\r\n                    case 3:\r\n                        Control mBreak = new Control(0.0,-0.1,wheelAngle);\r\n                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBreak));\r\n                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBreak));\r\n                        break;\r\n                }\r\n            };\r\n        };\r\n    }\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        if (player != null) {\r\n            player.onPause();\r\n        }\r\n        /**demo的内容，恢复系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, true);\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        if (player != null) {\r\n            player.onResume();\r\n        }\r\n        /**demo的内容，暂停系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, false);\r\n        /**demo的内容，激活设备常亮状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.acquire();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onDestroy() {\r\n        super.onDestroy();\r\n        if (player != null) {\r\n            for(int i=1;i<7;i++){\r\n            shiftVideoType(i,0);}\r\n            player.onDestroy();\r\n        }\r\n        if(speed!=0){moveVehicle(-0.3,0.0,0.0);}\r\n        if(braking){braking=false;}\r\n        if(gearGlobal!=1){shiftGear(1);}\r\n        if(handBrakeStatus==1){shiftHandbrake(0);}\r\n        if(mIsConnected){mqttSample.disconnect();}\r\n\r\n        Log.d(TAG, \"onDestroy: 斷開視頻以及MQTT連接\");\r\n    }\r\n\r\n    @Override\r\n    public void onConfigurationChanged(Configuration newConfig) {\r\n        super.onConfigurationChanged(newConfig);\r\n        if (player != null) {\r\n            player.onConfigurationChanged(newConfig);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onBackPressed() {\r\n        if (player != null && player.onBackPressed()) {\r\n            return;\r\n        }\r\n//        super.onBackPressed();\r\n        //对话框\r\n        AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n        builder.setTitle(\"结束挪车\");//设置对话框的标题\r\n        builder.setMessage(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");//设置对话框的内容\r\n        builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n            @Override\r\n            public void onClick(DialogInterface arg0, int arg1) {\r\n                finish();\r\n                Intent intent=new Intent(RemoteControl.this, MainActivity.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n        builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n            @Override\r\n            public void onClick(DialogInterface arg0, int arg1) {\r\n                Toast.makeText(RemoteControl.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                player.startPlay();\r\n            }\r\n        });\r\n        AlertDialog b=builder.create();\r\n        b.show();\r\n        player.onPause();\r\n        /**demo的内容，恢复设备亮度状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.release();\r\n        }\r\n    }\r\n}\r\n
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(date 1609143918176)
--@@ -107,11 +107,13 @@
-- 
-- 
--     /*虛擬機*/
--+/*
--     private String mBrokerURL = "ssl://fawtsp-mqtt-public-dev.faw.cn:8883";  //传入null，即使用腾讯云物联网通信默认地址 "${ProductId}.iotcloud.tencentdevices.com:8883"  https://cloud.tencent.com/document/product/634/32546
--     private String mProductID = "2N8PWJAI0V";
--     private String mDevName = "android_test_phone";
--     private String mDevPSK  = "KdV+RSnHAlmEpM75aWZQZg=="; //若使用证书验证，设为null
--     private String mTestTopic = "2N8PWJAI0V/android_test_phone/data";
--+*/
-- 
--     /*OPPO A57t*/
-- /*    private String mBrokerURL = "ssl://fawtsp-mqtt-public-dev.faw.cn:8883";  //传入null，即使用腾讯云物联网通信默认地址 "${ProductId}.iotcloud.tencentdevices.com:8883"  https://cloud.tencent.com/document/product/634/32546
--@@ -121,12 +123,12 @@
--     private String mTestTopic = "2N8PWJAI0V/OPPOA57t/data";  */  // productID/DeviceName/TopicName
-- 
--     /*真车配置*/
---    /*private String mBrokerURL = "ssl://fawtsp-mqtt-public-dev.faw.cn:8883";
--+    private String mBrokerURL = "ssl://fawtsp-mqtt-public-dev.faw.cn:8883";
--     private String mProductID = "KM8UZXZOV9";
--     private String mDevName = "android_test";
--     private String mDevPSK  = "+xRWqTlp0UPbwSKXVgiNxA=="; //若使用证书验证，设为null
--     private String mTestTopic = "KM8UZXZOV9/android_test/data";    // productID/DeviceName/TopicName
---*/    private String mSubProductID = ""; // If you wont test gateway, let this to be null
--+    private String mSubProductID = ""; // If you wont test gateway, let this to be null
--     private String mSubDevName = "";
--     private String mSubDevPsk = "BuildConfig.SUB_DEVICE_PSK";
--     private String mDevCertName = "YOUR_DEVICE_NAME_cert.crt";
--@@ -157,6 +159,7 @@
--             Log.d(TAG, "onCreate: mqttSample"+mqttSample.toString());
--             mqttSample.connect();
--             sleep(2000);}
--+
--         mqttSample.subscribeTopic();
-- 
-- 
--@@ -169,7 +172,6 @@
--                  while (true) {
--                      if(braking){
--                     try {
---
--                         moveVehicle(-0.1,0.0,wheelAngle);
--                         sleep(50);
--                     } catch (Exception e) {
--@@ -223,18 +225,10 @@
--         sImgView = findViewById(R.id.steering_wheel);
-- 
--         //方向盘角度在速度处显示
---        new Thread(new Runnable() {
---            @Override
---            public void run() {
---                while(true){
---                    wheelAngle = sImgView.getmDegree();
---                }
---            }
---        }).start();
---
---        countDownTimer=new CountDownTimer(100000,200) {
--+        countDownTimer=new CountDownTimer(1000000,200) {
--             @Override
--             public void onTick(long millisUntilFinished) {
--+                wheelAngle = sImgView.getmDegree();
--                 Speed = findViewById(R.id.speed);
--                 Speed.setText(String.valueOf((int)wheelAngle));
--             }
--@@ -767,8 +761,7 @@
--             braking =false;
-- // 按下松开分别对应启动停止前进方法
--             if ("backward".equals(methodName)) {
---                if(gearGlobal!=2){
---                shiftGear(2);}
--+//                if(gearGlobal!=2){ shiftGear(2);}
--                 MiusThread miusThread = null;
--                 if (eventAction == MotionEvent.ACTION_DOWN) {
--                     miusThread = new MiusThread();
--@@ -792,8 +785,7 @@
--             }
-- // 按下松开分别对应启动停止加线程方法
--             else if ("forward".equals(methodName)) {
---                if(gearGlobal!=4){
---                shiftGear(4);}
--+//                if(gearGlobal!=4){ shiftGear(4);}
--                 PlusThread plusThread = null;
--                 if (eventAction == MotionEvent.ACTION_DOWN) {
--                     plusThread = new PlusThread();
--@@ -928,7 +920,7 @@
--         }
--         if(speed!=0){moveVehicle(-0.3,0.0,0.0);}
--         if(braking){braking=false;}
---        if(gearGlobal!=1){shiftGear(1);}
--+//        if(gearGlobal!=1){shiftGear(1);}
--         if(handBrakeStatus==1){shiftHandbrake(0);}
--         if(mIsConnected){mqttSample.disconnect();}
-- 
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControlInitial.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.app.Activity;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.view.View;\r\nimport android.view.WindowManager;\r\nimport android.widget.ImageButton;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\n\r\npublic class RemoteControlInitial extends Activity {\r\n\r\n    private Context mContext;\r\n    private ImageButton StartRemove;\r\n    private ImageButton imageButton_forward,imageButton_backward;\r\n    private TextView speedTextView;\r\n    private double wheelAngle=0.0;\r\n\r\n\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        getWindow().addFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);\r\n\r\n        //一直连接Iothub\r\n\r\n\r\n\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_remote_controlinitial);\r\n        this.mContext = this;\r\n        CountDownTimer countDownTimer = new CountDownTimer(100000, 200) {\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                speedTextView = findViewById(R.id.speed);\r\n                speedTextView.setText(String.valueOf((int) wheelAngle));\r\n            }\r\n\r\n            @Override\r\n            public void onFinish() {\r\n            }\r\n        }.start();\r\n\r\n\r\n        StartRemove= (ImageButton)findViewById(R.id.startRemove);\r\n        StartRemove.setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View V){\r\n\r\n                        //IotHub连接成功弹出对话框，否则提示当前连接车辆失败\r\n                        AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                        builder.setTitle(\"开始挪车\");//设置对话框的标题\r\n                        builder.setMessage(\"挪车功能提供用户通过手机遥控移动车辆的功能请问您要开始挪车吗？\");//设置对话框的内容\r\n                        builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                Intent intent=new Intent(RemoteControlInitial.this, RemoteControl.class);\r\n                                startActivity(intent);\r\n                            }\r\n                        });\r\n                        builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                Toast.makeText(RemoteControlInitial.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                            }\r\n                        });\r\n                        AlertDialog b=builder.create();\r\n                        b.show();\r\n                    }\r\n                 });\r\n    }\r\n}\r\n\r\n
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControlInitial.java	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControlInitial.java	(date 1609118932672)
--@@ -22,6 +22,8 @@
--     private ImageButton imageButton_forward,imageButton_backward;
--     private TextView speedTextView;
--     private double wheelAngle=0.0;
--+    ScalableImageView sImgView ;
--+
-- 
-- 
-- 
--@@ -29,16 +31,16 @@
--     protected void onCreate(Bundle savedInstanceState) {
--         getWindow().addFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);
-- 
---        //一直连接Iothub
---
---
---
--         super.onCreate(savedInstanceState);
--         setContentView(R.layout.activity_remote_controlinitial);
--         this.mContext = this;
---        CountDownTimer countDownTimer = new CountDownTimer(100000, 200) {
--+
--+        sImgView = findViewById(R.id.steering_wheel);
--+
--+        CountDownTimer countDownTimer = new CountDownTimer(1000000, 200) {
--             @Override
--             public void onTick(long millisUntilFinished) {
--+                wheelAngle=sImgView.getmDegree();
--                 speedTextView = findViewById(R.id.speed);
--                 speedTextView.setText(String.valueOf((int) wheelAngle));
--             }
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/ScalableImageView.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.content.Context;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapFactory;\r\nimport android.graphics.Matrix;\r\nimport android.graphics.Point;\r\nimport android.graphics.PointF;\r\nimport android.util.AttributeSet;\r\nimport android.util.Log;\r\nimport android.view.MotionEvent;\r\nimport android.view.animation.RotateAnimation;\r\n\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport static android.content.ContentValues.TAG;\r\n\r\n\r\n/**\r\n * Fixed on 2020/9/17,which is a happy day!\r\n */\r\npublic class ScalableImageView extends androidx.appcompat.widget.AppCompatImageView{\r\n\r\n\r\n    private static final double MAX_DEGREE = 600.0;//方向盘最大转角\r\n    private Matrix matrix;\r\n    private Matrix cacheMatrix;  //缓存的matrix ，同时记录上一次滑动的位置\r\n    private float mPointDistinct = 1f;\r\n    private  double mDegree=0.0;// 旋转的ScalableImageView角度\r\n    double radius0 =0.0;\r\n\r\n\r\n    private Bitmap bitmap;\r\n\r\n    public  Double getmDegree() {\r\n        return mDegree;\r\n\r\n    }\r\n\r\n    List<Double> angleList= new ArrayList<>();//For story the angle data\r\n    List<PointF> pointFList = new ArrayList<>();\r\n    PointF point2store=new PointF();\r\n    int circle =0;\r\n    double degree0 = 0.0;//按下角度\r\n    double degree = 0.0;//转动角度\r\n    double radiusLast;\r\n    double degreeLast;\r\n    double radiusNow;\r\n    double degreeNow;\r\n    double delta_degree;\r\n\r\n    enum Mode {\r\n        NONE, DOWN, MOVE\r\n    }\r\n\r\n    private Mode mode; //当前mode\r\n    private Context mContext;\r\n\r\n    private PointF mStart = new PointF();\r\n\r\n    public ScalableImageView(Context context) {\r\n        this(context, null);\r\n    }\r\n\r\n    public ScalableImageView(Context context, AttributeSet attrs) {\r\n        this(context, attrs, 0);\r\n    }\r\n\r\n    public ScalableImageView(Context context, AttributeSet attrs, int defStyleAttr) {\r\n        super(context, attrs, defStyleAttr);\r\n        this.mContext = context;\r\n        init();\r\n    }\r\n\r\n    private void init() {\r\n        circle = 0;\r\n        degree = 0.0;\r\n        degree0 = 0.0;\r\n        mDegree = 0.0;\r\n        radius0 = 0.0;\r\n        matrix = new Matrix();\r\n        cacheMatrix = new Matrix();\r\n        pointFList.clear();\r\n        mode = Mode.NONE;\r\n        bitmap= BitmapFactory.decodeResource(getResources(), R.drawable.steering_wheel);  //避免OOM\r\n        setImageBitmap(bitmap);\r\n    }\r\n\r\n    @Override\r\n    public boolean onTouchEvent(MotionEvent event) {\r\n        switch (event.getAction() & MotionEvent.ACTION_MASK) {\r\n            case MotionEvent.ACTION_DOWN:\r\n            case MotionEvent.ACTION_POINTER_DOWN:\r\n                cacheMatrix.set(matrix); //先拷贝一份到缓存\r\n                float delta_x0 = (event.getX()- bitmap.getWidth()/2);\r\n                float delta_y0 = (event.getY() - bitmap.getHeight()/ 2);\r\n                radius0 = Math.atan2(delta_y0,delta_x0);\r\n                degree0= (Double) Math.toDegrees(radius0);\r\n                Log.d(TAG, \"onTouchEvent: 初始角度\"+degree0);\r\n                mode = Mode.DOWN;\r\n                mStart.set(delta_x0, delta_y0);\r\n                pointFList.add(mStart);\r\n                break;\r\n\r\n            case MotionEvent.ACTION_MOVE:\r\n                //单点触控的时候\r\n                if (mode == Mode.DOWN) {\r\n                    matrix.set(cacheMatrix);\r\n                    float delta_x = (event.getX()- bitmap.getWidth()/2);\r\n                    float delta_y = (event.getY() - bitmap.getHeight()/ 2);\r\n\r\n                    pointFList.add(new PointF(delta_x,delta_y));\r\n                    if(pointFList.size()>5){\r\n                        for(int i=0;i<pointFList.size()-5;i++){\r\n                            pointFList.remove(i);\r\n                        }\r\n                    }\r\n                    if(pointFList.size()>=2){\r\n                        for(int i=0;i<pointFList.size();i++){\r\n                            Log.d(TAG, \"onTouchEvent: \\n第\"+i+\"个点：\"+pointFList.get(i).x+\",\"+pointFList.get(i).y+\"\\n\");\r\n                        }\r\n                         radiusLast = Math.atan2(pointFList.get(pointFList.size()-2).y,pointFList.get(pointFList.size()-2).x);\r\n                         degreeLast = Math.toDegrees(radiusLast);\r\n                         radiusNow = Math.atan2(pointFList.get(pointFList.size()-1).y,pointFList.get(pointFList.size()-1).x);\r\n                         degreeNow = Math.toDegrees(radiusNow);\r\n                         delta_degree = degreeNow - degreeLast;\r\n                        if(delta_degree<=0&&Math.abs(delta_degree)<180){\r\n                            mDegree=mDegree-Math.abs(delta_degree);\r\n                        }else if(delta_degree<=0&&Math.abs(delta_degree)>=180){\r\n                            mDegree= mDegree+360-Math.abs(delta_degree);\r\n                        }else if(delta_degree>0&&Math.abs(delta_degree)<180){\r\n                            mDegree= mDegree+Math.abs(delta_degree);\r\n                        }else if(delta_degree>0&&Math.abs(delta_degree)>=180){\r\n                            mDegree= mDegree-360+Math.abs(delta_degree);\r\n                        }\r\n                        Log.d(TAG, \"onTouchEvent: 現在角度\"+mDegree);\r\n                    }\r\n                    if(mDegree>MAX_DEGREE) {mDegree = MAX_DEGREE;}\r\n                    if(mDegree<-MAX_DEGREE){mDegree =-MAX_DEGREE;}\r\n\r\n                    /*double radius = Math.atan2(delta_y,delta_x);\r\n                    Log.d(TAG, \"onTouchEvent: pass弧度\"+(radius-radius0));\r\n                    //向量叉乘判斷正負\r\n                    if(event.getY()-mStart.y>0){\r\n                        Log.d(TAG, \"onTouchEvent: 順時針\"+Math.atan2(1,-1));\r\n//                        degree=degree+360;\r\n                    }else {\r\n                        Log.d(TAG, \"onTouchEvent: 逆時針\"+Math.atan2(-1,1));\r\n                    }\r\n\r\n                    Log.d(TAG, \"onTouchEvent: 現在弧度\"+radius);\r\n                    Log.d(TAG, \"onTouchEvent: 現在角度\"+Math.toDegrees(radius));\r\n                    degree= (Double) Math.toDegrees(radius)-degree0;\r\n                    Log.d(TAG, \"onTouchEvent: 旋轉角度\"+degree);\r\n                    angleList.add(degree);\r\n                    if(angleList.size()>5){\r\n                        for(int i=0;i<angleList.size()-5;i++){\r\n                            angleList.remove(i);\r\n                        }\r\n                    }\r\n                    if(angleList.size()>2) {\r\n                        //\r\n                        Log.d(TAG, \"onTouchEvent: \\n當前角度\"+angleList.get(angleList.size() - 1)+\"上次角度\"+angleList.get(angleList.size() - 2));\r\n                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) > 300)\r\n                        {\r\n//                            circle--;\r\n                        Log.d(TAG, \"onTouchEvent: 減了一圈\"+circle);}\r\n                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) < -300)\r\n                        {\r\n//                            circle++;\r\n                        Log.d(TAG, \"onTouchEvent: 加了一圈\"+circle);}\r\n                        degree = degree + 360 * circle;\r\n\r\n                        if(degree>MAX_DEGREE) {degree = MAX_DEGREE;}\r\n                        if(degree<-MAX_DEGREE){degree =-MAX_DEGREE;}\r\n                    }\r\n                    Log.d(\"赋值Degree\",mDegree+\"\");\r\n                    mDegree = degree;*/\r\n\r\n//                    final RotateAnimation rotateAnimation = new RotateAnimation(0f, (float)degree, bitmap.getWidth() / 2, bitmap.getHeight() / 2);\r\n                    matrix.postRotate((float) mDegree,bitmap.getWidth()/2, bitmap.getHeight()/ 2);\r\n                }\r\n                break;\r\n            case MotionEvent.ACTION_UP:\r\n                init();\r\n            case MotionEvent.ACTION_POINTER_UP:\r\n            case MotionEvent.ACTION_CANCEL:\r\n                mode = Mode.NONE;\r\n                break;\r\n        }\r\n        setImageMatrix(matrix);\r\n        return true;\r\n    }\r\n\r\n}
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/ScalableImageView.java	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/ScalableImageView.java	(date 1609143509506)
--@@ -28,8 +28,7 @@
--     private static final double MAX_DEGREE = 600.0;//方向盘最大转角
--     private Matrix matrix;
--     private Matrix cacheMatrix;  //缓存的matrix ，同时记录上一次滑动的位置
---    private float mPointDistinct = 1f;
---    private  double mDegree=0.0;// 旋转的ScalableImageView角度
--+    private double mDegree=0.0;// 旋转的ScalableImageView角度
--     double radius0 =0.0;
-- 
-- 
--@@ -40,12 +39,10 @@
-- 
--     }
-- 
---    List<Double> angleList= new ArrayList<>();//For story the angle data
---    List<PointF> pointFList = new ArrayList<>();
--+    List<PointF> pointFList = new ArrayList<>();//儲存最近劃過的幾個點
--     PointF point2store=new PointF();
---    int circle =0;
--+
--     double degree0 = 0.0;//按下角度
---    double degree = 0.0;//转动角度
--     double radiusLast;
--     double degreeLast;
--     double radiusNow;
--@@ -59,8 +56,6 @@
--     private Mode mode; //当前mode
--     private Context mContext;
-- 
---    private PointF mStart = new PointF();
---
--     public ScalableImageView(Context context) {
--         this(context, null);
--     }
--@@ -76,8 +71,6 @@
--     }
-- 
--     private void init() {
---        circle = 0;
---        degree = 0.0;
--         degree0 = 0.0;
--         mDegree = 0.0;
--         radius0 = 0.0;
--@@ -85,7 +78,7 @@
--         cacheMatrix = new Matrix();
--         pointFList.clear();
--         mode = Mode.NONE;
---        bitmap= BitmapFactory.decodeResource(getResources(), R.drawable.steering_wheel);  //避免OOM
--+        bitmap= BitmapFactory.decodeResource(getResources(), R.drawable.steering_wheel_2);  //避免OOM
--         setImageBitmap(bitmap);
--     }
-- 
--@@ -101,8 +94,7 @@
--                 degree0= (Double) Math.toDegrees(radius0);
--                 Log.d(TAG, "onTouchEvent: 初始角度"+degree0);
--                 mode = Mode.DOWN;
---                mStart.set(delta_x0, delta_y0);
---                pointFList.add(mStart);
--+                pointFList.add(new PointF(delta_x0,delta_y0));
--                 break;
-- 
--             case MotionEvent.ACTION_MOVE:
--@@ -119,9 +111,6 @@
--                         }
--                     }
--                     if(pointFList.size()>=2){
---                        for(int i=0;i<pointFList.size();i++){
---                            Log.d(TAG, "onTouchEvent: \n第"+i+"个点："+pointFList.get(i).x+","+pointFList.get(i).y+"\n");
---                        }
--                          radiusLast = Math.atan2(pointFList.get(pointFList.size()-2).y,pointFList.get(pointFList.size()-2).x);
--                          degreeLast = Math.toDegrees(radiusLast);
--                          radiusNow = Math.atan2(pointFList.get(pointFList.size()-1).y,pointFList.get(pointFList.size()-1).x);
--@@ -141,46 +130,6 @@
--                     if(mDegree>MAX_DEGREE) {mDegree = MAX_DEGREE;}
--                     if(mDegree<-MAX_DEGREE){mDegree =-MAX_DEGREE;}
-- 
---                    /*double radius = Math.atan2(delta_y,delta_x);
---                    Log.d(TAG, "onTouchEvent: pass弧度"+(radius-radius0));
---                    //向量叉乘判斷正負
---                    if(event.getY()-mStart.y>0){
---                        Log.d(TAG, "onTouchEvent: 順時針"+Math.atan2(1,-1));
---//                        degree=degree+360;
---                    }else {
---                        Log.d(TAG, "onTouchEvent: 逆時針"+Math.atan2(-1,1));
---                    }
---
---                    Log.d(TAG, "onTouchEvent: 現在弧度"+radius);
---                    Log.d(TAG, "onTouchEvent: 現在角度"+Math.toDegrees(radius));
---                    degree= (Double) Math.toDegrees(radius)-degree0;
---                    Log.d(TAG, "onTouchEvent: 旋轉角度"+degree);
---                    angleList.add(degree);
---                    if(angleList.size()>5){
---                        for(int i=0;i<angleList.size()-5;i++){
---                            angleList.remove(i);
---                        }
---                    }
---                    if(angleList.size()>2) {
---                        //
---                        Log.d(TAG, "onTouchEvent: \n當前角度"+angleList.get(angleList.size() - 1)+"上次角度"+angleList.get(angleList.size() - 2));
---                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) > 300)
---                        {
---//                            circle--;
---                        Log.d(TAG, "onTouchEvent: 減了一圈"+circle);}
---                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) < -300)
---                        {
---//                            circle++;
---                        Log.d(TAG, "onTouchEvent: 加了一圈"+circle);}
---                        degree = degree + 360 * circle;
---
---                        if(degree>MAX_DEGREE) {degree = MAX_DEGREE;}
---                        if(degree<-MAX_DEGREE){degree =-MAX_DEGREE;}
---                    }
---                    Log.d("赋值Degree",mDegree+"");
---                    mDegree = degree;*/
---
---//                    final RotateAnimation rotateAnimation = new RotateAnimation(0f, (float)degree, bitmap.getWidth() / 2, bitmap.getHeight() / 2);
--                     matrix.postRotate((float) mDegree,bitmap.getWidth()/2, bitmap.getHeight()/ 2);
--                 }
--                 break;
--Index: app/src/main/res/layout/activity_remote_controlinitial.xml
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n\r\n    tools:context=\".remotecontrol.RemoteControl\">\r\n\r\n\r\n    <include\r\n        layout=\"@layout/remove_topbar\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginTop=\"10dp\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <ImageButton\r\n        android:id=\"@+id/startRemove\"\r\n        android:layout_width=\"100dp\"\r\n        android:layout_height=\"40dp\"\r\n        android:background=\"#00000000\"\r\n        android:scaleType=\"fitXY\"\r\n        android:src=\"@drawable/start_remove_btn\"\r\n        android:text=\"开始挪车\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintHorizontal_bias=\"0.5\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        android:layout_marginBottom=\"10dp\">\r\n    </ImageButton>\r\n\r\n    <ImageView\r\n        android:id=\"@+id/basicImageView2\"\r\n        android:layout_width=\"300dp\"\r\n        android:layout_height=\"300dp\"\r\n        android:src=\"@drawable/sensebg\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintLeft_toLeftOf=\"parent\"\r\n        app:layout_constraintRight_toRightOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        app:layout_constraintVertical_bias=\"0.55\" />\r\n\r\n    <include\r\n        layout=\"@layout/remove_bottombar\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintHorizontal_bias=\"0.0\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        android:layout_marginBottom=\"10dp\"\r\n       />\r\n\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/res/layout/activity_remote_controlinitial.xml	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/res/layout/activity_remote_controlinitial.xml	(date 1609123285932)
--@@ -9,16 +9,20 @@
-- 
-- 
--     <include
--+        android:id="@+id/include"
--         layout="@layout/remove_topbar"
---        android:layout_width="match_parent"
--+        android:layout_width="0dp"
--         android:layout_height="wrap_content"
--         android:layout_marginTop="10dp"
--+        app:layout_constraintEnd_toEndOf="parent"
--+        app:layout_constraintStart_toStartOf="parent"
--         app:layout_constraintTop_toTopOf="parent" />
-- 
--     <ImageButton
--         android:id="@+id/startRemove"
--         android:layout_width="100dp"
--         android:layout_height="40dp"
--+        android:layout_marginBottom="10dp"
--         android:background="#00000000"
--         android:scaleType="fitXY"
--         android:src="@drawable/start_remove_btn"
--@@ -26,12 +30,10 @@
--         app:layout_constraintBottom_toBottomOf="parent"
--         app:layout_constraintEnd_toEndOf="parent"
--         app:layout_constraintHorizontal_bias="0.5"
---        app:layout_constraintStart_toStartOf="parent"
---        android:layout_marginBottom="10dp">
---    </ImageButton>
--+        app:layout_constraintStart_toStartOf="parent"></ImageButton>
-- 
--     <ImageView
---        android:id="@+id/basicImageView2"
--+        android:id="@+id/imageView"
--         android:layout_width="300dp"
--         android:layout_height="300dp"
--         android:src="@drawable/sensebg"
--@@ -42,15 +44,15 @@
--         app:layout_constraintVertical_bias="0.55" />
-- 
--     <include
--+        android:id="@+id/include2"
--         layout="@layout/remove_bottombar"
--         android:layout_width="match_parent"
--         android:layout_height="wrap_content"
--+        android:layout_marginBottom="10dp"
--         app:layout_constraintBottom_toBottomOf="parent"
--         app:layout_constraintEnd_toEndOf="parent"
--         app:layout_constraintHorizontal_bias="0.0"
---        app:layout_constraintStart_toStartOf="parent"
---        android:layout_marginBottom="10dp"
---       />
--+        app:layout_constraintStart_toStartOf="parent" />
-- 
-- 
-- </androidx.constraintlayout.widget.ConstraintLayout>
--\ No newline at end of file
--diff --git .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_26_16_07__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_26_16_07__Default_Changelist_.xml
-Index: .idea/shelf/Uncommitted_changes_before_Checkout_at_2020_12_28_12_01_[Default_Changelist]/shelved.patch
-===================================================================
---- .idea/shelf/Uncommitted_changes_before_Checkout_at_2020_12_28_12_01_[Default_Changelist]/shelved.patch	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-+++ .idea/shelf/Uncommitted_changes_before_Checkout_at_2020_12_28_12_01_[Default_Changelist]/shelved.patch	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-@@ -1,181 +0,0 @@
--Index: app/src/main/res/layout/activity_remote_control.xml
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n\r\n    tools:context=\".remotecontrol.RemoteControl\">\r\n\r\n\r\n    <ImageButton\r\n        android:id=\"@+id/light\"\r\n        android:layout_width=\"200px\"\r\n        android:layout_height=\"200px\"\r\n        android:layout_marginEnd=\"10dp\"\r\n        android:layout_marginBottom=\"10dp\"\r\n        android:background=\"#00000000\"\r\n        android:scaleType=\"fitXY\"\r\n        android:src=\"@drawable/light\"\r\n        app:layout_constraintBottom_toTopOf=\"@+id/remove_bottombar_2\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\" />\r\n\r\n    <Spinner\r\n        android:id=\"@+id/Spinner_VIdeo_Model\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginStart=\"56dp\"\r\n        android:layout_marginBottom=\"328dp\"\r\n        android:background=\"@color/cl_error\"\r\n        android:entries=\"@array/Video_Model\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\" />\r\n\r\n    <include\r\n        layout=\"@layout/simple_player_view_player\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\"\r\n        android:layout_marginLeft=\"200dp\"\r\n        android:layout_marginRight=\"100dp\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n    <include\r\n        layout=\"@layout/remove_topbar\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        android:layout_marginTop=\"10dp\"\r\n        />\r\n\r\n    <include\r\n        android:id=\"@+id/remove_bottombar_2\"\r\n        layout=\"@layout/remove_bottombar\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        android:layout_marginBottom=\"10dp\"\r\n       />\r\n\r\n\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/res/layout/activity_remote_control.xml	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/res/layout/activity_remote_control.xml	(date 1609126935693)
--@@ -4,7 +4,6 @@
--     xmlns:tools="http://schemas.android.com/tools"
--     android:layout_width="match_parent"
--     android:layout_height="match_parent"
---
--     tools:context=".remotecontrol.RemoteControl">
-- 
-- 
--@@ -24,12 +23,12 @@
--         android:id="@+id/Spinner_VIdeo_Model"
--         android:layout_width="wrap_content"
--         android:layout_height="wrap_content"
---        android:layout_marginStart="56dp"
---        android:layout_marginBottom="328dp"
---        android:background="@color/cl_error"
--+        android:layout_marginTop="30dp"
--+        android:layout_marginStart="60dp"
--         android:entries="@array/Video_Model"
---        app:layout_constraintBottom_toBottomOf="parent"
---        app:layout_constraintStart_toStartOf="parent" />
--+        app:layout_constraintTop_toBottomOf="@+id/remove_topbar_2"
--+        app:layout_constraintStart_toStartOf="parent"
--+        />
-- 
--     <include
--         layout="@layout/simple_player_view_player"
--@@ -42,6 +41,7 @@
--         app:layout_constraintStart_toStartOf="parent"
--         app:layout_constraintTop_toTopOf="parent" />
--     <include
--+        android:id="@+id/remove_topbar_2"
--         layout="@layout/remove_topbar"
--         android:layout_width="match_parent"
--         android:layout_height="wrap_content"
--Index: app/src/main/res/values/arrays.xml
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<resources>\r\n    <string-array name=\"Video_Model\">\r\n        <item>前摄像</item>\r\n        <item>后摄像</item>\r\n        <item>左摄像</item>\r\n        <item>右摄像</item>\r\n        <item>上帝视角</item>\r\n    </string-array>\r\n\r\n    <declare-styleable name=\"ButtonBarContainerTheme\">\r\n        <attr name=\"metaButtonBarStyle\" format=\"reference\" />\r\n        <attr name=\"metaButtonBarButtonStyle\" format=\"reference\" />\r\n    </declare-styleable>\r\n</resources>\r\n
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/res/values/arrays.xml	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/res/values/arrays.xml	(date 1609126479556)
--@@ -1,10 +1,10 @@
-- <?xml version="1.0" encoding="utf-8"?>
-- <resources>
--     <string-array name="Video_Model">
---        <item>前摄像</item>
---        <item>后摄像</item>
---        <item>左摄像</item>
---        <item>右摄像</item>
--+        <item>前视角</item>
--+        <item>后视角</item>
--+        <item>左视角</item>
--+        <item>右视角</item>
--         <item>上帝视角</item>
--     </string-array>
-- 
--Index: app/src/main/res/layout/activity_auto_parking_in.xml
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".autopark.AutoParkingIn\"\r\n    tools:ignore=\"MissingDefaultResource\">\r\n    <include\r\n        layout=\"@layout/remove_topbar_base\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        />\r\n\r\n    <ImageView\r\n        android:id=\"@+id/map\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"400dp\"\r\n        android:src=\"@drawable/map\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintHorizontal_bias=\"0.0\"\r\n        app:layout_constraintLeft_toLeftOf=\"parent\"\r\n        app:layout_constraintRight_toRightOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        app:layout_constraintVertical_bias=\"0.334\" />\r\n\r\n    <androidx.constraintlayout.widget.ConstraintLayout\r\n        android:id=\"@+id/constraintlayout2\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"0dp\"\r\n        android:layout_marginStart=\"@dimen/activity_horizontal_margin\"\r\n        android:layout_marginEnd=\"@dimen/activity_horizontal_margin\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/map\"\r\n        >\r\n\r\n        <TextView\r\n            android:id=\"@+id/text123\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"20dp\"\r\n            android:text=\"正在寻找车位...\"\r\n            android:textSize=\"15dp\"\r\n            android:layout_marginTop=\"10dp\"\r\n            android:layout_marginEnd=\"100dp\"\r\n            app:layout_constraintTop_toTopOf=\"parent\"\r\n            />\r\n    <TextView\r\n        android:id=\"@+id/Outputfield\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"0dp\"\r\n        android:textSize=\"15dp\"\r\n        android:fadeScrollbars=\"false\"\r\n        android:scrollbars=\"vertical\"\r\n        android:focusable=\"false\"\r\n        android:layout_marginEnd=\"100dp\"\r\n        app:layout_constraintTop_toBottomOf=\"@id/text123\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n         />\r\n\r\n        <ImageButton\r\n            android:id=\"@+id/Pause\"\r\n            android:layout_width=\"80dp\"\r\n            android:layout_height=\"35dp\"\r\n            android:layout_marginEnd=\"20dp\"\r\n            android:background=\"@color/cl_error\"\r\n            android:scaleType=\"fitXY\"\r\n            android:src=\"@drawable/pause\"\r\n            app:layout_constraintBottom_toBottomOf=\"parent\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/res/layout/activity_auto_parking_in.xml	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/res/layout/activity_auto_parking_in.xml	(date 1609123008789)
--@@ -49,7 +49,7 @@
--             android:layout_marginEnd="100dp"
--             app:layout_constraintTop_toTopOf="parent"
--             />
---    <TextView
--+        <TextView
--         android:id="@+id/Outputfield"
--         android:layout_width="match_parent"
--         android:layout_height="0dp"
--@@ -73,7 +73,6 @@
--             app:layout_constraintBottom_toBottomOf="parent"
--             app:layout_constraintEnd_toEndOf="parent"
--             app:layout_constraintTop_toTopOf="parent" />
---
--     </androidx.constraintlayout.widget.ConstraintLayout>
-- 
-- </androidx.constraintlayout.widget.ConstraintLayout>
--\ No newline at end of file
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.app.Activity;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.content.res.AssetManager;\r\nimport android.content.res.Configuration;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.os.Environment;\r\nimport android.os.Handler;\r\nimport android.os.Message;\r\nimport android.os.PowerManager;\r\nimport android.util.Log;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.AdapterView;\r\nimport android.widget.Button;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.Spinner;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.OnBackPressedCallback;\r\n\r\nimport com.alibaba.fastjson.JSON;\r\nimport com.bumptech.glide.Glide;\r\nimport com.dou361.ijkplayer.bean.VideoijkBean;\r\nimport com.dou361.ijkplayer.listener.OnPlayerBackListener;\r\nimport com.dou361.ijkplayer.listener.OnPlayerStartOrPauseListener;\r\nimport com.dou361.ijkplayer.listener.OnShowThumbnailListener;\r\nimport com.dou361.ijkplayer.widget.PlayStateParams;\r\nimport com.dou361.ijkplayer.widget.PlayerView;\r\nimport com.dou361.jjdxm_ijkplayer.MainActivity;\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\nimport com.dou361.jjdxm_ijkplayer.command.Control;\r\nimport com.dou361.jjdxm_ijkplayer.command.Gears;\r\nimport com.dou361.jjdxm_ijkplayer.command.Handbrake;\r\nimport com.dou361.jjdxm_ijkplayer.command.Video;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTRequest;\r\nimport com.dou361.jjdxm_ijkplayer.mqtt.MQTTSample;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.VideoMonitor;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.utlis.MediaUtils;\r\nimport com.tencent.iot.hub.device.android.core.log.TXMqttLogCallBack;\r\nimport com.tencent.iot.hub.device.android.core.util.TXLog;\r\nimport com.tencent.iot.hub.device.java.core.common.Status;\r\nimport com.tencent.iot.hub.device.java.core.mqtt.TXMqttActionCallBack;\r\n\r\n\r\nimport org.eclipse.paho.client.mqttv3.IMqttToken;\r\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\r\n\r\nimport java.io.BufferedReader;\r\nimport java.io.BufferedWriter;\r\nimport java.io.ByteArrayInputStream;\r\nimport java.io.File;\r\nimport java.io.FileReader;\r\nimport java.io.FileWriter;\r\nimport java.io.IOException;\r\nimport java.io.InputStreamReader;\r\nimport java.nio.charset.Charset;\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\n\r\nimport static android.os.SystemClock.uptimeMillis;\r\n\r\n/**\r\n 遥控车辆进行移动\r\n */\r\npublic class RemoteControl extends Activity {\r\n\r\n    public String hostIP = /*\"192.168.0.108:18081\";*/\"10.6.206.20:30549\";\r\n    public String userId = \"6D的安卓測試機\";\r\n    public String vin = \"001\";\r\n\r\n    private final static String mLogPath = Environment.getExternalStorageDirectory().getPath() + \"/tencent/\";\r\n\r\n    public CountDownTimer countDownTimer;\r\n    private MainActivity mParent;\r\n    private MQTTSample mqttSample;\r\n\r\n    private PlayerView player;\r\n    private Context mContext;\r\n    private TextView  Speed;\r\n    private List<VideoijkBean> list;\r\n    private PowerManager.WakeLock wakeLock;\r\n    private View rootView;\r\n    private Activity mActivity;\r\n\r\n    private static final String TAG = \"FullscreenActivity\";\r\n    private boolean braking = true;\r\n    private int gearGlobal=0;\r\n    private int handBrakeStatus = 0;\r\n    private Button LlightingButton;\r\n    private ImageButton imageButton_forward,imageButton_backward;\r\n    private ImageView app_video_play;\r\n    private Spinner Video_Modul_Spinner;\r\n\r\n    private double wheelAngle=0.0;\r\n    private double speed=0.0;\r\n\r\n\r\n\r\n    /*虛擬機*/\r\n    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"android_test_phone\";\r\n    private String mDevPSK  = \"KdV+RSnHAlmEpM75aWZQZg==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/android_test_phone/data\";\r\n\r\n    /*OPPO A57t*/\r\n/*    private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";  //传入null，即使用腾讯云物联网通信默认地址 \"${ProductId}.iotcloud.tencentdevices.com:8883\"  https://cloud.tencent.com/document/product/634/32546\r\n    private String mProductID = \"2N8PWJAI0V\";\r\n    private String mDevName = \"OPPOA57t\";\r\n    private String mDevPSK  = \"TbtnFhJDmRe7N41vDBRVtA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"2N8PWJAI0V/OPPOA57t/data\";  */  // productID/DeviceName/TopicName\r\n\r\n    /*真车配置*/\r\n    /*private String mBrokerURL = \"ssl://fawtsp-mqtt-public-dev.faw.cn:8883\";\r\n    private String mProductID = \"KM8UZXZOV9\";\r\n    private String mDevName = \"android_test\";\r\n    private String mDevPSK  = \"+xRWqTlp0UPbwSKXVgiNxA==\"; //若使用证书验证，设为null\r\n    private String mTestTopic = \"KM8UZXZOV9/android_test/data\";    // productID/DeviceName/TopicName\r\n*/    private String mSubProductID = \"\"; // If you wont test gateway, let this to be null\r\n    private String mSubDevName = \"\";\r\n    private String mSubDevPsk = \"BuildConfig.SUB_DEVICE_PSK\";\r\n    private String mDevCertName = \"YOUR_DEVICE_NAME_cert.crt\";\r\n    private String mDevKeyName  = \"YOUR_DEVICE_NAME_private.key\";\r\n    private String mProductKey = \"BuildConfig.PRODUCT_KEY\";        // Used for dynamic register\r\n    private String mDevCert = \"\";           // Cert String\r\n    private String mDevPriv = \"\";           // Priv String\r\n\r\n    private volatile boolean mIsConnected=false;\r\n    ScalableImageView sImgView ;\r\n\r\n    @SuppressLint(\"InvalidWakeLockTag\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        Log.d(TAG, \"onCreate: \");\r\n        super.onCreate(savedInstanceState);\r\n        this.mContext = this;\r\n        this.mActivity = this;\r\n        rootView = getLayoutInflater().from(this).inflate(R.layout.activity_remote_control, null);\r\n\r\n        setContentView(rootView);\r\n\r\n        if (!mIsConnected) {\r\n            Log.d(TAG, \"onCreate: Connecting Mqtt\");\r\n            //轮询连接,万分感谢陈岩大佬\r\n            mqttSample= new MQTTSample(getApplication(), new SelfMqttActionCallBack(), mBrokerURL, mProductID, mDevName, mDevPSK,\r\n                    mDevCert, mDevPriv, mSubProductID, mSubDevName, mTestTopic, null, null, true, new SelfMqttLogCallBack());\r\n            Log.d(TAG, \"onCreate: mqttSample\"+mqttSample.toString());\r\n            mqttSample.connect();\r\n            sleep(2000);}\r\n        mqttSample.subscribeTopic();\r\n\r\n\r\n        shiftHandbrake(1);\r\n        Log.d(TAG, \"onCreate: \");\r\n\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                 while (true) {\r\n                     if(braking){\r\n                    try {\r\n\r\n                        moveVehicle(-0.1,0.0,wheelAngle);\r\n                        sleep(50);\r\n                    } catch (Exception e) {\r\n                        e.printStackTrace();\r\n                    }}\r\n            }\r\n        }}).start();\r\n\r\n        /**常亮*/\r\n        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);\r\n        wakeLock = pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK, \"liveTAG\");\r\n        wakeLock.acquire();\r\n\r\n        CompentOnTouch compentOnTouch = new CompentOnTouch();\r\n\r\n        //返回键\r\n        findViewById(R.id.back2).setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View V){\r\n                //对话框\r\n                AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                builder.setTitle(\"结束挪车\");//设置对话框的标题\r\n                builder.setMessage(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");//设置对话框的内容\r\n                builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                    @Override\r\n                    public void onClick(DialogInterface arg0, int arg1) {\r\n                        finish();\r\n                        Intent intent=new Intent(RemoteControl.this, MainActivity.class);\r\n                        startActivity(intent);\r\n                    }\r\n                });\r\n                builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                    @Override\r\n                    public void onClick(DialogInterface arg0, int arg1) {\r\n                        Toast.makeText(RemoteControl.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                        player.startPlay();\r\n                    }\r\n                });\r\n                AlertDialog b=builder.create();\r\n                b.show();\r\n                player.onPause();\r\n            }\r\n        });\r\n\r\n        imageButton_forward=findViewById(R.id.forward);\r\n        imageButton_forward.setOnTouchListener(compentOnTouch);\r\n\r\n        imageButton_backward=findViewById(R.id.backward);\r\n        imageButton_backward.setOnTouchListener(compentOnTouch);\r\n        sImgView = findViewById(R.id.steering_wheel);\r\n\r\n        //方向盘角度在速度处显示\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                while(true){\r\n                    wheelAngle = sImgView.getmDegree();\r\n                }\r\n            }\r\n        }).start();\r\n\r\n        countDownTimer=new CountDownTimer(100000,200) {\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                Speed = findViewById(R.id.speed);\r\n                Speed.setText(String.valueOf((int)wheelAngle));\r\n            }\r\n            @Override\r\n            public void onFinish() {\r\n            }\r\n        }.start();\r\n\r\n        //下拉单选按钮\r\n        Video_Modul_Spinner = (Spinner)findViewById(R.id.Spinner_VIdeo_Model);\r\n        Video_Modul_Spinner.setSelection(0);//进入不会自动播放\r\n        Video_Modul_Spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener(){\r\n            @Override\r\n            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {\r\n                    String result = parent.getItemAtPosition(position).toString();\r\n                    Toast.makeText(RemoteControl.this, result, Toast.LENGTH_SHORT).show();\r\n                    switch (position) {\r\n                        case 0: {\r\n                            /**前摄像*/\r\n                            list = new ArrayList<VideoijkBean>();\r\n                            String url1 = \"http://ivi.bupt.edu.cn/hls/cctv13.m3u8\";\r\n                            String url2 = \"rtmp://150.158.176.170/live/test_vin_1\";\r\n                            VideoijkBean m1 = new VideoijkBean();\r\n                            m1.setStream(\"原始视频\");\r\n                            m1.setUrl(url1);\r\n                            VideoijkBean m2 = new VideoijkBean();\r\n                            m2.setStream(\"融合视频\");\r\n                            m2.setUrl(url2);\r\n                            list.add(m1);\r\n                            list.add(m2);\r\n                            player = new PlayerView(mActivity, rootView)\r\n                                    .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                                    .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                                    .forbidTouch(false)\r\n                                    .hideSteam(false)\r\n                                    .hideMenu(true)\r\n                                    .hideCenterPlayer(true)\r\n                                    .hideBack(false)\r\n                                    .setOnlyFullScreen(true)\r\n                                    .setNetWorkTypeTie(false)\r\n                                    .hideRotation(true)\r\n                                    .hideFullscreen(true)\r\n                                    .hideBack(true)\r\n                                    .setChargeTie(true, 480)//设置最长播放时间\r\n                                    .showThumbnail(new OnShowThumbnailListener() {\r\n                                        @Override\r\n                                        public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                                            Glide.with(mContext)\r\n                                                    .load(R.drawable.pic_before_video)\r\n                                                    .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                                    .error(R.color.cl_error)//加载错误之后的错误图\r\n                                                    .into(ivThumbnail);\r\n                                        }\r\n                                    })\r\n                                    .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                                        @Override\r\n                                        public void onStartOrPause() {\r\n                                            //对话框\r\n                                            AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                                            builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                                            builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                                            builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    player.startPlay();\r\n                                                }\r\n                                            });\r\n                                            builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                                                @Override\r\n                                                public void onClick(DialogInterface arg0, int arg1) {\r\n                                                    finish();\r\n                                                    Intent intent=new Intent(RemoteControl.this,MainActivity.class);\r\n                                                    startActivity(intent);\r\n                                                }\r\n                                            });\r\n                                            AlertDialog b=builder.create();\r\n                                            b.show();\r\n                                        }\r\n                                    })\r\n                                    .setPlaySource(list)\r\n                                    .startPlay();\r\n                        }\r\n                        break;\r\n\r\n                        case 1: {\r\n                            /**后摄像*/\r\n                            String url3 = \"http://ivi.bupt.edu.cn/hls/cctv2.m3u8\";\r\n                            playVideoUrl(url3);\r\n                        }\r\n                        break;\r\n\r\n                        case 2: {\r\n                            /**左摄像*/\r\n                            String url4 = \"http://ivi.bupt.edu.cn/hls/cctv3.m3u8\";\r\n                            playVideoUrl(url4);\r\n                        }\r\n                        break;\r\n\r\n                        case 3: {\r\n                            /**右摄像*/\r\n                            String url5 = \"http://ivi.bupt.edu.cn/hls/cctv4.m3u8\";\r\n                            playVideoUrl(url5);\r\n\r\n                        }\r\n                        break;\r\n\r\n                        case 4: {\r\n                            /**上帝*/\r\n                            String url6 = \"http://ivi.bupt.edu.cn/hls/cctv13.m3u8\";\r\n                            playVideoUrl(url6);\r\n                        }\r\n                        break;\r\n\r\n                        default:\r\n                            break;\r\n                    }\r\n\r\n            }\r\n            @Override\r\n            public void onNothingSelected(AdapterView<?> parent) { }\r\n        });\r\n\r\n    }\r\n\r\n    //后四个视频播放器播放\r\n    public  void playVideoUrl( String url){\r\n        player = new PlayerView(mActivity, rootView)\r\n                .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                .forbidTouch(false)\r\n                .hideSteam(true)\r\n                .hideMenu(true)\r\n                .hideCenterPlayer(true)\r\n                .hideBack(false)\r\n                .setOnlyFullScreen(true)\r\n                .setNetWorkTypeTie(false)\r\n                .hideRotation(true)\r\n                .hideFullscreen(true)\r\n                .hideBack(true)\r\n                .setChargeTie(true, 480)//设置最长播放时间\r\n                .showThumbnail(new OnShowThumbnailListener() {\r\n                    @Override\r\n                    public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                        Glide.with(mContext)\r\n                                .load(R.drawable.pic_before_video)\r\n                                .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                .error(R.color.cl_error)//加载错误之后的错误图\r\n                                .into(ivThumbnail);\r\n                    }\r\n                })\r\n                .setPlayerStartOrPauseListener(new OnPlayerStartOrPauseListener() {\r\n                    @Override\r\n                    public void onStartOrPause() {\r\n                        //对话框\r\n                        AlertDialog.Builder builder = new AlertDialog.Builder(mContext);\r\n                        builder.setTitle(\"暂停挪车\");//设置对话框的标题\r\n                        builder.setMessage(\"挪车已暂停，是否继续挪车？\");//设置对话框的内容\r\n                        builder.setPositiveButton(\"继续\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                player.startPlay();\r\n                            }\r\n                        });\r\n                        builder.setNegativeButton(\"结束\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                finish();\r\n                                Intent intent = new Intent(RemoteControl.this, MainActivity.class);\r\n                                startActivity(intent);\r\n                            }\r\n                        });\r\n                        AlertDialog b = builder.create();\r\n                        b.show();\r\n                    }\r\n                })\r\n                .setPlaySource(url)\r\n                .startPlay();\r\n    }\r\n\r\n\r\n    /**\r\n    1表示手刹释放，0表示手刹锁定\r\n     **/\r\n\r\n    private void shiftHandbrake(int handbrakeToSet) {\r\n        if(handbrakeToSet!=handBrakeStatus){\r\n            for(int i=0;i<5;i++){\r\n                Handbrake mHandbrake = new Handbrake();\r\n                mHandbrake.setTimestamp(System.currentTimeMillis());\r\n                mHandbrake.setStatus(handbrakeToSet);\r\n                mHandbrake.setType(14);\r\n                mHandbrake.setTaskid(\"6D\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mHandbrake));\r\n                Log.d(TAG, \"onClick: 手刹\"+JSON.toJSONString(mHandbrake));\r\n                sleep(50);\r\n            }\r\n            handBrakeStatus=handbrakeToSet;}\r\n        else return;\r\n    }\r\n\r\n    /**\r\n    1,2,3,4分別對應P,R,N,D四個檔位\r\n     **/\r\n    private void shiftGear(final int gear){\r\n        if(speed==0){\r\n        for(int i=0;i<10;i++){\r\n                Gears mGear = new Gears();\r\n                mGear.setTimestamp(System.currentTimeMillis());\r\n                Log.d(TAG, \"onClick: \"+System.currentTimeMillis());\r\n                mGear.setGear(gear);\r\n                mGear.setType(13);\r\n                mGear.setTaskid(\"手機挂\"+gear+\"档\");\r\n                // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n                mqttSample.publishTopic(\"data\", JSON.toJSONString(mGear));\r\n                Log.d(TAG, \"onClick: \"+JSON.toJSONString(mGear));\r\n                sleep(50);\r\n        }\r\n        gearGlobal=gear;}\r\n        else {\r\n            moveVehicle(-0.3,0.0,0.0);\r\n            shiftGear(gear);\r\n        }\r\n    }\r\n\r\n    /**\r\n\r\n     @videoType\r\n     1为前方原始视频流，2为后方原始视频流，3为左侧原始视频流，4为右侧原始视频流，5为感知融合视频流，6为上帝视角视频流\r\n     @videoStatus\r\n     1为打开，0为关闭\r\n     */\r\n    private void shiftVideoType(int videoType,int videoStatus){\r\n        Video mVideo = new Video();\r\n        mVideo.setTimestamp(System.currentTimeMillis());\r\n        mVideo.setVideo_type(videoType);\r\n        mVideo.setOperation(videoStatus);\r\n        mVideo.setType(12);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        mqttSample.publishTopic(\"data\", JSON.toJSONString(mVideo));\r\n        Log.d(TAG, \"onClick: \"+JSON.toJSONString(mVideo));\r\n    }\r\n\r\n    /**\r\n     * @acceleration 加速度，正是加速，負的是減速\r\n     * @speed 目標速度\r\n     * @wheelAngle 方向盤轉角\r\n     */\r\n    private void moveVehicle(Double acceleration,Double speed,Double wheelAngle){\r\n        Control mMove = new Control();\r\n        mMove.setTimestamp(System.currentTimeMillis());\r\n        mMove.setAcceleration(acceleration);\r\n        mMove.setSpeed(speed);\r\n        mMove.setType(11);\r\n        mMove.setWheel_angle(wheelAngle);\r\n        // 需先在腾讯云控制台，增加自定义主题: data，用于更新自定义数据\r\n        //mqttSample.publishTopic(\"data\", JSON.toJSONString(mMove));\r\n        //Log.d(TAG, \"onClick: 上传刹车\"+JSON.toJSONString(mMove));\r\n    }\r\n\r\n    @Override\r\n    protected void onPostCreate(Bundle savedInstanceState) {\r\n        super.onPostCreate(savedInstanceState);\r\n    }\r\n\r\n\r\n\r\n\r\n    //ms为需要休眠的时长\r\n    public static void sleep(long ms)\r\n    {\r\n        //uptimeMillis() Returns milliseconds since boot, not counting time spent in deep sleep.\r\n        long start = uptimeMillis();\r\n        long duration = ms;\r\n        boolean interrupted = false;\r\n        do {\r\n            try {\r\n                Thread.sleep(duration);\r\n            }\r\n            catch (InterruptedException e) {\r\n                interrupted = true;\r\n            }\r\n            duration = start + ms - uptimeMillis();\r\n        } while (duration > 0);\r\n\r\n        if (interrupted) {\r\n            Thread.currentThread().interrupt();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttActionCallBack回调接口\r\n     */\r\n    private class SelfMqttActionCallBack extends TXMqttActionCallBack {\r\n\r\n        @Override\r\n        public void onConnectCompleted(Status status, boolean reconnect, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onConnectCompleted, status[%s], reconnect[%b], userContext[%s], msg[%s]\",\r\n                    status.name(), reconnect, userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            if(status==Status.OK){\r\n             mIsConnected = true;}\r\n        }\r\n\r\n        @Override\r\n        public void onConnectionLost(Throwable cause) {\r\n            String logInfo = String.format(\"onConnectionLost, cause[%s]\", cause.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onDisconnectCompleted(Status status, Object userContext, String msg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onDisconnectCompleted, status[%s], userContext[%s], msg[%s]\", status.name(), userContextInfo, msg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            mIsConnected = false;\r\n        }\r\n\r\n        @Override\r\n        public void onPublishCompleted(Status status, IMqttToken token, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onPublishCompleted, status[%s], topics[%s],  userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(token.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            if (Status.ERROR == status) {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            } else {\r\n                Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public void onUnSubscribeCompleted(Status status, IMqttToken asyncActionToken, Object userContext, String errMsg) {\r\n            String userContextInfo = \"\";\r\n            if (userContext instanceof MQTTRequest) {\r\n                userContextInfo = userContext.toString();\r\n            }\r\n            String logInfo = String.format(\"onUnSubscribeCompleted, status[%s], topics[%s], userContext[%s], errMsg[%s]\",\r\n                    status.name(), Arrays.toString(asyncActionToken.getTopics()), userContextInfo, errMsg);\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n\r\n        @Override\r\n        public void onMessageReceived(final String topic, final MqttMessage message) {\r\n            String logInfo = String.format(\"receive command, topic[%s], message[%s]\", topic, message.toString());\r\n            Log.d(TAG, \"onConnectCompleted: \"+logInfo);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 实现TXMqttLogCallBack回调接口\r\n     */\r\n    private class SelfMqttLogCallBack extends TXMqttLogCallBack {\r\n\r\n        @Override\r\n        public String setSecretKey() {\r\n            String secertKey;\r\n            if (mDevPSK != null && mDevPSK.length() != 0) {  //密钥认证\r\n                secertKey = mDevPSK;\r\n                secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                return secertKey;\r\n            } else {\r\n                BufferedReader cert;\r\n\r\n                if (mDevCert != null && mDevCert.length() != 0) { //动态注册,从DevCert中读取\r\n                    cert = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(mDevCert.getBytes(Charset.forName(\"utf8\"))), Charset.forName(\"utf8\")));\r\n\r\n                } else { //证书认证，从证书文件中读取\r\n                    AssetManager assetManager = mParent.getAssets();\r\n                    if (assetManager == null) {\r\n                        return null;\r\n                    }\r\n                    try {\r\n                        cert=new BufferedReader(new InputStreamReader(assetManager.open(mDevCertName)));\r\n                    } catch (IOException e) {\r\n//                        mParent.printLogInfo(TAG, \"getSecertKey failed, cannot open CRT Files.\",mLogInfoText);\r\n                        return null;\r\n                    }\r\n                }\r\n                //获取密钥\r\n                try {\r\n                    if (cert.readLine().contains(\"-----BEGIN\")) {\r\n                        secertKey = cert.readLine();\r\n                        secertKey = secertKey.length() > 24 ? secertKey.substring(0,24) : secertKey;\r\n                    } else {\r\n                        secertKey = null;\r\n//                        mParent.printLogInfo(TAG,\"Invaild CRT Files.\", mLogInfoText);\r\n                    }\r\n                    cert.close();\r\n                } catch (IOException e) {\r\n                    TXLog.e(TAG, \"getSecertKey failed.\", e);\r\n//                    mParent.printLogInfo(TAG,\"getSecertKey failed.\", mLogInfoText);\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return secertKey;\r\n        }\r\n\r\n        @Override\r\n        public void printDebug(String message){\r\n//            mParent.printLogInfo(TAG, message, mLogInfoText);\r\n            //TXLog.d(TAG,message);\r\n        }\r\n\r\n        @Override\r\n        public boolean saveLogOffline(String log){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"saveLogOffline not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Save log to %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedWriter wLog = new BufferedWriter(new FileWriter(new File(logFilePath), true));\r\n                wLog.write(log);\r\n                wLog.flush();\r\n                wLog.close();\r\n                return true;\r\n            } catch (IOException e) {\r\n                String logInfo = String.format(\"Save log to [%s] failed, check the Storage permission!\", logFilePath);\r\n//                mParent.printLogInfo(TAG,logInfo, mLogInfoText);\r\n                e.printStackTrace();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public String readOfflineLog(){\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"readOfflineLog not ready\", mLogInfoText);\r\n                return null;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            TXLog.i(TAG, \"Read log from %s\", logFilePath);\r\n\r\n            try {\r\n                BufferedReader logReader = new BufferedReader(new FileReader(logFilePath));\r\n                StringBuilder offlineLog = new StringBuilder();\r\n                int data;\r\n                while (( data = logReader.read()) != -1 ) {\r\n                    offlineLog.append((char)data);\r\n                }\r\n                logReader.close();\r\n                return offlineLog.toString();\r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n                return null;\r\n            }\r\n        }\r\n\r\n        @Override\r\n        public boolean delOfflineLog(){\r\n\r\n            //判断SD卡是否可用\r\n            if (!Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {\r\n//                mParent.printLogInfo(TAG, \"delOfflineLog not ready\", mLogInfoText);\r\n                return false;\r\n            }\r\n\r\n            String logFilePath = mLogPath + mProductID + mDevName + \".log\";\r\n\r\n            File file = new File(logFilePath);\r\n            if (file.exists() && file.isFile()) {\r\n                if (file.delete()) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    class\r\n    CompentOnTouch implements View.OnTouchListener {\r\n\r\n        public boolean isOnLongClick=false;\r\n        int i = 0;\r\n\r\n        @Override\r\n        public boolean onTouch(View view, MotionEvent motionEvent) {\r\n\r\n            switch (view.getId()) {\r\n// 这是btnMius下的一个层，为了增强易点击性\r\n                case R.id.backward:\r\n                    onTouchChange(\"backward\", motionEvent.getAction());\r\n                    break;\r\n// 这里也写，是为了增强易点击性\r\n                case R.id.forward:\r\n                    onTouchChange(\"forward\", motionEvent.getAction());\r\n                    break;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        private void onTouchChange(String methodName, int eventAction) {\r\n            Log.d(TAG, \"onTouchChange: \"+methodName+eventAction);\r\n            braking =false;\r\n// 按下松开分别对应启动停止前进方法\r\n            if (\"backward\".equals(methodName)) {\r\n                if(gearGlobal!=2){\r\n                shiftGear(2);}\r\n                MiusThread miusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    miusThread = new MiusThread();\r\n                    isOnLongClick = true;\r\n                    miusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\"+ braking);\r\n//                    Log.d(TAG, \"onTouchChange: isOnLongClick=false\"+miusThread.isInterrupted());\r\n                    if (miusThread != null) {\r\n                        miusThread.interrupt();\r\n                        Log.d(TAG, \"onTouchChange: 终止线程\");\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (miusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n// 按下松开分别对应启动停止加线程方法\r\n            else if (\"forward\".equals(methodName)) {\r\n                if(gearGlobal!=4){\r\n                shiftGear(4);}\r\n                PlusThread plusThread = null;\r\n                if (eventAction == MotionEvent.ACTION_DOWN) {\r\n                    plusThread = new PlusThread();\r\n                    isOnLongClick = true;\r\n                    plusThread.start();\r\n                } else if (eventAction == MotionEvent.ACTION_UP) {\r\n                    Log.d(TAG, \"onTouchChange: 松开手指\");\r\n                    isOnLongClick=false;\r\n                    braking =true;\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = false;\r\n                    }\r\n                } else if (eventAction == MotionEvent.ACTION_MOVE) {\r\n                    if (plusThread != null) {\r\n                        isOnLongClick = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        // 后退操作\r\n        class MiusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(2);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n\r\n        // 前进操作\r\n        class PlusThread extends Thread {\r\n            @Override\r\n            public void run() {\r\n                while (isOnLongClick) {\r\n                    try {\r\n                        Thread.sleep(40);\r\n                        myHandler.sendEmptyMessage(1);\r\n                    } catch (InterruptedException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    super.run();\r\n                }\r\n//                while (!isOnLongClick) {\r\n//                    try {\r\n//                        Thread.sleep(100);\r\n//                        myHandler.sendEmptyMessage(3);\r\n//                    } catch (InterruptedException e) {\r\n//                        e.printStackTrace();\r\n//                    }\r\n//                    super.run();\r\n//                }\r\n            }\r\n        }\r\n\r\n        Handler myHandler = new Handler() {\r\n            public void handleMessage(Message msg) {\r\n                switch (msg.what) {\r\n                    case 1:\r\n                        //前进操作\r\n//                        Control mForward = new Control(5.0,0.1,wheelAngle);\r\n//                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mForward));\r\n//                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mForward));\r\n                        moveVehicle(0.1,5.0,wheelAngle);\r\n                        break;\r\n                    case 2:\r\n//                        Control mBackward = new Control(-5.0,0.1,wheelAngle);\r\n//                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBackward));\r\n//                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBackward));\r\n                        moveVehicle(0.1,-5.0,wheelAngle);\r\n                        Log.d(\"TAG\",\"Backward:\"+i--);\r\n                        break;\r\n                    case 3:\r\n                        Control mBreak = new Control(0.0,-0.1,wheelAngle);\r\n                        mqttSample.publishTopic(\"data\", JSON.toJSONString(mBreak));\r\n                        Log.d(TAG, \"第 \"+(i++)+\"次上传\\n\"+JSON.toJSONString(mBreak));\r\n                        break;\r\n                }\r\n            };\r\n        };\r\n    }\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        if (player != null) {\r\n            player.onPause();\r\n        }\r\n        /**demo的内容，恢复系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, true);\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        if (player != null) {\r\n            player.onResume();\r\n        }\r\n        /**demo的内容，暂停系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, false);\r\n        /**demo的内容，激活设备常亮状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.acquire();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onDestroy() {\r\n        super.onDestroy();\r\n        if (player != null) {\r\n            for(int i=1;i<7;i++){\r\n            shiftVideoType(i,0);}\r\n            player.onDestroy();\r\n        }\r\n        if(speed!=0){moveVehicle(-0.3,0.0,0.0);}\r\n        if(braking){braking=false;}\r\n        if(gearGlobal!=1){shiftGear(1);}\r\n        if(handBrakeStatus==1){shiftHandbrake(0);}\r\n        if(mIsConnected){mqttSample.disconnect();}\r\n\r\n        Log.d(TAG, \"onDestroy: 斷開視頻以及MQTT連接\");\r\n    }\r\n\r\n    @Override\r\n    public void onConfigurationChanged(Configuration newConfig) {\r\n        super.onConfigurationChanged(newConfig);\r\n        if (player != null) {\r\n            player.onConfigurationChanged(newConfig);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onBackPressed() {\r\n        if (player != null && player.onBackPressed()) {\r\n            return;\r\n        }\r\n//        super.onBackPressed();\r\n        //对话框\r\n        AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n        builder.setTitle(\"结束挪车\");//设置对话框的标题\r\n        builder.setMessage(\"您已确定车辆已经抵达目标位置并结束挪车操作吗？\");//设置对话框的内容\r\n        builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n            @Override\r\n            public void onClick(DialogInterface arg0, int arg1) {\r\n                finish();\r\n                Intent intent=new Intent(RemoteControl.this, MainActivity.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n        builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n            @Override\r\n            public void onClick(DialogInterface arg0, int arg1) {\r\n                Toast.makeText(RemoteControl.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                player.startPlay();\r\n            }\r\n        });\r\n        AlertDialog b=builder.create();\r\n        b.show();\r\n        player.onPause();\r\n        /**demo的内容，恢复设备亮度状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.release();\r\n        }\r\n    }\r\n}\r\n
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControl.java	(date 1609126935682)
--@@ -8,6 +8,7 @@
-- import android.content.Intent;
-- import android.content.res.AssetManager;
-- import android.content.res.Configuration;
--+import android.graphics.Color;
-- import android.os.Bundle;
-- import android.os.CountDownTimer;
-- import android.os.Environment;
--@@ -245,6 +246,7 @@
-- 
--         //下拉单选按钮
--         Video_Modul_Spinner = (Spinner)findViewById(R.id.Spinner_VIdeo_Model);
--+        Video_Modul_Spinner.setOutlineSpotShadowColor(Color.BLUE);
--         Video_Modul_Spinner.setSelection(0);//进入不会自动播放
--         Video_Modul_Spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener(){
--             @Override
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/videomonitoring/VideoMonitor.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.videomonitoring;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.app.Activity;\r\nimport android.content.Context;\r\nimport android.content.res.Configuration;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.os.PowerManager;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.RadioButton;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.alibaba.fastjson.JSON;\r\nimport com.bumptech.glide.Glide;\r\nimport com.dou361.ijkplayer.bean.VideoijkBean;\r\nimport com.dou361.ijkplayer.listener.OnShowThumbnailListener;\r\nimport com.dou361.ijkplayer.widget.PlayStateParams;\r\nimport com.dou361.ijkplayer.widget.PlayerView;\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\nimport com.dou361.jjdxm_ijkplayer.videomonitoring.utlis.MediaUtils;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\n\r\nimport butterknife.ButterKnife;\r\nimport butterknife.OnClick;\r\nimport okhttp3.MediaType;\r\nimport okhttp3.OkHttpClient;\r\nimport okhttp3.Request;\r\nimport okhttp3.RequestBody;\r\nimport okhttp3.Response;\r\n\r\nimport static android.content.ContentValues.TAG;\r\n\r\npublic class VideoMonitor extends Activity implements View.OnClickListener , MyRadioGroup.OnCheckedChangeListener {\r\n\r\n    public String hostURL=\"http://10.6.206.20:30549/appBackend/\";\r\n    public CountDownTimer countDownTimer;\r\n    public VideoRequest videoRequest;\r\n    public VideoReply videoReply,videoReply2,videoReplyMethod;\r\n    public String videoResponseString;//视频Post请求返回数据\r\n    private PlayerView player;\r\n    private Context mContext;\r\n    private List<VideoijkBean> list;\r\n    private PowerManager.WakeLock wakeLock;\r\n    View rootView;\r\n    private MyRadioGroup videoRatioGroup;\r\n    private RadioButton buttonFront, buttonBack, buttonLeft, buttonRight, channelGodPerspective;\r\n    private HashMap<String, RadioButton> channels = new HashMap<>(5);\r\n    private ImageButton lightControllerButton;\r\n\r\n    private TextView replyTextView,requestTextView;\r\n\r\n    @SuppressLint(\"InvalidWakeLockTag\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        this.mContext = this;\r\n        rootView = getLayoutInflater().from(this).inflate(R.layout.activity_videomonitor, null);\r\n        setContentView(rootView);\r\n//        setContentView(R.layout.activity_main);\r\n        ButterKnife.bind(this);\r\n\r\n        lightControllerButton=(ImageButton) findViewById(R.id.light);\r\n        lightControllerButton.setOnClickListener(this);\r\n\r\n        buttonFront = (RadioButton) findViewById(R.id.front_Click);\r\n        buttonBack = (RadioButton)findViewById(R.id.back_Click);\r\n        buttonLeft = (RadioButton)findViewById(R.id.left_Click);\r\n        buttonRight = (RadioButton)findViewById(R.id.right_Click);\r\n        channelGodPerspective = (RadioButton)findViewById(R.id.god_perspective_Click);\r\n        buttonFront.setOnClickListener(this);\r\n        buttonBack.setOnClickListener(this);\r\n        buttonLeft.setOnClickListener(this);\r\n        buttonRight.setOnClickListener(this);\r\n        channelGodPerspective.setOnClickListener(this);\r\n        channels.put(\"Channel_Front\",buttonFront);\r\n        channels.put(\"Channel_Back\",buttonBack);\r\n        channels.put(\"Channel_Left\",buttonLeft);\r\n        channels.put(\"Channel_Right\",buttonRight);\r\n        channels.put(\"Channel_God_Perspective\", channelGodPerspective);\r\n\r\n//        replyTextView=findViewById(R.id.replyTextView);\r\n//        requestTextView=findViewById(R.id.requestTextView);\r\n\r\n\r\n        /**常亮*/\r\n        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);\r\n        wakeLock = pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK, \"liveTAG\");\r\n        wakeLock.acquire();\r\n\r\n\r\n        videoRatioGroup = (MyRadioGroup)findViewById(R.id.radiogroup);\r\n        videoRatioGroup.setOnCheckedChangeListener(new MyRadioGroup.OnCheckedChangeListener() {\r\n            @Override\r\n            public void onCheckedChanged(MyRadioGroup group, int checkedId) {\r\n                videoReply = new VideoReply(\"原始\");\r\n                videoReply2 = new VideoReply(\"融合\");\r\n\r\n                replyTextView.setText(\"当前选择\"+checkedId);\r\n                switch (checkedId){\r\n                    case R.id.left_Click:\r\n                        try2play(3);\r\n                        break;\r\n                    case R.id.right_Click:\r\n                        try2play(4);\r\n                        break;\r\n                    case R.id.front_Click:\r\n                        try2play(0);\r\n                        break;\r\n                    case R.id.back_Click:\r\n                        try2play(2);\r\n                        break;\r\n                    case R.id.god_perspective_Click:\r\n                        try2play(5);\r\n                        break;\r\n                    default:\r\n                        Toast defualt =Toast.makeText(VideoMonitor.this, \"上帝\", Toast.LENGTH_SHORT);\r\n                        new ShowMyToast().showMyToast(defualt,100);\r\n                        break;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private void try2play(final int videoNum) {\r\n        videoReply.initialVideoReply();\r\n        videoReply2.initialVideoReply();\r\n        Log.d(TAG, \"Initial: videoReply1：\"+videoReply.toString()+\"\\nvideoReply2：\"+videoReply2.toString());\r\n\r\n        if (videoNum!=0){\r\n        countDownTimer=new CountDownTimer(10000,1000) {\r\n            int i=0;\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                i=i+1;\r\n                replyTextView.setText(\"执行第\"+i+\"次请求：\"+videoReply.toString());\r\n                if (videoReply.getCode().equals(\"InitialString\")){\r\n                    String replyOriginalString = postVideoRequest(videoNum);\r\n                    if(replyOriginalString!=null){\r\n                        //当请求数据不为空时，设置videoReply类，，，，，反序列化操作即 由字符串--->对象\r\n                        videoReply = JSON.parseObject(replyOriginalString, VideoReply.class);}\r\n                }\r\n//                else if(videoReply.getCode().equals(\"0030000\"))//请求成功播放视频取消轮询\r\n                {playVideo(videoNum);\r\n                    cancel();}\r\n//                else\r\n//                {\r\n//                    replyTextView.setText(\"播放错误\");\r\n//                }\r\n            }\r\n            @Override\r\n            public void onFinish() {\r\n                replyTextView.setText(\"请求超时!\");\r\n            }\r\n        }.start();}\r\n        else {//播放前视角视频时有四种情况\r\n            countDownTimer=new CountDownTimer(10000,1000) {\r\n                int i=0;\r\n                @Override\r\n                public void onTick(long millisUntilFinished) {\r\n                    i=i+1;\r\n                    replyTextView.setText(\"执行第\"+i+\"次请求：\"+videoReply.toString());\r\n                    if (videoReply.getCode().equals(\"InitialString\")){//原始視頻為初始數據\r\n                        if (videoReply2.getCode().equals(\"InitialString\")){//均為初始數據\r\n                            String replyOriginalFront = postVideoRequest(videoNum+1);//VideoNum是0，请求的是原始视频1和融合视频6\r\n                            if(replyOriginalFront!=null){\r\n                            videoReply = JSON.parseObject(replyOriginalFront, VideoReply.class);\r\n                            Log.d(TAG, \"onTick: replyOriginalFront\"+videoReply.toString());}\r\n\r\n                            String replyMergeFront=postVideoRequest(videoNum+6);//VideoNum是0，请求的是原始视频1和融合视频6\r\n                            if(replyMergeFront!=null){\r\n                            videoReply2 = JSON.parseObject(replyMergeFront, VideoReply.class);//兩個視頻都請求\r\n                            Log.d(TAG, \"onTick: replyMergeFront\"+videoReply2.toString());}\r\n//                        videoReply.setCode(\"00\"+i);\r\n                        }else {//融合視頻有數據\r\n                            String replyOriginalRetry = postVideoRequest(videoNum+1);\r\n                            if(replyOriginalRetry!=null){\r\n                            videoReply = JSON.parseObject(replyOriginalRetry, VideoReply.class);//繼續請求原始視頻\r\n                            Log.d(TAG, \"onTick: 融合视频成功，原始失败\");}\r\n                        }\r\n                    }\r\n                    else {//原始視頻已請求数据\r\n                            if (videoReply2.getCode().equals(\"InitialString\")){//融合視頻為初始數據\r\n                                String replyMergeRetry=postVideoRequest(videoNum+6);\r\n                                if(replyMergeRetry!=null){\r\n                                videoReply2 = JSON.parseObject(replyMergeRetry, VideoReply.class);\r\n                                Log.d(TAG, \"onTick: 原始视频成功，融合失败\");}\r\n//                                videoReply2.setCode(\"00\"+i);\r\n                            }else {//全部有數據\r\n                                Log.d(TAG, i+\"onTick: videoReply1：\"+videoReply.toString()+\"\\nvideoReply2：\"+videoReply2.toString());\r\n                                onFinish();//對code的四種狀態進行判斷\r\n                                cancel();\r\n                            }\r\n                    }\r\n                }\r\n\r\n                @Override\r\n                public void onFinish() {\r\n                    if(videoReply.getCode().equals(\"0030000\")){//原始視頻可用\r\n                        if (videoReply2.getCode().equals(\"0030000\")){\r\n                            playVideo(0);//最理想情況，同時可播倆視頻\r\n                        }else{\r\n                            playVideo(1);//融合視頻不可用，播放原始視頻\r\n                        }\r\n                    }\r\n                    else{//原始視頻不可用\r\n                        if (videoReply2.getCode().equals(\"0030000\")){\r\n                            playVideo(6);//只播融合視頻\r\n                        }else{\r\n                            replyTextView.setText(\"WRONG!\");\r\n                        }\r\n                    }\r\n                }\r\n            }.start();\r\n        }\r\n    }\r\n\r\n    public String postVideoRequest(int videoNum){\r\n        videoRequest = new VideoRequest();\r\n        videoRequest.setUserId(\"6D\");\r\n        videoRequest.setVin(\"test\");\r\n        videoRequest.setVideo_type(Integer.toString(videoNum));\r\n        videoRequest.setServicetype(\"1\");\r\n        final String videoRequestJson = JSON.toJSONString(videoRequest);//序列化\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                try {\r\n                    requestTextView.setText(videoRequestJson);\r\n\r\n                    OkHttpClient videoClient=new OkHttpClient();\r\n                    Request videoRequest= new Request.Builder()\r\n                            .url(hostURL+\"videoRequest\")\r\n                            .post(RequestBody.create(MediaType.parse(\"application/json\"),videoRequestJson))\r\n                            .build();//创造HTTP请求\r\n\r\n                    //执行发送的指令\r\n                    Response videoResponse = videoClient.newCall(videoRequest).execute();\r\n                    videoResponseString=videoResponse.body().string();\r\n                    Log.d(\"Reply\",videoResponseString);\r\n                    replyTextView.setText(videoResponseString);\r\n//                    videoReply2 = JSON.parseObject(videoResponseString,VideoReply.class);\r\n                }catch (Exception e){\r\n                    e.printStackTrace();\r\n                    Log.d(\"POST失敗\", \"onClick: \"+e.toString());\r\n                    runOnUiThread(new Runnable() {\r\n                        @Override\r\n                        public void run() {\r\n                            Toast.makeText(VideoMonitor.this,\"請求視頻失败！\",Toast.LENGTH_LONG).show();\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }).start();\r\n        return videoResponseString;\r\n    }\r\n\r\n    public void playVideoUrl( String url){\r\n      Toast.makeText(VideoMonitor.this, \"請求成功！\", Toast.LENGTH_SHORT).show();\r\n      player = new PlayerView(VideoMonitor.this, rootView)\r\n              //.setTitle(\"前摄像\")\r\n              .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n              .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n              .forbidTouch(false)\r\n              .hideSteam(true)\r\n              .hideMenu(true)\r\n              .hideCenterPlayer(false)\r\n              .setNetWorkTypeTie(false)\r\n              .hideRotation(true) //隐藏旋转按钮\r\n              .setChargeTie(true, 480)//设置最长播放时间\r\n              .showThumbnail(new OnShowThumbnailListener() {\r\n                  @Override\r\n                  public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                      Glide.with(mContext)\r\n                              .load(R.drawable.pic_before_video)//\"http://cn.bing.com/az/hprichbg/rb/Dongdaemun_ZH-CN10736487148_1920x1080.jpg\"\r\n                              .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                              .error(R.color.cl_error)//加载错误之后的错误图\r\n                              .into(ivThumbnail);\r\n                  }\r\n              })\r\n             .setPlaySource(url)\r\n              .startPlay();\r\n    }\r\n\r\n    public void playVideo(int videoNum){\r\n\r\n        switch (videoNum){\r\n            case 0:\r\n                //前视角原始视频与融合视频在一个按钮，通过视频窗口内部按钮切换\r\n                Toast.makeText(VideoMonitor.this,\"請求成功！\",Toast.LENGTH_SHORT).show();\r\n                list = new ArrayList<VideoijkBean>();\r\n                //有部分视频加载有问题，这个视频是有声音显示不出图像的，没有解决http://fzkt-biz.oss-cn-hangzhou.aliyuncs.com/vedio/2f58be65f43946c588ce43ea08491515.mp4\r\n                //这里模拟一个本地视频的播放，视频需要将testvideo文件夹的视频放到安卓设备的内置sd卡根目录中\r\n                String url1 = \"http://ivi.bupt.edu.cn/hls/cctv1.m3u8\";//\"rtmp://150.158.176.170/live/1\";\r\n                String url2 = \"rtsp://150.158.176.170/test.mkv\";\r\n                VideoijkBean m1 = new VideoijkBean();\r\n                m1.setStream(\"原始视频\");\r\n                m1.setUrl(url1);\r\n                VideoijkBean m2 = new VideoijkBean();\r\n                m2.setStream(\"融合视频\");\r\n                m2.setUrl(url2);\r\n                list.add(m1);\r\n                list.add(m2);\r\n                player = new PlayerView(this, rootView) {\r\n                    @Override\r\n                    public PlayerView setPlaySource(List<VideoijkBean> list) {\r\n                        return super.setPlaySource(list);\r\n                    }\r\n                }\r\n                        //.setTitle(\"前摄像\")\r\n                        .setProcessDurationOrientation(PlayStateParams.PROCESS_PORTRAIT)\r\n                        .setScaleType(PlayStateParams.fillparent) //视频界面剪裁设置\r\n                        .forbidTouch(false)\r\n                        .hideSteam(false)\r\n                        .hideMenu(true)\r\n                        .hideCenterPlayer(true)\r\n                        .setNetWorkTypeTie(false)\r\n                        .hideRotation(true) //隐藏旋转按钮\r\n                        .setChargeTie(true,480)//设置最长播放时间\r\n                        .showThumbnail(new OnShowThumbnailListener() {\r\n                            @Override\r\n                            public void onShowThumbnail(ImageView ivThumbnail) {\r\n//                                 加载前显示的缩略图\r\n                                Glide.with(mContext)\r\n                                        .load(R.drawable.pic_before_video)//\"http://cn.bing.com/az/hprichbg/rb/Dongdaemun_ZH-CN10736487148_1920x1080.jpg\"\r\n                                        .placeholder(R.drawable.pic_before_video) //加载成功之前占位图\r\n                                        .error(R.color.cl_error)//加载错误之后的错误图\r\n                                        .into(ivThumbnail);\r\n                            }\r\n                        })\r\n                        .setPlaySource(list)\r\n                        .startPlay();\r\n                break;\r\n            case 1:\r\n                //只播原始視頻\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv1.m3u8\");\r\n                break;\r\n            case 2:\r\n                //后视角\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv2.m3u8\");\r\n                break;\r\n            case 3:\r\n                //左视角\r\n                playVideoUrl(\"rtsp://150.158.176.170/test.mkv\");\r\n                break;\r\n            case 4:\r\n                //右视角\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv4.m3u8\");\r\n                break;\r\n            case 5:\r\n                //上帝视角\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv5.m3u8\");\r\n                break;\r\n            case 6:\r\n                //只有融合視頻\r\n                playVideoUrl(\"http://ivi.bupt.edu.cn/hls/cctv6.m3u8\");\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n\r\n    @OnClick({R.id.light})\r\n    public void onClick(View view) {\r\n        switch (view.getId()) {\r\n            case R.id.light:\r\n                {   \r\n//                    requestTextView.setText(\"請求開燈/關燈\");\r\n                    }\r\n            break;\r\n\r\n        }\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        if (player != null) {\r\n            player.onPause();\r\n        }\r\n        /**demo的内容，恢复系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, true);\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        if (player != null) {\r\n            player.onResume();\r\n        }\r\n        /**demo的内容，暂停系统其它媒体的状态*/\r\n        MediaUtils.muteAudioFocus(mContext, false);\r\n        /**demo的内容，激活设备常亮状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.acquire();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onDestroy() {\r\n        super.onDestroy();\r\n        if (player != null) {\r\n            player.onDestroy();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onConfigurationChanged(Configuration newConfig) {\r\n        super.onConfigurationChanged(newConfig);\r\n        if (player != null) {\r\n            player.onConfigurationChanged(newConfig);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onBackPressed() {\r\n        if (player != null && player.onBackPressed()) {\r\n            return;\r\n        }\r\n        super.onBackPressed();\r\n        /**demo的内容，恢复设备亮度状态*/\r\n        if (wakeLock != null) {\r\n            wakeLock.release();\r\n        }\r\n    }\r\n\r\n\r\n    @Override\r\n    public void onCheckedChanged(MyRadioGroup group, int checkedId) {\r\n\r\n    }\r\n}\r\n
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/videomonitoring/VideoMonitor.java	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/videomonitoring/VideoMonitor.java	(date 1609124926820)
--@@ -104,7 +104,7 @@
--                 videoReply = new VideoReply("原始");
--                 videoReply2 = new VideoReply("融合");
-- 
---                replyTextView.setText("当前选择"+checkedId);
--+//                replyTextView.setText("当前选择"+checkedId);
--                 switch (checkedId){
--                     case R.id.left_Click:
--                         try2play(3);
--@@ -141,7 +141,7 @@
--             @Override
--             public void onTick(long millisUntilFinished) {
--                 i=i+1;
---                replyTextView.setText("执行第"+i+"次请求："+videoReply.toString());
--+//                replyTextView.setText("执行第"+i+"次请求："+videoReply.toString());
--                 if (videoReply.getCode().equals("InitialString")){
--                     String replyOriginalString = postVideoRequest(videoNum);
--                     if(replyOriginalString!=null){
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControlInitial.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.app.Activity;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.view.View;\r\nimport android.view.WindowManager;\r\nimport android.widget.ImageButton;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\n\r\npublic class RemoteControlInitial extends Activity {\r\n\r\n    private Context mContext;\r\n    private ImageButton StartRemove;\r\n    private ImageButton imageButton_forward,imageButton_backward;\r\n    private TextView speedTextView;\r\n    private double wheelAngle=0.0;\r\n\r\n\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        getWindow().addFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);\r\n\r\n        //一直连接Iothub\r\n\r\n\r\n\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_remote_controlinitial);\r\n        this.mContext = this;\r\n        CountDownTimer countDownTimer = new CountDownTimer(100000, 200) {\r\n            @Override\r\n            public void onTick(long millisUntilFinished) {\r\n                speedTextView = findViewById(R.id.speed);\r\n                speedTextView.setText(String.valueOf((int) wheelAngle));\r\n            }\r\n\r\n            @Override\r\n            public void onFinish() {\r\n            }\r\n        }.start();\r\n\r\n\r\n        StartRemove= (ImageButton)findViewById(R.id.startRemove);\r\n        StartRemove.setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View V){\r\n\r\n                        //IotHub连接成功弹出对话框，否则提示当前连接车辆失败\r\n                        AlertDialog.Builder builder=new AlertDialog.Builder(mContext);\r\n                        builder.setTitle(\"开始挪车\");//设置对话框的标题\r\n                        builder.setMessage(\"挪车功能提供用户通过手机遥控移动车辆的功能请问您要开始挪车吗？\");//设置对话框的内容\r\n                        builder.setPositiveButton(\"确定\", new DialogInterface.OnClickListener() {  //这个是设置确定按钮\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                Intent intent=new Intent(RemoteControlInitial.this, RemoteControl.class);\r\n                                startActivity(intent);\r\n                            }\r\n                        });\r\n                        builder.setNegativeButton(\"取消\", new DialogInterface.OnClickListener() {  //取消按钮\r\n\r\n                            @Override\r\n                            public void onClick(DialogInterface arg0, int arg1) {\r\n                                Toast.makeText(RemoteControlInitial.this, \"取消成功\",Toast.LENGTH_SHORT).show();\r\n                            }\r\n                        });\r\n                        AlertDialog b=builder.create();\r\n                        b.show();\r\n                    }\r\n                 });\r\n    }\r\n}\r\n\r\n
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControlInitial.java	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/RemoteControlInitial.java	(date 1609120353915)
--@@ -31,8 +31,6 @@
-- 
--         //一直连接Iothub
-- 
---
---
--         super.onCreate(savedInstanceState);
--         setContentView(R.layout.activity_remote_controlinitial);
--         this.mContext = this;
--Index: app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/ScalableImageView.java
--IDEA additional info:
--Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
--<+>package com.dou361.jjdxm_ijkplayer.remotecontrol;\r\n\r\nimport android.content.Context;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapFactory;\r\nimport android.graphics.Matrix;\r\nimport android.graphics.Point;\r\nimport android.graphics.PointF;\r\nimport android.util.AttributeSet;\r\nimport android.util.Log;\r\nimport android.view.MotionEvent;\r\nimport android.view.animation.RotateAnimation;\r\n\r\nimport com.dou361.jjdxm_ijkplayer.R;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport static android.content.ContentValues.TAG;\r\n\r\n\r\n/**\r\n * Fixed on 2020/9/17,which is a happy day!\r\n */\r\npublic class ScalableImageView extends androidx.appcompat.widget.AppCompatImageView{\r\n\r\n\r\n    private static final double MAX_DEGREE = 600.0;//方向盘最大转角\r\n    private Matrix matrix;\r\n    private Matrix cacheMatrix;  //缓存的matrix ，同时记录上一次滑动的位置\r\n    private float mPointDistinct = 1f;\r\n    private  double mDegree=0.0;// 旋转的ScalableImageView角度\r\n    double radius0 =0.0;\r\n\r\n\r\n    private Bitmap bitmap;\r\n\r\n    public  Double getmDegree() {\r\n        return mDegree;\r\n\r\n    }\r\n\r\n    List<Double> angleList= new ArrayList<>();//For story the angle data\r\n    List<PointF> pointFList = new ArrayList<>();\r\n    PointF point2store=new PointF();\r\n    int circle =0;\r\n    double degree0 = 0.0;//按下角度\r\n    double degree = 0.0;//转动角度\r\n    double radiusLast;\r\n    double degreeLast;\r\n    double radiusNow;\r\n    double degreeNow;\r\n    double delta_degree;\r\n\r\n    enum Mode {\r\n        NONE, DOWN, MOVE\r\n    }\r\n\r\n    private Mode mode; //当前mode\r\n    private Context mContext;\r\n\r\n    private PointF mStart = new PointF();\r\n\r\n    public ScalableImageView(Context context) {\r\n        this(context, null);\r\n    }\r\n\r\n    public ScalableImageView(Context context, AttributeSet attrs) {\r\n        this(context, attrs, 0);\r\n    }\r\n\r\n    public ScalableImageView(Context context, AttributeSet attrs, int defStyleAttr) {\r\n        super(context, attrs, defStyleAttr);\r\n        this.mContext = context;\r\n        init();\r\n    }\r\n\r\n    private void init() {\r\n        circle = 0;\r\n        degree = 0.0;\r\n        degree0 = 0.0;\r\n        mDegree = 0.0;\r\n        radius0 = 0.0;\r\n        matrix = new Matrix();\r\n        cacheMatrix = new Matrix();\r\n        pointFList.clear();\r\n        mode = Mode.NONE;\r\n        bitmap= BitmapFactory.decodeResource(getResources(), R.drawable.steering_wheel);  //避免OOM\r\n        setImageBitmap(bitmap);\r\n    }\r\n\r\n    @Override\r\n    public boolean onTouchEvent(MotionEvent event) {\r\n        switch (event.getAction() & MotionEvent.ACTION_MASK) {\r\n            case MotionEvent.ACTION_DOWN:\r\n            case MotionEvent.ACTION_POINTER_DOWN:\r\n                cacheMatrix.set(matrix); //先拷贝一份到缓存\r\n                float delta_x0 = (event.getX()- bitmap.getWidth()/2);\r\n                float delta_y0 = (event.getY() - bitmap.getHeight()/ 2);\r\n                radius0 = Math.atan2(delta_y0,delta_x0);\r\n                degree0= (Double) Math.toDegrees(radius0);\r\n                Log.d(TAG, \"onTouchEvent: 初始角度\"+degree0);\r\n                mode = Mode.DOWN;\r\n                mStart.set(delta_x0, delta_y0);\r\n                pointFList.add(mStart);\r\n                break;\r\n\r\n            case MotionEvent.ACTION_MOVE:\r\n                //单点触控的时候\r\n                if (mode == Mode.DOWN) {\r\n                    matrix.set(cacheMatrix);\r\n                    float delta_x = (event.getX()- bitmap.getWidth()/2);\r\n                    float delta_y = (event.getY() - bitmap.getHeight()/ 2);\r\n\r\n                    pointFList.add(new PointF(delta_x,delta_y));\r\n                    if(pointFList.size()>5){\r\n                        for(int i=0;i<pointFList.size()-5;i++){\r\n                            pointFList.remove(i);\r\n                        }\r\n                    }\r\n                    if(pointFList.size()>=2){\r\n                        for(int i=0;i<pointFList.size();i++){\r\n                            Log.d(TAG, \"onTouchEvent: \\n第\"+i+\"个点：\"+pointFList.get(i).x+\",\"+pointFList.get(i).y+\"\\n\");\r\n                        }\r\n                         radiusLast = Math.atan2(pointFList.get(pointFList.size()-2).y,pointFList.get(pointFList.size()-2).x);\r\n                         degreeLast = Math.toDegrees(radiusLast);\r\n                         radiusNow = Math.atan2(pointFList.get(pointFList.size()-1).y,pointFList.get(pointFList.size()-1).x);\r\n                         degreeNow = Math.toDegrees(radiusNow);\r\n                         delta_degree = degreeNow - degreeLast;\r\n                        if(delta_degree<=0&&Math.abs(delta_degree)<180){\r\n                            mDegree=mDegree-Math.abs(delta_degree);\r\n                        }else if(delta_degree<=0&&Math.abs(delta_degree)>=180){\r\n                            mDegree= mDegree+360-Math.abs(delta_degree);\r\n                        }else if(delta_degree>0&&Math.abs(delta_degree)<180){\r\n                            mDegree= mDegree+Math.abs(delta_degree);\r\n                        }else if(delta_degree>0&&Math.abs(delta_degree)>=180){\r\n                            mDegree= mDegree-360+Math.abs(delta_degree);\r\n                        }\r\n                        Log.d(TAG, \"onTouchEvent: 現在角度\"+mDegree);\r\n                    }\r\n                    if(mDegree>MAX_DEGREE) {mDegree = MAX_DEGREE;}\r\n                    if(mDegree<-MAX_DEGREE){mDegree =-MAX_DEGREE;}\r\n\r\n                    /*double radius = Math.atan2(delta_y,delta_x);\r\n                    Log.d(TAG, \"onTouchEvent: pass弧度\"+(radius-radius0));\r\n                    //向量叉乘判斷正負\r\n                    if(event.getY()-mStart.y>0){\r\n                        Log.d(TAG, \"onTouchEvent: 順時針\"+Math.atan2(1,-1));\r\n//                        degree=degree+360;\r\n                    }else {\r\n                        Log.d(TAG, \"onTouchEvent: 逆時針\"+Math.atan2(-1,1));\r\n                    }\r\n\r\n                    Log.d(TAG, \"onTouchEvent: 現在弧度\"+radius);\r\n                    Log.d(TAG, \"onTouchEvent: 現在角度\"+Math.toDegrees(radius));\r\n                    degree= (Double) Math.toDegrees(radius)-degree0;\r\n                    Log.d(TAG, \"onTouchEvent: 旋轉角度\"+degree);\r\n                    angleList.add(degree);\r\n                    if(angleList.size()>5){\r\n                        for(int i=0;i<angleList.size()-5;i++){\r\n                            angleList.remove(i);\r\n                        }\r\n                    }\r\n                    if(angleList.size()>2) {\r\n                        //\r\n                        Log.d(TAG, \"onTouchEvent: \\n當前角度\"+angleList.get(angleList.size() - 1)+\"上次角度\"+angleList.get(angleList.size() - 2));\r\n                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) > 300)\r\n                        {\r\n//                            circle--;\r\n                        Log.d(TAG, \"onTouchEvent: 減了一圈\"+circle);}\r\n                        if (angleList.get(angleList.size() - 1) - angleList.get(angleList.size() - 2) < -300)\r\n                        {\r\n//                            circle++;\r\n                        Log.d(TAG, \"onTouchEvent: 加了一圈\"+circle);}\r\n                        degree = degree + 360 * circle;\r\n\r\n                        if(degree>MAX_DEGREE) {degree = MAX_DEGREE;}\r\n                        if(degree<-MAX_DEGREE){degree =-MAX_DEGREE;}\r\n                    }\r\n                    Log.d(\"赋值Degree\",mDegree+\"\");\r\n                    mDegree = degree;*/\r\n\r\n//                    final RotateAnimation rotateAnimation = new RotateAnimation(0f, (float)degree, bitmap.getWidth() / 2, bitmap.getHeight() / 2);\r\n                    matrix.postRotate((float) mDegree,bitmap.getWidth()/2, bitmap.getHeight()/ 2);\r\n                }\r\n                break;\r\n            case MotionEvent.ACTION_UP:\r\n                init();\r\n            case MotionEvent.ACTION_POINTER_UP:\r\n            case MotionEvent.ACTION_CANCEL:\r\n                mode = Mode.NONE;\r\n                break;\r\n        }\r\n        setImageMatrix(matrix);\r\n        return true;\r\n    }\r\n\r\n}
--Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
--<+>UTF-8
--===================================================================
----- app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/ScalableImageView.java	(revision 010ed5a5f472aa84c1872f0121780d801debeb34)
--+++ app/src/main/java/com/dou361/jjdxm_ijkplayer/remotecontrol/ScalableImageView.java	(date 1609122138619)
--@@ -24,7 +24,6 @@
--  */
-- public class ScalableImageView extends androidx.appcompat.widget.AppCompatImageView{
-- 
---
--     private static final double MAX_DEGREE = 600.0;//方向盘最大转角
--     private Matrix matrix;
--     private Matrix cacheMatrix;  //缓存的matrix ，同时记录上一次滑动的位置
-Index: .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_16_53__Default_Changelist_.xml
-===================================================================
---- .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_16_53__Default_Changelist_.xml	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-+++ .idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_16_53__Default_Changelist_.xml	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-@@ -1,4 +0,0 @@
--<changelist name="Uncommitted_changes_before_Update_at_2020_12_28_16_53_[Default_Changelist]" date="1609145624999" recycled="true" deleted="true">
--  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2020_12_28_16_53_[Default_Changelist]/shelved.patch" />
--  <option name="DESCRIPTION" value="Uncommitted changes before Update at 2020/12/28 16:53 [Default Changelist]" />
--</changelist>
-\ No newline at end of file
-Index: .idea/shelf/Uncommitted_changes_before_Checkout_at_2020_12_28_12_01__Default_Changelist_.xml
-===================================================================
---- .idea/shelf/Uncommitted_changes_before_Checkout_at_2020_12_28_12_01__Default_Changelist_.xml	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-+++ .idea/shelf/Uncommitted_changes_before_Checkout_at_2020_12_28_12_01__Default_Changelist_.xml	(revision 148863c795208809c3c7ac69f581d586fa88cfdb)
-@@ -1,4 +0,0 @@
--<changelist name="Uncommitted_changes_before_Checkout_at_2020_12_28_12_01_[Default_Changelist]" date="1609128099574" recycled="true" deleted="true">
--  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Checkout_at_2020_12_28_12_01_[Default_Changelist]/shelved.patch" />
--  <option name="DESCRIPTION" value="Uncommitted changes before Checkout at 2020/12/28 12:01 [Default Changelist]" />
--</changelist>
-\ No newline at end of file
Index: .idea/shelf/Uncommitted_changes_before_Update_at_2021_1_5_10_36__Default_Changelist_.xml
===================================================================
--- .idea/shelf/Uncommitted_changes_before_Update_at_2021_1_5_10_36__Default_Changelist_.xml	(revision e962e336aaaab82d0b16a9fddf934ebf95847741)
+++ .idea/shelf/Uncommitted_changes_before_Update_at_2021_1_5_10_36__Default_Changelist_.xml	(revision e962e336aaaab82d0b16a9fddf934ebf95847741)
@@ -1,9 +0,0 @@
-<changelist name="Uncommitted_changes_before_Update_at_2021_1_5_10_36_[Default_Changelist]" date="1609814192754" recycled="true" deleted="true">
-  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2021_1_5_10_36_[Default_Changelist]/shelved.patch" />
-  <option name="DESCRIPTION" value="Uncommitted changes before Update at 2021/1/5 10:36 [Default Changelist]" />
-  <binary>
-    <option name="BEFORE_PATH" value=".idea/caches/build_file_checksums.ser" />
-    <option name="AFTER_PATH" value=".idea/caches/build_file_checksums.ser" />
-    <option name="SHELVED_PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2021_1_5_10_36_[Default_Changelist]/build_file_checksums.ser" />
-  </binary>
-</changelist>
\ No newline at end of file
